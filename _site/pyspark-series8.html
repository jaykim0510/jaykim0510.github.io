<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Apache Pyspark Series [Part8]: PySpark Structured Streaming (3) Operations and Watermark</title>
  <meta name='description' content='Jay Tech personal blogging theme for Jekyll'>

  <link rel="canonical" href="http://localhost:4000/pyspark-series8">
  <link rel="alternate" type="application/rss+xml" title="Code Museum" href="/feed.xml">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Apache Pyspark Series [Part8]: PySpark Structured Streaming (3) Operations and Watermark – Code Museum">
  <meta name="twitter:description" content="
">
  <meta name="twitter:image:src" content="http://localhost:4000/images/pyspark_logo.png">

  <!-- Facebook OpenGraph -->
  <meta property="og:title" content="Apache Pyspark Series [Part8]: PySpark Structured Streaming (3) Operations and Watermark – Code Museum">
  <meta property="og:description" content="
">
  <meta property="og:image" content="http://localhost:4000/images/pyspark_logo.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com">

  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700;900&display=swap" as="style">

  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700;900&display=swap" rel="stylesheet">


  <!-- Ionicons -->
  <link rel="preload" href="https://unpkg.com/ionicons@4.2.2/dist/css/ionicons.min.css" as="style">

  <link href="https://unpkg.com/ionicons@4.2.2/dist/css/ionicons.min.css" rel="stylesheet">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://kit.fontawesome.com/869a10f869.js" crossorigin="anonymous"></script>

  <script>
    
    if (localStorage.getItem("theme") === "dark") {
      document.documentElement.setAttribute("dark", "");
      document.documentElement.classList.add('dark-mode');
    }
    
  </script>

  <style>
  
  /*!------------------------------------------------------------------
[MAIN STYLESHEET]
-------------------------------------------------------------------*/:root{--brand-color: #0073ec;--white: #fff;--light-gray: #f0f0f0;--light-blue: #f3f7ff;--blue-gray: #716f8a;--gray: #9e9e9e;--dark: #0c101a;--dark-blue: #1e2740;--dark-grey: rgb(97, 97, 97);--background-color: rgb(250, 250, 250);--background-alt-color: var(--dark-blue);--text-color: var(--dark-grey);--text-alt-color: var(--blue-gray);--heading-font-color: var(--dark-blue);--link-color: var(--dark-blue);--link-color-hover: var(--dark-blue);--button-color: var(--white);--button-background-color: var(--brand-color);--button-background-hover: #4f31c7;--pagination-item: whitesmoke;--border-color: var(--light-blue);--border-color-alt: var(--light-blue);--th-color: whitesmoke;--tr-color: var(--light-gray);--td-color: rgb(255, 255, 240);--syntax-highlighting-background: #f3f3f3;--article__inner-background: white;--top-background: black;--strong-font-color: palevioletred;--article-highlighing-background: lightgrey;--article-highlighing-font: blueviolet;--drag-background-color: darksalmon;--drag-font-color: greenyellow;--quote-font-color: cadetblue;--post-tag-list-background-color: gainsboro;--post-category-list-background-color: antiquewhite}[dark]:root{--brand-color: #0073ec;--white: #fff;--light-gray: #f0f0f0;--gray: #9e9e9e;--dark: #111016;--background-color: var(--dark);--background-alt-color: #1a1a1f;--text-color: var(--gray);--text-alt-color: var(--gray);--heading-font-color: darkgrey;--link-color: var(--light-gray);--link-color-hover: var(--light-gray);--button-color: var(--white);--button-background-color: var(--brand-color);--button-background-hover: #4f31c7;--pagination-item: black;--border-color: #252629;--border-color-alt: #080b12;--th-color: black;--tr-color: #080b12;--td-color: dimgray;--syntax-highlighting-background: #292c33;--article__inner-background: rgb(65, 65, 65);--top-background: black;--strong-font-color: darkseagreen;--article-highlighing-background: darkslategrey;--article-highlighing-font: goldenrod;--drag-background-color: darkslategrey;--drag-font-color: rgb(115, 192, 0);--quote-font-color: palevioletred;--post-tag-list-background-color: darkslateblue;--post-category-list-background-color: darkred}.list-reset{list-style-type:none;margin:0;padding:0}.clearfix::after,.clearfix ::before{content:"";display:table;clear:both}.screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:0.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder;color:var(--strong-font-color)}code,kbd,samp{font-family:Monaco, Consolas, "Lucida Console", monospace;font-size:1.15em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:0.35em 0.75em 0.625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}bold{font-weight:1000}mark{background-color:rgba(210,105,30,0.493)}body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,dl,dd,ol,ul,fieldset,legend,figure,hr{margin:0;padding:0}li>ul,li>ol{margin-bottom:0}table{border-collapse:collapse;border-spacing:0}h1,h2,h3,h4,h5,h6,ul,ol,dl,blockquote,p,address,hr,table,fieldset,figure,pre{margin-bottom:32px}ul,ol,dd{margin-left:16px}ul li,ol li{margin-bottom:10px}.highlight{margin-bottom:32px;background:var(--syntax-highlighting-background)}.highlighter-rouge .highlight{background:#1d1f27;border-radius:9px}.highlight .p{color:lightgrey;font-weight:bold}.highlight .n{color:#518cad;font-weight:bold}.highlight .c{color:forestgreen;font-style:italic}.highlight .k{color:#b679e9;font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:forestgreen;font-style:italic}.highlight .cp{color:forestgreen;font-weight:bold}.highlight .c1{color:forestgreen;font-style:italic}.highlight .cs{color:forestgreen;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{color:#569cd7;font-weight:bold}.highlight .kd{color:#569cd7;font-weight:bold}.highlight .kp{color:#569cd7;font-weight:bold}.highlight .kr{color:#569cd7;font-weight:bold}.highlight .kt{color:#5d76bf;font-weight:bold}.highlight .m{color:#099}.highlight .na{color:#b679e9;font-weight:bold}.highlight .nb{color:darksalmon;font-weight:bold}.highlight .nc{color:#5d76bf;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .nl{color:#79bae2;font-weight:bold}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:darksalmon;font-weight:bold}.highlight .nn{color:#ffcb6b}.highlight .nt{color:#4d65dc}.highlight .ow{color:#b679e9;font-weight:bold}.highlight .w{color:#bbb}.highlight .sb{color:#d19379}.highlight .sc{color:#d19379}.highlight .sd{color:#d19379}.highlight .s2{color:#d19379}.highlight .se{color:#d19379}.highlight .sh{color:#d19379}.highlight .si{color:#d19379}.highlight .sx{color:#d19379}.highlight .sr{color:#d19379}.highlight .s1{color:#d19379}.highlight .ss{color:#d19379}.highlight .bp{color:#999}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}@media only screen and (min-width: 768px){.post__content{grid-column:span 9}}@media only screen and (max-width: 768px){.post__content{grid-column:span 11}}@media only screen and (max-width: 576px){.post__content{grid-column:span 11}}@media only screen and (min-width: 768px){.post__tags_list{grid-column:span 2;padding-left:2vw}}@media only screen and (max-width: 768px){.post__tags_list{grid-column:span 0;display:none}}@media only screen and (max-width: 576px){.post__tags_list{grid-column:span 0;display:none}}.container_post{max-width:1140px;padding-left:16px;padding-right:16px;margin:0 auto}@media only screen and (max-width: 1140px){.container_post{max-width:1000px}}@media only screen and (max-width: 1024px){.container_post{max-width:740px}}@media only screen and (min-width: 768px){.container_post{display:grid;grid-template-columns:repeat(11, 1fr)}}@media only screen and (max-width: 768px){.container_post{max-width:560px}}@media only screen and (max-width: 576px){.container_post{max-width:480px;padding-left:calc(16px + 4px);padding-right:calc(16px + 4px)}}.container{max-width:1140px;padding-left:16px;padding-right:16px;margin:0 auto}@media only screen and (max-width: 1140px){.container{max-width:1000px}}@media only screen and (max-width: 1024px){.container{max-width:740px}}@media only screen and (max-width: 768px){.container{max-width:560px}}@media only screen and (max-width: 576px){.container{max-width:480px;padding-left:calc(16px + 4px);padding-right:calc(16px + 4px)}}.row{display:flex;flex-wrap:wrap;flex:0 1 auto;flex-direction:row;box-sizing:border-box;margin-left:-16px;margin-right:-16px}.col{padding-left:16px;padding-right:16px}[class^="col-"]{flex:auto}.col-0{width:0%}.col-1{width:8.3333333333%}.col-2{width:16.6666666667%}.col-3{width:25%}.col-4{width:33.3333333333%}.col-5{width:41.6666666667%}.col-6{width:50%}.col-7{width:58.3333333333%}.col-8{width:66.6666666667%}.col-9{width:75%}.col-10{width:83.3333333333%}.col-11{width:91.6666666667%}.col-12{width:100%}.push-0{margin-left:0%}.push-1{margin-left:8.3333333333%}.push-2{margin-left:16.6666666667%}.push-3{margin-left:25%}.push-4{margin-left:33.3333333333%}.push-5{margin-left:41.6666666667%}.push-6{margin-left:50%}.push-7{margin-left:58.3333333333%}.push-8{margin-left:66.6666666667%}.push-9{margin-left:75%}.push-10{margin-left:83.3333333333%}.push-11{margin-left:91.6666666667%}.push-12{margin-left:100%}.pull-0{margin-right:0%}.pull-1{margin-right:8.3333333333%}.pull-2{margin-right:16.6666666667%}.pull-3{margin-right:25%}.pull-4{margin-right:33.3333333333%}.pull-5{margin-right:41.6666666667%}.pull-6{margin-right:50%}.pull-7{margin-right:58.3333333333%}.pull-8{margin-right:66.6666666667%}.pull-9{margin-right:75%}.pull-10{margin-right:83.3333333333%}.pull-11{margin-right:91.6666666667%}.pull-12{margin-right:100%}@media (max-width: 1024px){.col-d-0{width:0%}.col-d-1{width:8.3333333333%}.col-d-2{width:16.6666666667%}.col-d-3{width:25%}.col-d-4{width:33.3333333333%}.col-d-5{width:41.6666666667%}.col-d-6{width:50%}.col-d-7{width:58.3333333333%}.col-d-8{width:66.6666666667%}.col-d-9{width:75%}.col-d-10{width:83.3333333333%}.col-d-11{width:91.6666666667%}.col-d-12{width:100%}.push-d-0{margin-left:0%}.push-d-1{margin-left:8.3333333333%}.push-d-2{margin-left:16.6666666667%}.push-d-3{margin-left:25%}.push-d-4{margin-left:33.3333333333%}.push-d-5{margin-left:41.6666666667%}.push-d-6{margin-left:50%}.push-d-7{margin-left:58.3333333333%}.push-d-8{margin-left:66.6666666667%}.push-d-9{margin-left:75%}.push-d-10{margin-left:83.3333333333%}.push-d-11{margin-left:91.6666666667%}.push-d-12{margin-left:100%}.pull-d-0{margin-right:0%}.pull-d-1{margin-right:8.3333333333%}.pull-d-2{margin-right:16.6666666667%}.pull-d-3{margin-right:25%}.pull-d-4{margin-right:33.3333333333%}.pull-d-5{margin-right:41.6666666667%}.pull-d-6{margin-right:50%}.pull-d-7{margin-right:58.3333333333%}.pull-d-8{margin-right:66.6666666667%}.pull-d-9{margin-right:75%}.pull-d-10{margin-right:83.3333333333%}.pull-d-11{margin-right:91.6666666667%}.pull-d-12{margin-right:100%}}@media (max-width: 768px){.col-t-0{width:0%}.col-t-1{width:8.3333333333%}.col-t-2{width:16.6666666667%}.col-t-3{width:25%}.col-t-4{width:33.3333333333%}.col-t-5{width:41.6666666667%}.col-t-6{width:50%}.col-t-7{width:58.3333333333%}.col-t-8{width:66.6666666667%}.col-t-9{width:75%}.col-t-10{width:83.3333333333%}.col-t-11{width:91.6666666667%}.col-t-12{width:100%}.push-t-0{margin-left:0%}.push-t-1{margin-left:8.3333333333%}.push-t-2{margin-left:16.6666666667%}.push-t-3{margin-left:25%}.push-t-4{margin-left:33.3333333333%}.push-t-5{margin-left:41.6666666667%}.push-t-6{margin-left:50%}.push-t-7{margin-left:58.3333333333%}.push-t-8{margin-left:66.6666666667%}.push-t-9{margin-left:75%}.push-t-10{margin-left:83.3333333333%}.push-t-11{margin-left:91.6666666667%}.push-t-12{margin-left:100%}.pull-t-0{margin-right:0%}.pull-t-1{margin-right:8.3333333333%}.pull-t-2{margin-right:16.6666666667%}.pull-t-3{margin-right:25%}.pull-t-4{margin-right:33.3333333333%}.pull-t-5{margin-right:41.6666666667%}.pull-t-6{margin-right:50%}.pull-t-7{margin-right:58.3333333333%}.pull-t-8{margin-right:66.6666666667%}.pull-t-9{margin-right:75%}.pull-t-10{margin-right:83.3333333333%}.pull-t-11{margin-right:91.6666666667%}.pull-t-12{margin-right:100%}}@media (max-width: 576px){.col-m-0{width:0%}.col-m-1{width:8.3333333333%}.col-m-2{width:16.6666666667%}.col-m-3{width:25%}.col-m-4{width:33.3333333333%}.col-m-5{width:41.6666666667%}.col-m-6{width:50%}.col-m-7{width:58.3333333333%}.col-m-8{width:66.6666666667%}.col-m-9{width:75%}.col-m-10{width:83.3333333333%}.col-m-11{width:91.6666666667%}.col-m-12{width:100%}.push-m-0{margin-left:0%}.push-m-1{margin-left:8.3333333333%}.push-m-2{margin-left:16.6666666667%}.push-m-3{margin-left:25%}.push-m-4{margin-left:33.3333333333%}.push-m-5{margin-left:41.6666666667%}.push-m-6{margin-left:50%}.push-m-7{margin-left:58.3333333333%}.push-m-8{margin-left:66.6666666667%}.push-m-9{margin-left:75%}.push-m-10{margin-left:83.3333333333%}.push-m-11{margin-left:91.6666666667%}.push-m-12{margin-left:100%}.pull-m-0{margin-right:0%}.pull-m-1{margin-right:8.3333333333%}.pull-m-2{margin-right:16.6666666667%}.pull-m-3{margin-right:25%}.pull-m-4{margin-right:33.3333333333%}.pull-m-5{margin-right:41.6666666667%}.pull-m-6{margin-right:50%}.pull-m-7{margin-right:58.3333333333%}.pull-m-8{margin-right:66.6666666667%}.pull-m-9{margin-right:75%}.pull-m-10{margin-right:83.3333333333%}.pull-m-11{margin-right:91.6666666667%}.pull-m-12{margin-right:100%}}@media (max-width: 1024px){.col-d-0{width:0%}.col-d-1{width:8.3333333333%}.col-d-2{width:16.6666666667%}.col-d-3{width:25%}.col-d-4{width:33.3333333333%}.col-d-5{width:41.6666666667%}.col-d-6{width:50%}.col-d-7{width:58.3333333333%}.col-d-8{width:66.6666666667%}.col-d-9{width:75%}.col-d-10{width:83.3333333333%}.col-d-11{width:91.6666666667%}.col-d-12{width:100%}.push-d-0{margin-left:0%}.push-d-1{margin-left:8.3333333333%}.push-d-2{margin-left:16.6666666667%}.push-d-3{margin-left:25%}.push-d-4{margin-left:33.3333333333%}.push-d-5{margin-left:41.6666666667%}.push-d-6{margin-left:50%}.push-d-7{margin-left:58.3333333333%}.push-d-8{margin-left:66.6666666667%}.push-d-9{margin-left:75%}.push-d-10{margin-left:83.3333333333%}.push-d-11{margin-left:91.6666666667%}.push-d-12{margin-left:100%}.pull-d-0{margin-right:0%}.pull-d-1{margin-right:8.3333333333%}.pull-d-2{margin-right:16.6666666667%}.pull-d-3{margin-right:25%}.pull-d-4{margin-right:33.3333333333%}.pull-d-5{margin-right:41.6666666667%}.pull-d-6{margin-right:50%}.pull-d-7{margin-right:58.3333333333%}.pull-d-8{margin-right:66.6666666667%}.pull-d-9{margin-right:75%}.pull-d-10{margin-right:83.3333333333%}.pull-d-11{margin-right:91.6666666667%}.pull-d-12{margin-right:100%}}@media (max-width: 768px){.col-t-0{width:0%}.col-t-1{width:8.3333333333%}.col-t-2{width:16.6666666667%}.col-t-3{width:25%}.col-t-4{width:33.3333333333%}.col-t-5{width:41.6666666667%}.col-t-6{width:50%}.col-t-7{width:58.3333333333%}.col-t-8{width:66.6666666667%}.col-t-9{width:75%}.col-t-10{width:83.3333333333%}.col-t-11{width:91.6666666667%}.col-t-12{width:100%}.push-t-0{margin-left:0%}.push-t-1{margin-left:8.3333333333%}.push-t-2{margin-left:16.6666666667%}.push-t-3{margin-left:25%}.push-t-4{margin-left:33.3333333333%}.push-t-5{margin-left:41.6666666667%}.push-t-6{margin-left:50%}.push-t-7{margin-left:58.3333333333%}.push-t-8{margin-left:66.6666666667%}.push-t-9{margin-left:75%}.push-t-10{margin-left:83.3333333333%}.push-t-11{margin-left:91.6666666667%}.push-t-12{margin-left:100%}.pull-t-0{margin-right:0%}.pull-t-1{margin-right:8.3333333333%}.pull-t-2{margin-right:16.6666666667%}.pull-t-3{margin-right:25%}.pull-t-4{margin-right:33.3333333333%}.pull-t-5{margin-right:41.6666666667%}.pull-t-6{margin-right:50%}.pull-t-7{margin-right:58.3333333333%}.pull-t-8{margin-right:66.6666666667%}.pull-t-9{margin-right:75%}.pull-t-10{margin-right:83.3333333333%}.pull-t-11{margin-right:91.6666666667%}.pull-t-12{margin-right:100%}}@media (max-width: 576px){.col-m-0{width:0%}.col-m-1{width:8.3333333333%}.col-m-2{width:16.6666666667%}.col-m-3{width:25%}.col-m-4{width:33.3333333333%}.col-m-5{width:41.6666666667%}.col-m-6{width:50%}.col-m-7{width:58.3333333333%}.col-m-8{width:66.6666666667%}.col-m-9{width:75%}.col-m-10{width:83.3333333333%}.col-m-11{width:91.6666666667%}.col-m-12{width:100%}.push-m-0{margin-left:0%}.push-m-1{margin-left:8.3333333333%}.push-m-2{margin-left:16.6666666667%}.push-m-3{margin-left:25%}.push-m-4{margin-left:33.3333333333%}.push-m-5{margin-left:41.6666666667%}.push-m-6{margin-left:50%}.push-m-7{margin-left:58.3333333333%}.push-m-8{margin-left:66.6666666667%}.push-m-9{margin-left:75%}.push-m-10{margin-left:83.3333333333%}.push-m-11{margin-left:91.6666666667%}.push-m-12{margin-left:100%}.pull-m-0{margin-right:0%}.pull-m-1{margin-right:8.3333333333%}.pull-m-2{margin-right:16.6666666667%}.pull-m-3{margin-right:25%}.pull-m-4{margin-right:33.3333333333%}.pull-m-5{margin-right:41.6666666667%}.pull-m-6{margin-right:50%}.pull-m-7{margin-right:58.3333333333%}.pull-m-8{margin-right:66.6666666667%}.pull-m-9{margin-right:75%}.pull-m-10{margin-right:83.3333333333%}.pull-m-11{margin-right:91.6666666667%}.pull-m-12{margin-right:100%}}@media (max-width: 1024px){.col-d-0{width:0%}.col-d-1{width:8.3333333333%}.col-d-2{width:16.6666666667%}.col-d-3{width:25%}.col-d-4{width:33.3333333333%}.col-d-5{width:41.6666666667%}.col-d-6{width:50%}.col-d-7{width:58.3333333333%}.col-d-8{width:66.6666666667%}.col-d-9{width:75%}.col-d-10{width:83.3333333333%}.col-d-11{width:91.6666666667%}.col-d-12{width:100%}.push-d-0{margin-left:0%}.push-d-1{margin-left:8.3333333333%}.push-d-2{margin-left:16.6666666667%}.push-d-3{margin-left:25%}.push-d-4{margin-left:33.3333333333%}.push-d-5{margin-left:41.6666666667%}.push-d-6{margin-left:50%}.push-d-7{margin-left:58.3333333333%}.push-d-8{margin-left:66.6666666667%}.push-d-9{margin-left:75%}.push-d-10{margin-left:83.3333333333%}.push-d-11{margin-left:91.6666666667%}.push-d-12{margin-left:100%}.pull-d-0{margin-right:0%}.pull-d-1{margin-right:8.3333333333%}.pull-d-2{margin-right:16.6666666667%}.pull-d-3{margin-right:25%}.pull-d-4{margin-right:33.3333333333%}.pull-d-5{margin-right:41.6666666667%}.pull-d-6{margin-right:50%}.pull-d-7{margin-right:58.3333333333%}.pull-d-8{margin-right:66.6666666667%}.pull-d-9{margin-right:75%}.pull-d-10{margin-right:83.3333333333%}.pull-d-11{margin-right:91.6666666667%}.pull-d-12{margin-right:100%}}@media (max-width: 768px){.col-t-0{width:0%}.col-t-1{width:8.3333333333%}.col-t-2{width:16.6666666667%}.col-t-3{width:25%}.col-t-4{width:33.3333333333%}.col-t-5{width:41.6666666667%}.col-t-6{width:50%}.col-t-7{width:58.3333333333%}.col-t-8{width:66.6666666667%}.col-t-9{width:75%}.col-t-10{width:83.3333333333%}.col-t-11{width:91.6666666667%}.col-t-12{width:100%}.push-t-0{margin-left:0%}.push-t-1{margin-left:8.3333333333%}.push-t-2{margin-left:16.6666666667%}.push-t-3{margin-left:25%}.push-t-4{margin-left:33.3333333333%}.push-t-5{margin-left:41.6666666667%}.push-t-6{margin-left:50%}.push-t-7{margin-left:58.3333333333%}.push-t-8{margin-left:66.6666666667%}.push-t-9{margin-left:75%}.push-t-10{margin-left:83.3333333333%}.push-t-11{margin-left:91.6666666667%}.push-t-12{margin-left:100%}.pull-t-0{margin-right:0%}.pull-t-1{margin-right:8.3333333333%}.pull-t-2{margin-right:16.6666666667%}.pull-t-3{margin-right:25%}.pull-t-4{margin-right:33.3333333333%}.pull-t-5{margin-right:41.6666666667%}.pull-t-6{margin-right:50%}.pull-t-7{margin-right:58.3333333333%}.pull-t-8{margin-right:66.6666666667%}.pull-t-9{margin-right:75%}.pull-t-10{margin-right:83.3333333333%}.pull-t-11{margin-right:91.6666666667%}.pull-t-12{margin-right:100%}}@media (max-width: 576px){.col-m-0{width:0%}.col-m-1{width:8.3333333333%}.col-m-2{width:16.6666666667%}.col-m-3{width:25%}.col-m-4{width:33.3333333333%}.col-m-5{width:41.6666666667%}.col-m-6{width:50%}.col-m-7{width:58.3333333333%}.col-m-8{width:66.6666666667%}.col-m-9{width:75%}.col-m-10{width:83.3333333333%}.col-m-11{width:91.6666666667%}.col-m-12{width:100%}.push-m-0{margin-left:0%}.push-m-1{margin-left:8.3333333333%}.push-m-2{margin-left:16.6666666667%}.push-m-3{margin-left:25%}.push-m-4{margin-left:33.3333333333%}.push-m-5{margin-left:41.6666666667%}.push-m-6{margin-left:50%}.push-m-7{margin-left:58.3333333333%}.push-m-8{margin-left:66.6666666667%}.push-m-9{margin-left:75%}.push-m-10{margin-left:83.3333333333%}.push-m-11{margin-left:91.6666666667%}.push-m-12{margin-left:100%}.pull-m-0{margin-right:0%}.pull-m-1{margin-right:8.3333333333%}.pull-m-2{margin-right:16.6666666667%}.pull-m-3{margin-right:25%}.pull-m-4{margin-right:33.3333333333%}.pull-m-5{margin-right:41.6666666667%}.pull-m-6{margin-right:50%}.pull-m-7{margin-right:58.3333333333%}.pull-m-8{margin-right:66.6666666667%}.pull-m-9{margin-right:75%}.pull-m-10{margin-right:83.3333333333%}.pull-m-11{margin-right:91.6666666667%}.pull-m-12{margin-right:100%}}.animate{animation:animateElement cubic-bezier(0.3, 0.45, 0.45, 0.95) 0.75s;animation-duration:0.5s;animation-iteration-count:1;transition:transform .15s}@keyframes animateElement{0%{transform:translate(0px, 50px)}100%{transform:translate(0px, 0px)}}@keyframes pulse{0%{transform:scale(1, 1)}25%{transform:scale(1, 1)}50%{transform:scale(1.2, 1.2)}100%{transform:scale(1, 1)}}*,*::after,*::before{box-sizing:border-box}body{font-family:"Nanum Gothic Coding",monospace;font-size:16px;line-height:1.5;overflow-x:hidden;color:var(--text-color);letter-spacing:-0.4px;background-color:var(--background-color);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}@media only screen and (max-width: 576px){body{font-size:18px}}*::selection{color:var(--text-color);background-color:var(--drag-background-color)}h1,h2,h3,h4,h5,h6{font-family:"Noto Sans","Apple SD Gothic Neo","맑은 고딕","Malgun Gothic","돋움",dotum,sans-serif;font-weight:700;line-height:1.3;letter-spacing:-1px;color:var(--heading-font-color)}h1{font-size:36px;font-family:"Gowun Batang", serif}h2{font-family:"Stylish", sans-serif;font-size:32px;font-weight:500}h3{font-size:20px}h4{font-size:18px}h5{font-size:16px}h6{font-size:14px}blockquote{position:relative;margin:40px 0;padding-left:26px;font-size:22px;line-height:1.4}blockquote p{padding-left:24px;padding-top:10px;color:var(--quote-font-color);font-family:"Kalam", cursive;font-weight:400}blockquote cite{display:block;margin-top:8px;font-size:14px;font-weight:700;font-style:normal;color:var(--heading-font-color)}@media only screen and (max-width: 576px){blockquote{font-size:21px}}blockquote::before{content:"\f10d";font-size:32px;color:#ccc;font-family:FontAwesome;font-style:normal;font-weight:normal;text-decoration:inherit;text-align:center;position:absolute;left:0;top:0}pre{overflow:auto;padding:15px;margin-bottom:0;font-size:14px;word-wrap:break-word;word-break:break-all;color:lightgrey}img,.lightense-wrap{max-width:100%;height:auto;vertical-align:middle}img+em,.lightense-wrap+em,.gallery+em{display:block;margin-top:20px;font-size:12px;line-height:22px;font-style:normal;font-weight:normal;text-align:center;color:var(--heading-font-color)}img+em a,.lightense-wrap+em a,.gallery+em a{font-weight:500;border-bottom:1px solid var(--border-color);transition:all 0.35s}img+em a:hover,.lightense-wrap+em a:hover,.gallery+em a:hover{color:var(--link-color);border-color:var(--link-color-hover)}@media only screen and (max-width: 576px){img+em,.lightense-wrap+em,.gallery+em{margin-top:12px}}a{text-decoration:none;color:var(--link-color);transition:all 0.35s}a:hover{color:var(--link-color-hover)}p>a{font-weight:900;text-decoration-line:underline}hr{width:100%;height:1px;margin:60px 0;border:0;background:var(--text-color)}.table-container{display:block;max-width:100%;overflow-x:auto}table{font-size:12px;color:var(--dark);width:100%;border-width:1px;border-color:var(--background-alt-color);border-collapse:collapse;color:var(--heading-font-color)}table th{padding:10px;font-size:16px;text-align:left;border:1.5px solid var(--background-alt-color);color:var(--heading-font-color);font-weight:700;background-color:var(--th-color)}table tr{background-color:var(--tr-color);transition:all 0.3s ease}table td{padding:10px;font-size:14px;background-color:var(--td-color);border:1px solid var(--background-alt-color)}.button{display:inline-block;padding:20px 26px;font-size:16px;font-weight:700;text-decoration:none;border-radius:2px;border:none;outline:none;cursor:pointer;transition:all 0.25s;color:var(--heading-font-color);background:var(--background-alt-color)}.button--primary{color:var(--white);background-color:var(--button-background-color)}.button--primary:hover{background:var(--button-background-hover)}.button--big{display:block;width:100%}.lazy{opacity:0;transition:opacity 0.3s ease-in-out}.lazy.loaded{opacity:1}.lightense-backdrop{background-color:var(--background-color) !important}code.language-plaintext.highlighter-rouge{font-family:"Roboto Mono", monospace;font-size:13.6px;background-color:var(--article-highlighing-background);border-radius:0.1em;padding-left:0.1em;padding-right:0.1em;color:var(--article-highlighing-font)}.portfolio_img{width:10%;text-align:center;margin-bottom:30px;padding-left:3%;padding-right:3%;background-color:#d4442e}.point_heading{font-family:"Gowun Batang",serif}#top{background-color:var(--top-background);font:white;top:0;left:0;width:100%;position:fixed;z-index:1}.header .header__inner{position:relative;display:flex;align-items:center;flex-wrap:wrap}.logo__link{padding:4px 0;font-family:"Noto Sans","Apple SD Gothic Neo","맑은 고딕","Malgun Gothic","돋움",dotum,sans-serif;font-size:28px;letter-spacing:-1px;line-height:1;font-weight:700;transition:color .25s ease;color:white}.logo__link:hover{color:var(--brand-color)}.logo__image{max-height:75px}.main-nav{margin-left:auto}@media only screen and (max-width: 1024px){.main-nav{position:fixed;top:0;left:0;right:0;bottom:0;z-index:100;opacity:0;visibility:hidden;background-color:var(--background-color)}.main-nav.is-open{opacity:1;visibility:visible;transition:all .25s ease;background-color:#728f39}.main-nav .nav__list{flex-direction:column;width:100%}.main-nav .nav__list .nav__item{display:block;margin:0}.main-nav .nav__list .nav__item.nav__item-icon{margin-right:0}.main-nav .nav__list .nav__item .nav__link{display:inline-block;padding:16px 0;font-size:18px;transition:color .25s ease}.main-nav .nav__list .nav__item .nav__link:hover{color:var(--brand-color)}}.main-nav__box{display:flex;align-items:center}.main-nav__box .nav__icon-close{display:none;justify-content:center;align-items:center;width:36px;height:36px;font-size:24px;line-height:1;border-radius:50%;color:var(--heading-font-color);background:var(--background-alt-color);cursor:pointer}.main-nav__box .nav__icon-close:hover .ion-md-close{transform:rotate(90deg)}.main-nav__box .nav__icon-close .ion-md-close{transition:all 0.35s}.main-nav__box .nav__title{display:none}@media only screen and (max-width: 1024px){.main-nav__box{display:block;align-items:center;width:80%;height:80vh;padding-top:180px;margin:0 auto;text-align:center;overflow-y:auto}.main-nav__box .nav__icon-close{display:flex;position:absolute;top:40px;right:40px}.main-nav__box .nav__title{display:inline-block;margin-bottom:12px;font-family:"Noto Sans", "Apple SD Gothic Neo", "맑은 고딕", "Malgun Gothic", "돋움", dotum, sans-serif;font-size:36px;font-weight:700;letter-spacing:-1px;color:var(--heading-font-color)}}@media only screen and (max-width: 768px){.main-nav__box{padding-top:100px}}.nav__list{display:flex;align-items:center}.nav__list .nav__item{display:inline-block;margin-right:48px;margin-bottom:0}.nav__list .nav__item.nav__item-icon{margin-right:12px}.nav__list .nav__item .nav__link{position:relative;padding:4px 0;font-size:20px;line-height:1;font-weight:700;transition:color .25s ease;color:lightgrey}.nav__list .nav__item .nav__link:hover{color:indianred;text-decoration:underline}.nav-button{font-size:21px;color:var(--link-color);cursor:pointer}.nav-button .icon__menu{display:none;margin-right:12px}.nav-button .icon__menu,.nav-button .icon__search{transition:color .25s ease;color:lightgrey}.nav-button .icon__menu:hover,.nav-button .icon__search:hover{color:indianred}@media only screen and (max-width: 1024px){.nav-button{display:flex;align-items:center;margin-left:auto;font-size:24px}.nav-button .icon__menu{display:block}}.toggle-theme{position:relative;display:flex;justify-content:center;align-items:center;width:24px;height:24px;user-select:none;cursor:pointer}@media only screen and (max-width: 1024px){.toggle-theme{padding:20px 0}}.toggle-sun,.toggle-moon{position:absolute;font-size:20px;transition:color .25s ease;color:lightgrey}.toggle-sun:hover,.toggle-moon:hover{color:indianred}.toggle-sun{display:none}.dark-mode .toggle-sun{display:block}.dark-mode .toggle-moon{display:none}.search{position:fixed;top:0;left:0;right:0;bottom:0;z-index:-1;overflow:auto;opacity:0;background:var(--background-color);transition:all .25s ease}.search.is-visible{z-index:100;opacity:1;transition:all .25s ease}.search__box{max-width:540px;margin:0 auto;padding-top:120px}@media only screen and (max-width: 1024px){.search__box{padding-top:100px}}.search__group{position:relative;margin-bottom:48px}.search__group .search__close{position:absolute;right:28px;top:50%;transform:translateY(-50%);display:flex;align-items:center;justify-content:center;width:32px;height:32px;font-size:24px;line-height:1;border-radius:50%;color:var(--heading-font-color);cursor:pointer;will-change:transform;transition:all .25s;background:var(--background-color)}.search__group .search__close:hover{transform:translateY(-50%) rotate(90deg)}.search__group .search__close .ion-md-close{vertical-align:middle}.search__group .search__text{width:100%;padding:28px;font-size:20px;font-weight:700;line-height:24px;border:2px solid transparent;border-radius:2px;color:var(--heading-font-color);background-color:#d3d1d1;outline:0;transition:all .25s}.search__group .search__text::placeholder{font-weight:700;color:var(--heading-font-color)}.search__group .search__text:focus{border-color:var(--brand-color)}.search__group .search__text::-ms-clear{display:none}@media only screen and (max-width: 576px){.search__group{margin-bottom:32px}.search__group .search__text{padding:24px}}.search-results-list .no-results{width:100%;margin:0;text-align:center;color:var(--heading-font-color)}.pagination{margin-bottom:80px}@media only screen and (max-width: 576px){.pagination{margin-bottom:60px}}.pagination__inner{display:flex;justify-content:center;align-items:center}.pagination__list{display:flex;justify-content:space-between;align-items:center;width:100%;font-size:18px;font-weight:700;line-height:1;color:var(--text-color)}@media only screen and (max-width: 576px){.pagination__list{align-items:stretch;font-size:16px}}.pagination__item{font-size:20px;font-family:"Gowun Batang", serif;display:flex;justify-content:center;align-items:center;width:100%;padding:24px 20px;text-align:center;border-radius:8px;background:var(--pagination-item);margin-top:0.3em}@media only screen and (max-width: 576px){.pagination__item{align-items:center;padding:20px;border-radius:8px}}.pagination__count{margin:0 32px;font-size:16px;color:var(--link-color)}@media only screen and (max-width: 768px){.pagination__count{margin:0 12px}}@media only screen and (max-width: 576px){.pagination__count{margin:0 8px;font-size:14px;line-height:1.2}}.pagination__next:hover,.pagination__prev:hover{color:var(--heading-font-color);background-color:var(--article-highlighing-background)}.pagination__next i,.pagination__prev i{font-size:15px;transition:transform 0.15s ease;will-change:transform}.pagination__next.disabled,.pagination__prev.disabled{opacity:0.64;cursor:not-allowed;color:inherit}.pagination__next.disabled:hover i,.pagination__prev.disabled:hover i{transform:none}.dark-mode .pagination__next.disabled,.dark-mode .pagination__prev.disabled{opacity:0.78}.pagination__next:hover i{transform:translateX(2px)}.pagination__next i{margin-left:5px}.pagination__prev:hover i{transform:translateX(-2px)}.pagination__prev i{margin-right:5px}.prev_next{font-size:20px;font-family:"Kalam", cursive;color:var(--strong-font-color);font-weight:bold}.footer{margin-top:48px;background-color:var(--background-alt-color)}@media only screen and (max-width: 576px){.footer{margin-top:60px}}.footer__inner{padding:80px 0}.footer__inner .row .col{flex-grow:1}@media only screen and (max-width: 576px){.footer__inner{padding:60px 0}}@media only screen and (max-width: 1024px){.footer__author{margin-bottom:60px}}@media only screen and (max-width: 576px){.footer__author{margin-bottom:40px}}.footer__author-avatar{position:relative;width:105px;height:105px;margin-bottom:20px;transform:translate(0);border-radius:50%;overflow:hidden;box-shadow:0px 100px 80px rgba(0,0,0,0.07),0px 12.5216px 10.0172px rgba(0,0,0,0.035);background-color:var(--background-color)}.footer__author-avatar img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;user-select:none}.footer__author-name{margin-bottom:20px;font-size:32px;font-weight:900;line-height:1;color:var(--text-alt-color)}.footer__author-bio{margin-bottom:0;color:var(--text-alt-color)}.social{margin-top:16px}.social .social__list{display:flex;align-items:center;flex-wrap:wrap}.social .social__list .social__item:first-child>.social__link{padding-left:0}.social .social__item{margin-bottom:0;margin-right:16px}.social .social__item:last-child{margin-right:0}.social .social__link{display:flex;align-items:center;padding:4px;font-size:20px;color:var(--text-alt-color)}.social .social__link:hover{color:var(--brand-color)}.footer__gallery .footer__gallery-title{margin-bottom:24px;font-size:28px}.footer__gallery .gallery__image img{height:100%;border-radius:8px;overflow:hidden}.footer__gallery .gallery__image img.lightense-open{border-radius:0}.footer__info{padding:44px 0;background-color:var(--background-color)}.footer__info .footer__info-box{display:flex;align-items:center;justify-content:space-between}@media only screen and (max-width: 1024px){.footer__info{padding:40px 0}}.copyright{margin-right:20px;font-size:14px;font-weight:500;color:var(--text-alt-color)}.copyright a{text-decoration:underline;text-decoration-color:transparent;color:var(--heading-font-color)}.copyright a:hover{text-decoration-color:var(--heading-font-color);color:var(--heading-font-color)}.top{min-width:36px;height:36px;font-size:20px;line-height:36px;text-align:center;border-radius:8px;color:white;background-color:var(--background-alt-color);cursor:pointer;position:fixed;bottom:0.7em;right:0.7em}.gallery-box{margin:32px 0}.gallery{display:grid;grid-template-columns:repeat(3, auto);justify-content:center;align-content:center;grid-gap:10px}.gallery .gallery__image{background:var(--background-color)}.gallery .gallery__image img{display:block;width:100%;height:auto;object-fit:cover}.hero{padding-top:100px;padding-bottom:80px;margin-bottom:80px;background-color:var(--background-alt-color)}.hero__inner{display:flex;align-items:center}@media only screen and (max-width: 1024px){.hero__inner{flex-direction:column}}.hero__left{max-width:450px;margin-right:auto}@media only screen and (max-width: 1140px){.hero__left{max-width:440px}}@media only screen and (max-width: 1024px){.hero__left{max-width:100%}}.hero__title{font-family:'Tangerine', cursive;margin-bottom:20px;font-size:120px;font-weight:400;line-height:1.3;color:var(--text-alt-color)}@media only screen and (max-width: 1024px){.hero__title{font-size:50px}}@media only screen and (max-width: 768px){.hero__title{font-size:40px}}@media only screen and (max-width: 576px){.hero__title{font-size:32px}}.hero__description{margin-bottom:0;font-size:21px;color:var(--text-alt-color)}@media only screen and (max-width: 1024px){.hero__description{font-size:inherit}}.hero__subscribe{margin-top:32px}.hero__subscribe .subscribe-form{position:relative;border-radius:2px;background-color:var(--background-color)}.hero__subscribe .subscribe-email{width:100%;height:70px;padding:20px;font-size:16px;line-height:21px;border:2px solid transparent;border-radius:2px;outline:0;color:var(--heading-font-color);background-color:transparent;transition:all .25s ease}.hero__subscribe .subscribe-email::placeholder{opacity:0.6;color:var(--text-alt-color)}.hero__subscribe .subscribe-email:focus{border-color:var(--brand-color)}.hero__subscribe .subscribe-button{position:absolute;top:6px;right:6px}@media only screen and (max-width: 1024px){.hero__subscribe{margin-top:24px}}@media only screen and (max-width: 576px){.hero__subscribe{margin-top:20px}.hero__subscribe .subscribe-form{display:flex;flex-direction:column;padding:6px}.hero__subscribe .subscribe-email{height:56px;margin-bottom:4px}.hero__subscribe .subscribe-button{position:relative;top:0;right:0}}.hero__right{width:50%}@media only screen and (max-width: 1024px){.hero__right{width:100%;margin-top:40px}}@media only screen and (max-width: 576px){.hero__right{margin-top:32px}}.hero__image{position:relative;transform:translate(0);width:100%;height:410px;border-radius:8px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.02);background-color:var(--background-color);user-select:none}.hero__image img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover}@media only screen and (max-width: 1140px){.hero__image{height:380px}}@media only screen and (max-width: 1024px){.hero__image{height:440px}}@media only screen and (max-width: 768px){.hero__image{height:420px}}@media only screen and (max-width: 576px){.hero__image{height:280px}}.article{margin-bottom:32px;will-change:transform;transition:transform .2s}.article:hover{transform:translateY(-3px)}.article:hover .article__title a{text-decoration:underline;text-decoration-color:var(--link-color-hover);text-decoration-thickness:2px}.article__head{position:relative}.article__date{position:absolute;z-index:1;top:16px;left:16px;display:inline-block;padding:8px 12px;font-size:12px;line-height:1;font-weight:500;border-radius:4px;color:var(--heading-font-color);background:var(--background-color);pointer-events:none}.article__image{position:relative;transform:translate(0);display:block;height:0;margin-bottom:24px;padding-bottom:62%;overflow:hidden;background:var(--background-alt-color)}.article__image img{position:absolute;width:100%;height:100%;object-fit:cover;user-select:none}.video-icon{position:absolute;z-index:1;top:50%;left:50%;width:50%;height:50%;transform:translate(-50%, -50%);pointer-events:none}.video-icon .circle{width:50px;height:50px;position:absolute;top:0;left:0;right:0;bottom:0;border-radius:50%;overflow:hidden;margin:auto;transform:scale(1, 1)}.video-icon .circle.pulse{animation-timing-function:ease;animation:pulse 2s infinite;background-color:rgba(255,255,255,0.25)}.video-icon svg{fill:rgba(255,255,255,0.25);stroke:var(--light-blue);stroke-linejoin:round;stroke-width:5;backdrop-filter:blur(3.5px);-webkit-backdrop-filter:blur(4.5px);transition:all 0.3s}.article__title{margin-bottom:12px;margin-left:10px;margin-right:10px;text-align:center;font-family:"Gowun Batang",serif;font-size:20px;font-weight:lighter}.article__title a{text-decoration:underline;text-decoration-color:transparent;text-decoration-thickness:2px}.article__title a:hover{color:var(--heading-font-color)}.article__excerpt{margin-bottom:0;font-size:16px;margin-left:10px;margin-right:10px;color:var(--text-alt-color);text-align:center}.article__inner{background-color:var(--article__inner-background)}.portfolio_wrapper{display:grid;background-color:var(--article__inner-background);grid-template-columns:repeat(9, 1fr);grid-template-rows:20vw;margin-bottom:5vw;overflow:hidden}.portfolio_image{grid-column:span 3}.portfolio_content{grid-column:span 6;margin-left:1em;font-size:calc(5px + 1vw);text-align:left}.portfolio_title{font-family:"Gowun Batang",serif;font-size:calc(10px + 1.1vw);font-weight:bold}.portfolio_content_row{margin-bottom:0.2em;color:var(--text-alt-color)}.portfolio__page__title{margin-top:150px;font-family:"Gowun Batang",serif}.contact-head{margin-bottom:32px}.form__group{margin-bottom:20px}.form__group:last-child{margin-bottom:0}.form__input{width:100%;padding:20px;font-size:16px;font-weight:400;border:2px solid var(--border-color);border-radius:2px;outline:0;transition:.25s ease-in-out;resize:vertical;color:var(--light-gray);background-color:var(--background-alt-color)}.form__input::placeholder{color:var(--text-alt-color)}.form__input:focus{border-color:var(--brand-color)}.section__head{position:relative;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:40px}.section__head::after{content:"";position:absolute;z-index:-1;display:block;width:100%;height:1px;background:var(--background-alt-color);pointer-events:none}@media only screen and (max-width: 768px){.section__head::after{content:none}}.section__title{padding-right:20px;margin-bottom:0;font-size:28px}@media only screen and (max-width: 576px){.section__title{font-size:24px}}.section__link{padding-left:20px;font-size:18px;font-weight:500;text-decoration:underline;text-decoration-color:transparent;color:var(--link-color);transition:text-decoration .35s}.section__link:hover{text-decoration-color:var(--heading-font-color);color:var(--link-color-hover)}@media only screen and (max-width: 768px){.section__link{padding-left:0}}@media only screen and (max-width: 576px){.section__link{font-size:16px}}.section__title,.section__link{background:var(--background-color)}@media only screen and (max-width: 576px){.section-tags .row .col:last-child>.tag-image{margin-bottom:0}}.tag-image{margin-bottom:32px;position:relative;transform:translate(0);display:block;height:0;padding-bottom:62%;border-radius:8px;overflow:hidden;background:var(--background-alt-color);transition:transform .2s}.tag-image:hover{transform:translateY(-3px)}.tag-image img{position:absolute;width:100%;height:100%;object-fit:cover;user-select:none}.tag-image .tag-name{position:absolute;top:2%;right:2%;z-index:1;max-width:90%;display:inline-block;padding:8px 8px;font-size:1.6rem;line-height:1;font-weight:700;text-transform:capitalize;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-radius:4px;color:white;pointer-events:none}.post-head,.page-head{margin-bottom:48px;padding-top:80px}.post-head .row,.page-head .row{align-items:center}@media only screen and (max-width: 1024px){.post-head,.page-head{margin-bottom:40px}}@media only screen and (max-width: 576px){.post-head,.page-head{margin-bottom:32px}}.post-image,.page-image{position:relative;transform:translate(0);padding-top:90%;min-height:100px;border-radius:8px;overflow:hidden;background:var(--background-alt-color);margin-top:60px}.post-image img,.page-image img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;user-select:none}@media only screen and (max-width: 1024px){.post-image,.page-image{padding-top:65%;margin-bottom:40px}}@media only screen and (max-width: 576px){.post-image,.page-image{margin-bottom:32px}}.page-image{padding-top:56.25%;margin-bottom:48px}@media only screen and (max-width: 1024px){.page-image{margin-bottom:40px}}@media only screen and (max-width: 576px){.page-image{margin-bottom:32px}}.post-video,.page-video{margin-bottom:48px;border-radius:8px;overflow:hidden;transform:translate(0);background-color:var(--th-color)}.post-video .post-video__wrap,.post-video .page-video__wrap,.page-video .post-video__wrap,.page-video .page-video__wrap{position:relative;width:100%;height:0;padding-bottom:56.25%}.post-video .post-video__wrap iframe,.post-video .page-video__wrap iframe,.page-video .post-video__wrap iframe,.page-video .page-video__wrap iframe{position:absolute;top:0;left:0;width:100%;height:100%}@media only screen and (max-width: 1024px){.post-video,.page-video{margin-bottom:40px}}@media only screen and (max-width: 576px){.post-video,.page-video{margin-bottom:32px}}.post__info{margin-left:44px}.post__info.post__info-video{max-width:760px;margin:0 auto}@media only screen and (max-width: 1024px){.post__info{margin-left:0}}.page__info{max-width:760px;margin:0 auto}.post__tags{display:flex;align-items:center;flex-wrap:wrap;margin-bottom:20px}.post__tags .post__tag{padding:12px 16px;margin:4px 8px 4px 0;font-size:14px;line-height:1;font-weight:500;text-transform:capitalize;border:none;border-radius:8px;color:var(--heading-font-color);transition:none;background-color:var(--pagination-item)}.post__tags .post__tag:hover{color:indianred}.post__tags .post__tag:last-child{margin-right:0}@media only screen and (max-width: 576px){.post__tags{margin-bottom:16px}}.post__title,.page__title{margin-bottom:24px;font-size:46px;line-height:1.2;font-weight:500}@media only screen and (max-width: 576px){.post__title,.page__title{margin-bottom:20px;font-size:32px}}.page__title{margin-bottom:0;font-family:"Gowun Batang",serif}.post__meta{display:flex;align-items:center;line-height:1}.post__meta .post__author-image{position:relative;transform:translate(0);width:50px;height:50px;border-radius:50%;overflow:hidden;margin-right:12px;background-color:var(--th-color)}.post__meta .post__author-image img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;user-select:none}.post__meta .post__meta-bottom{display:flex;flex-direction:column}.post__meta .post__author{display:inline-block;margin-bottom:7px;font-size:16px;font-weight:500;text-decoration:underline;text-decoration-color:transparent;color:var(--heading-font-color);transition:text-decoration-color 0.35s}.post__meta .post__author:hover{text-decoration-color:var(--heading-font-color)}.post__meta .post__date{font-size:14px;font-weight:400;color:var(--text-alt-color)}.post,.page{max-width:760px;margin:0 auto 60px;color:var(--text-color)}.post a,.page a{font-weight:500;border-bottom:1px solid var(--border-color)}.post a:hover,.page a:hover{color:var(--link-color);border-bottom-color:var(--link-color-hover)}.post img,.post .js-reframe,.page img,.page .js-reframe{overflow:hidden}.post img.lightense-open,.post .js-reframe.lightense-open,.page img.lightense-open,.page .js-reframe.lightense-open{border-radius:0}.post img[src$="#wide"],.page img[src$="#wide"]{display:block;width:100vw;max-width:none;margin-left:50%;transform:translateX(-50%);border-radius:0;pointer-events:none;user-select:none}.post .button,.page .button{border:none;text-decoration:none}.post__share .share__list{display:flex;align-items:center;width:100%}.post__share .share__item{width:25%;margin-right:8px;margin-bottom:0;text-align:center}.post__share .share__item:last-child{margin-right:0}.post__share .share__link{display:flex;justify-content:center;align-items:center;width:100%;height:54px;font-size:18px;text-transform:uppercase;border:none;border-radius:8px;background:var(--th-color)}.post__share .share__link i{transition:transform 0.25s;will-change:transform}.post__share .share__link:hover{color:var(--heading-font-color)}.post__share .share__link:hover i{transform:scale(1.1)}.related-posts{display:none;margin-top:80px}.related-posts.is-related{display:block}.related-posts .related-tag{text-transform:capitalize}@media only screen and (max-width: 576px){.related-posts{margin-top:60px}.related-posts .row .col:last-child{margin-bottom:0}}.show-comments{margin:48px 0 32px;text-align:center}.show-comments .disqus-button{padding:28px;border-radius:8px;text-decoration:underline;text-decoration-color:transparent;background:var(--th-color)}.show-comments .disqus-button:hover{text-decoration-color:var(--heading-font-color)}@media only screen and (max-width: 576px){.show-comments{margin:60px 0 0}.show-comments .disqus-button{padding:24px}}.post__comments{max-width:760px;margin:0 auto}.post__comments.is-open{margin:0 auto 32px}@media only screen and (max-width: 576px){.post__comments.is-open{margin:0 auto}}.error{text-align:center}.error .error__title{margin-bottom:24px;font-size:100px;line-height:1}.error .error__text{margin-bottom:0;color:var(--text-alt-color)}@media only screen and (max-width: 576px){.error .error__title{font-size:68px}}.recent-posts{margin-top:80px}@media only screen and (max-width: 576px){.recent-posts{margin-top:60px}.recent-posts .row .col:last-child{margin-bottom:0}}.post_tag_list{font-family:"Shadows Into Light", cursive;font-size:16px;border-radius:4px;background-color:var(--post-tag-list-background-color);color:var(--article-highlighing-font);padding-right:2px;padding-left:2px}.post_category_list{font-family:"Shadows Into Light", cursive;font-size:16px;border-radius:4px;background-color:var(--post-category-list-background-color);color:var(--article-highlighing-font);padding-right:2px;padding-left:2px}#markdown-toc li{font-size:15px;line-height:18px}#markdown-toc li>ul{font-size:12px;line-height:30px}.post__title{font-family:"Gowun Batang",serif}.toc{font-family:"Tangerine", cursive;color:gold;background-color:#9acaa5;border-radius:0.5}.toc .nav__title{color:#fff;font-size:1em;background:gray}.toc .active a{background-color:greenyellow}.toc__menu{margin:0;padding:0;width:100%;list-style:none;font-size:0.5em}.page__content .archive__item-title{margin-top:0.5em;border-bottom:none}.sidebar__right{margin-bottom:0.5em;position:sticky;top:0;right:0;width:100%}.fire-para{border-radius:2px;border-left:4px solid #00bfa5;margin-top:30px;margin-bottom:50px;margin-left:20px;margin-right:30px}.fire-bar{background-color:rgba(0,191,165,0.1);border:0.5px solid #e9e6e6;font-weight:600;font-size:15.2px;padding-left:20px;padding-top:7px;padding-bottom:7px}.fa-fire{color:#00bfa5;margin-right:5px}.fa-hammer{color:#005bd1;margin-right:5px}.fa-question{color:#00bfa5;margin-right:5px}.fire-content{border-right:0.5px solid #e9e6e6;border-bottom:0.5px solid #e9e6e6;padding-left:13px;padding-top:13px;padding-bottom:10px;font-size:14.4px}.pen-para{border-radius:2px;border-left:4px solid #448aff;margin-top:30px;margin-bottom:50px;margin-left:20px;margin-right:30px}.pen-bar{background-color:rgba(68,138,255,0.1);border:0.5px solid #e9e6e6;font-weight:600;font-size:15.2px;padding-left:20px;padding-top:7px;padding-bottom:7px}.fa-pen{color:#005bd1;margin-right:5px}.pen-content{border-right:0.5px solid #e9e6e6;border-bottom:0.5px solid #e9e6e6;padding-left:13px;padding-top:13px;padding-bottom:10px;font-size:14.4px}.tag__head{margin-top:150px}@media only screen and (max-width: 1024px){.tag__head{margin:40px 0}}.tags__inner{margin-bottom:90px}@media only screen and (max-width: 576px){.tags__inner{margin-bottom:60px}}.tag__title{margin-bottom:32px;font-size:46px;font-weight:600;font-family:"Gowun Batang",serif}@media only screen and (max-width: 576px){.tag__title{font-size:32px}}.tag__list{display:flex;align-items:center;flex-wrap:wrap;padding-bottom:80px}.tag__list .tag__item{margin-right:12px;margin-bottom:12px}.tag__list .tag__item:last-child{margin-right:0}.tag__list .tag__link{display:block;padding:12px 16px;font-size:16px;font-weight:500;text-transform:capitalize;border-radius:8px;transition:none;background:var(--th-color)}.tag__list .tag__link:hover{color:var(--heading-font-color)}@media only screen and (max-width: 576px){.tag__list{padding-bottom:48px}.tag__list .tag__item{margin-right:8px;margin-bottom:8px}.tag__list .tag__link{font-size:14px}}.tag__info{position:relative;display:flex;align-items:center;justify-content:space-between;margin-bottom:4px}.tag__info::after{content:"";position:absolute;z-index:-1;display:block;width:100%;height:1px;background:var(--th-color);pointer-events:none}@media only screen and (max-width: 576px){.tag__info::after{content:none}}.tag__info-box{display:flex;align-items:center}.tag__counter{display:flex;flex-direction:column;align-items:center;padding:12px 24px;border-radius:8px;color:var(--heading-font-color);background:var(--pagination-item)}.tag__counter span{font-family:"Noto Sans","Apple SD Gothic Neo","맑은 고딕","Malgun Gothic","돋움",dotum,sans-serif;font-size:32px;font-weight:700;line-height:1}.tag__counter small{font-size:16px;font-weight:500}@media only screen and (max-width: 576px){.tag__counter{display:none}}.tag__name{padding:50px 20px 50px 20px;margin-bottom:0;font-size:36px;text-transform:capitalize;background-color:var(--background-color);font-family:"Gowun Batang",serif}.tag__name span{font-weight:400;color:var(--text-alt-color)}@media only screen and (max-width: 768px){.tag__name{font-size:32px}}@media only screen and (max-width: 576px){.tag__name{padding:32px 12px 32px 0;font-size:26px}}.top__link{padding-left:20px;font-size:18px;font-weight:500;text-decoration:underline;text-decoration-color:transparent;color:var(--link-color);transition:text-decoration 0.35s;background:var(--background-color)}.top__link:hover{text-decoration-color:var(--heading-font-color);color:var(--link-color-hover)}@media only screen and (max-width: 576px){.top__link{padding-left:0;font-size:16px}}.tag__box{display:flex;align-items:center;margin-top:120px}.tag_list{display:block;padding:12px 16px;font-size:16px;font-weight:500;text-transform:capitalize;border-radius:8px;transition:none;background:var(--th-color)}.tag_list:hover{color:indianred}.tag__box_recent_posts{display:flex;align-items:center}

  </style>
</head>

<body>

  

  <head>
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display&display=swap" rel="stylesheet">
</head>
<!-- begin header -->
<header class="header" id="top">
  <div class="container">
    <div class="row">
      <div class="header__inner col col-12">

        <div class="logo">
          <a class="logo__link" href="/">
          
            <img class="logo__image" src="/images/code_museum_logo.png" alt="Code Museum">
          
          </a>
        </div>

        <nav class="main-nav">
          <div class="main-nav__box">
            <div class="nav__icon-close">
              <i class="ion ion-md-close"></i>
            </div>
            <div class="nav__title">Menu</div>
            <ul class="nav__list list-reset">
              <li class="nav__item">
                <a href="/about" class="nav__link">About</a>
              </li>
              <li class="nav__item">
                <a href="/categories" class="nav__link">Categories</a>
              </li>
              <li class="nav__item">
                <a href="/tags" class="nav__link">Tags</a>
              </li>
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  <li class="nav__item">
                    <a href="/deviation/" class="nav__link">Deviation</a>
                  </li>
                  
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
                  
                  <li class="nav__item">
                    <a href="/gallery/" class="nav__link">Gallery</a>
                  </li>
                  
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
                
              
              
              <li class="nav__item nav__item-icon">
                <div class="toggle-theme">
                  <div class="toggle-moon" title="Enable dark mode"><i class="ion ion-ios-moon"></i></div>
                  <div class="toggle-sun" title="Enable light mode"><i class="ion ion-ios-sunny"></i></div>
                </div>
              </li>
              
            </ul>
          </div>
        </nav>

        <div class="nav-button">
          <i class="nav__icon icon__menu ion ion-md-menu"></i>
          <i class="nav__icon icon__search ion ion-md-search"></i>
        </div>

      </div>
    </div>
  </div>
</header>
<!-- end header -->

<!-- begin search -->
<div class="search">
  <div class="container">
    <div class="row">
      <div class="col col-12">
        <div class="search__box">
          <div class="search__group">
            <div class="search__close">
              <i class="ion ion-md-close"></i>
            </div>
            <label for="js-search-input" class="screen-reader-text">Search for Blog</label>
            <input type="text" id="js-search-input" class="search__text" autocomplete="off" placeholder="Type to search...">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="row search-results-list" id="js-results-container"></div>
  </div>

</div>
<!-- end search -->

  <!-- begin content -->
  <main class="content" aria-label="Content">
    <!-- HTML elements for search -->
    <input type="text" id="search-input" placeholder="Search blog posts..">
    <ul id="results-container"></ul>

    <!-- or without installing anything -->
    <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
    <head>
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Shadows+Into+Light&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Stylish&display=swap" rel="stylesheet">
</head>






<div class="post-head">
  <div class="container">
    <div class="row">
      
      

      
      <div class="col col-5 col-d-12">
        <div class="post-image">
          <img class="lazy" data-src="/images/spark_logo.png" alt="Apache Pyspark Series [Part8]: PySpark Structured Streaming (3) Operations and Watermark">
        </div>
      </div>
      

      
      
      
      <div class="col col-7 col-d-12">
        <div class="post__info ">
            
              <div class="post__tags">
                
                  <a href="/Spark" class="post__tag">#Spark</a>
                
                
                  <a href="/data_engineering" class="post__tag">#data_engineering</a>
                
              </div>
            
 
          <h1 class="post__title">Apache Pyspark Series [Part8]: PySpark Structured Streaming (3) Operations and Watermark</h1>
  
          <div class="post__meta">
            <a href="/about/" class="post__author-image">
              <img class="lazy" data-src="/images/zepeto_me.jpeg" alt="Jay Kim">
            </a>

            <div class="post__meta-bottom">
              <a class="post__author" href="/about/">Jay Kim</a>
              <time class="post__date" datetime="2022-04-17T21:01:35+09:00">17 Apr 2022</time>
            </div>
          </div>
  
        </div>
      </div>
    </div>
  </div>
</div>

<!-- begin post -->
<div class="container_post animate">

  

    <div class="post__content">
      
<!--첫 번째 문단-->



  
  	
  	
  	
  	
  	

<!--두 번째 문단-->


  <div class="post_pagination">
    
      <a href="/pyspark-series7" class="pagination__prev pagination__item"><i class="ion ion-ios-arrow-back"></i><span class="prev_next">이전 글  &nbsp</span>Apache Pyspark Series [Part7]: PySpark Structured Streaming (2) Checkpoints and Triggers</a>
    
    
      <a href="#" class="pagination__next pagination__item disabled">마지막 글 입니다</a>
    
  </div>



      <hr />

<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#operations" id="markdown-toc-operations">Operations</a>    <ul>
      <li><a href="#filter" id="markdown-toc-filter">Filter</a></li>
      <li><a href="#groupby" id="markdown-toc-groupby">GroupBy</a></li>
      <li><a href="#join" id="markdown-toc-join">Join</a>        <ul>
          <li><a href="#stream-batch-join" id="markdown-toc-stream-batch-join">Stream-Batch Join</a></li>
          <li><a href="#stream-stream-join" id="markdown-toc-stream-stream-join">Stream-Stream Join</a></li>
        </ul>
      </li>
      <li><a href="#udf" id="markdown-toc-udf">UDF</a></li>
      <li><a href="#window" id="markdown-toc-window">Window</a>        <ul>
          <li><a href="#tumbling-window" id="markdown-toc-tumbling-window">Tumbling window</a></li>
          <li><a href="#sliding-window" id="markdown-toc-sliding-window">Sliding window</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#watermark" id="markdown-toc-watermark">Watermark</a></li>
  <li><a href="#참고" id="markdown-toc-참고">참고</a></li>
</ul>

<hr />

<h1 id="operations">Operations</h1>

<p>We can perform various operations on a streaming DataFrame like select, filter, groupBy, join, window, UDF, map, flatMap, etc.</p>

<h2 id="filter">Filter</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"Name"</span><span class="p">,</span> <span class="s">"Date"</span><span class="p">,</span> <span class="s">"Open"</span><span class="p">,</span> <span class="s">"Close"</span><span class="p">)</span> \
              <span class="p">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Close"</span><span class="p">)</span> <span class="o">-</span> <span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Open"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">-------------------------------------------</span>
<span class="o">+----+----------+-----+-----+</span>
<span class="o">|</span><span class="n">Name</span><span class="o">|</span>      <span class="n">Date</span><span class="o">|</span> <span class="n">Open</span><span class="o">|</span><span class="n">Close</span><span class="o">|</span>
<span class="o">+----+----------+-----+-----+</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="o">|</span><span class="mf">10.34</span><span class="o">|</span><span class="mf">10.68</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span><span class="mf">10.75</span><span class="o">|</span> <span class="mf">10.9</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span><span class="mf">10.89</span><span class="o">|</span><span class="mf">11.55</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span><span class="o">|</span><span class="mf">11.98</span><span class="o">|</span><span class="mf">11.99</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">13</span><span class="o">|</span><span class="mf">12.14</span><span class="o">|</span><span class="mf">12.23</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span><span class="mf">10.87</span><span class="o">|</span> <span class="mf">11.1</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">30</span><span class="o">|</span><span class="mf">10.17</span><span class="o">|</span><span class="mf">10.71</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="o">|</span><span class="mf">10.71</span><span class="o">|</span><span class="mf">10.77</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">08</span><span class="o">|</span> <span class="mf">9.78</span><span class="o">|</span> <span class="mf">9.83</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span> <span class="mf">9.31</span><span class="o">|</span> <span class="mf">9.62</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span>  <span class="mf">9.3</span><span class="o">|</span> <span class="mf">9.66</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">15</span><span class="o">|</span> <span class="mf">9.59</span><span class="o">|</span> <span class="mf">9.89</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span><span class="o">|</span> <span class="mf">9.99</span><span class="o">|</span><span class="mf">10.08</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">22</span><span class="o">|</span> <span class="mf">9.86</span><span class="o">|</span><span class="mf">10.19</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="o">|</span> <span class="mf">9.83</span><span class="o">|</span> <span class="mf">9.87</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span> <span class="mf">9.86</span><span class="o">|</span> <span class="mf">9.94</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span> <span class="mf">9.39</span><span class="o">|</span> <span class="mf">9.47</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span><span class="o">|</span> <span class="mf">9.29</span><span class="o">|</span> <span class="mf">9.38</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span>  <span class="mf">9.4</span><span class="o">|</span> <span class="mf">9.62</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">29</span><span class="o">|</span> <span class="mf">8.45</span><span class="o">|</span>  <span class="mf">8.9</span><span class="o">|</span>
<span class="o">+----+----------+-----+-----+</span>
</code></pre></div></div>

<h2 id="groupby">GroupBy</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"Name"</span><span class="p">,</span><span class="s">"Date"</span><span class="p">,</span> <span class="s">"Open"</span><span class="p">,</span> <span class="s">"High"</span><span class="p">,</span> <span class="s">"Low"</span><span class="p">)</span> \
  <span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Name"</span><span class="p">),</span> <span class="n">F</span><span class="p">.</span><span class="n">year</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Date"</span><span class="p">)).</span><span class="n">alias</span><span class="p">(</span><span class="s">"YEAR"</span><span class="p">))</span> \
  <span class="p">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="s">"High"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"Highest"</span><span class="p">)).</span><span class="n">withColumn</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">F</span><span class="p">.</span><span class="n">current_date</span><span class="p">().</span><span class="n">cast</span><span class="p">(</span><span class="s">"string"</span><span class="p">))</span>
<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">-------------------------------------------</span>
<span class="o">+----+----+-------+----------+</span>
<span class="o">|</span><span class="n">Name</span><span class="o">|</span><span class="n">YEAR</span><span class="o">|</span><span class="n">Highest</span><span class="o">|</span> <span class="n">timestamp</span><span class="o">|</span>
<span class="o">+----+----+-------+----------+</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2017</span><span class="o">|</span>  <span class="mf">177.2</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2014</span><span class="o">|</span> <span class="mf">119.75</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">|</span>  <span class="mf">13.31</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2008</span><span class="o">|</span>  <span class="mf">28.61</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2012</span><span class="o">|</span> <span class="mf">100.72</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2009</span><span class="o">|</span>  <span class="mf">30.56</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2011</span><span class="o">|</span>  <span class="mf">60.96</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2016</span><span class="o">|</span> <span class="mf">118.69</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2015</span><span class="o">|</span> <span class="mf">134.54</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2013</span><span class="o">|</span>  <span class="mf">82.16</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2010</span><span class="o">|</span>  <span class="mf">46.67</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2007</span><span class="o">|</span>  <span class="mf">28.99</span><span class="o">|</span><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span>
<span class="o">+----+----+-------+----------+</span>
</code></pre></div></div>

<h2 id="join">Join</h2>

<h3 id="stream-batch-join">Stream-Batch Join</h3>

<p>With stream-batch joins, we can join a batch DataFrame with a streaming DataFrame. Let’s discuss with an example.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">company_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"csv"</span><span class="p">).</span><span class="n">option</span><span class="p">(</span><span class="s">"path"</span><span class="p">,</span> <span class="s">"hdfs://hdfs-name-node:8020/static/company.csv"</span><span class="p">).</span><span class="n">option</span><span class="p">(</span><span class="s">"header"</span><span class="p">,</span> <span class="bp">True</span><span class="p">).</span><span class="n">load</span><span class="p">()</span>
<span class="n">company_df</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
<span class="o">-------</span>
<span class="o">+-----+---------------+</span>
<span class="o">|</span> <span class="n">Name</span><span class="o">|</span><span class="n">FullCompanyName</span><span class="o">|</span>
<span class="o">+-----+---------------+</span>
<span class="o">|</span> <span class="n">AAPL</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span> <span class="n">AMZN</span><span class="o">|</span>         <span class="n">Amazon</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">+-----+---------------+</span>
</code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># inner, left_outer, right_outer
</span><span class="n">join_df</span> <span class="o">=</span> <span class="n">result_df</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">company_df</span><span class="p">,</span> <span class="s">"Name"</span><span class="p">,</span> <span class="s">"inner"</span><span class="p">)</span>

<span class="n">join_df</span><span class="p">.</span><span class="n">writeStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"console"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s">"append"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">awaitTermination</span><span class="p">()</span>
<span class="o">------------------------------------------------------------</span>
<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">-------------------------------------------</span>
<span class="o">+----+----------+-----+-----+---------------+</span>
<span class="o">|</span><span class="n">Name</span><span class="o">|</span>      <span class="n">Date</span><span class="o">|</span> <span class="n">Open</span><span class="o">|</span><span class="n">Close</span><span class="o">|</span><span class="n">FullCompanyName</span><span class="o">|</span>
<span class="o">+----+----------+-----+-----+---------------+</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="o">|</span><span class="mf">10.34</span><span class="o">|</span><span class="mf">10.68</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span><span class="mf">10.75</span><span class="o">|</span> <span class="mf">10.9</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span><span class="mf">10.89</span><span class="o">|</span><span class="mf">11.55</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span><span class="o">|</span><span class="mf">11.98</span><span class="o">|</span><span class="mf">11.99</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">13</span><span class="o">|</span><span class="mf">12.14</span><span class="o">|</span><span class="mf">12.23</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span><span class="mf">10.87</span><span class="o">|</span> <span class="mf">11.1</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">30</span><span class="o">|</span><span class="mf">10.17</span><span class="o">|</span><span class="mf">10.71</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="o">|</span><span class="mf">10.71</span><span class="o">|</span><span class="mf">10.77</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">08</span><span class="o">|</span> <span class="mf">9.78</span><span class="o">|</span> <span class="mf">9.83</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span> <span class="mf">9.31</span><span class="o">|</span> <span class="mf">9.62</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span>  <span class="mf">9.3</span><span class="o">|</span> <span class="mf">9.66</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">15</span><span class="o">|</span> <span class="mf">9.59</span><span class="o">|</span> <span class="mf">9.89</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span><span class="o">|</span> <span class="mf">9.99</span><span class="o">|</span><span class="mf">10.08</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">22</span><span class="o">|</span> <span class="mf">9.86</span><span class="o">|</span><span class="mf">10.19</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">01</span><span class="o">|</span> <span class="mf">9.83</span><span class="o">|</span> <span class="mf">9.87</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span> <span class="mf">9.86</span><span class="o">|</span> <span class="mf">9.94</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">07</span><span class="o">|</span> <span class="mf">9.39</span><span class="o">|</span> <span class="mf">9.47</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span><span class="o">|</span> <span class="mf">9.29</span><span class="o">|</span> <span class="mf">9.38</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span>  <span class="mf">9.4</span><span class="o">|</span> <span class="mf">9.62</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">|</span><span class="n">AAPL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">29</span><span class="o">|</span> <span class="mf">8.45</span><span class="o">|</span>  <span class="mf">8.9</span><span class="o">|</span>          <span class="n">Apple</span><span class="o">|</span>
<span class="o">+----+----------+-----+-----+---------------+</span>

<span class="c1"># inner join 이기 때문에 MSFT.csv 데이터를 넣었을때는 안나온다
</span><span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">1</span>
<span class="o">-------------------------------------------</span>
<span class="o">+----+----+----+-----+---------------+</span>
<span class="o">|</span><span class="n">Name</span><span class="o">|</span><span class="n">Date</span><span class="o">|</span><span class="n">Open</span><span class="o">|</span><span class="n">Close</span><span class="o">|</span><span class="n">FullCompanyName</span><span class="o">|</span>
<span class="o">+----+----+----+-----+---------------+</span>
<span class="o">+----+----+----+-----+---------------+</span>

<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">2</span>
<span class="o">-------------------------------------------</span>
<span class="o">+-----+----------+------+------+---------------+</span>
<span class="o">|</span> <span class="n">Name</span><span class="o">|</span>      <span class="n">Date</span><span class="o">|</span>  <span class="n">Open</span><span class="o">|</span> <span class="n">Close</span><span class="o">|</span><span class="n">FullCompanyName</span><span class="o">|</span>
<span class="o">+-----+----------+------+------+---------------+</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="o">|</span><span class="mf">211.47</span><span class="o">|</span><span class="mf">217.83</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span><span class="o">|</span><span class="mf">222.17</span><span class="o">|</span><span class="mf">222.84</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span><span class="o">|</span><span class="mf">223.22</span><span class="o">|</span><span class="mf">225.85</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span><span class="mf">228.66</span><span class="o">|</span><span class="mf">233.06</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span><span class="o">|</span><span class="mf">233.44</span><span class="o">|</span><span class="mf">233.68</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span><span class="mf">232.44</span><span class="o">|</span><span class="mf">235.11</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span><span class="o">|</span><span class="mf">235.87</span><span class="o">|</span><span class="mf">236.05</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">13</span><span class="o">|</span><span class="mf">232.39</span><span class="o">|</span><span class="mf">233.36</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span><span class="o">|</span><span class="mf">231.76</span><span class="o">|</span><span class="mf">233.79</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span><span class="mf">203.89</span><span class="o">|</span><span class="mf">213.96</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">24</span><span class="o">|</span><span class="mf">218.23</span><span class="o">|</span><span class="mf">221.74</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span> <span class="mf">215.5</span><span class="o">|</span><span class="mf">216.55</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="o">|</span><span class="mf">194.71</span><span class="o">|</span><span class="mf">201.09</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">08</span><span class="o">|</span><span class="mf">184.42</span><span class="o">|</span><span class="mf">184.72</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span><span class="mf">181.16</span><span class="o">|</span><span class="mf">181.49</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">15</span><span class="o">|</span><span class="mf">170.81</span><span class="o">|</span><span class="mf">171.36</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span><span class="o">|</span><span class="mf">173.01</span><span class="o">|</span><span class="mf">183.41</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span><span class="o">|</span> <span class="mf">183.4</span><span class="o">|</span><span class="mf">183.48</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span><span class="mf">182.99</span><span class="o">|</span><span class="mf">189.22</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span><span class="o">|</span><span class="mf">188.84</span><span class="o">|</span><span class="mf">188.89</span><span class="o">|</span>         <span class="n">Google</span><span class="o">|</span>
<span class="o">+-----+----------+------+------+---------------+</span>
</code></pre></div></div>

<h3 id="stream-stream-join">Stream-Stream Join</h3>

<p><code class="language-plaintext highlighter-rouge">left_outer</code> and <code class="language-plaintext highlighter-rouge">right_outer</code> joins are conditionally supported with watermark but full_outer join is not supported.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"csv"</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"path"</span><span class="p">,</span> <span class="s">"hdfs://hdfs-name-node:8020/data"</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"maxFilesPerTrigger"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"header"</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">schema</span><span class="p">(</span><span class="n">schema</span><span class="p">).</span><span class="n">load</span><span class="p">()</span>

<span class="n">stream_df_high</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"Name"</span><span class="p">,</span><span class="s">"Date"</span><span class="p">,</span> <span class="s">"High"</span><span class="p">)</span>
<span class="n">stream_df_low</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"Name"</span><span class="p">,</span><span class="s">"Date"</span><span class="p">,</span> <span class="s">"Low"</span><span class="p">)</span>

<span class="n">join_df</span> <span class="o">=</span> <span class="n">stream_df_high</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">stream_df_low</span><span class="p">,</span> <span class="p">[</span><span class="s">"Name"</span><span class="p">,</span> <span class="s">"Date"</span><span class="p">])</span>

<span class="n">join_df</span><span class="p">.</span><span class="n">writeStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"console"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s">"append"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">awaitTermination</span><span class="p">()</span>
<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">-------------------------------------------</span>
<span class="o">+-----+----------+-------+-------+</span>
<span class="o">|</span> <span class="n">Name</span><span class="o">|</span>      <span class="n">Date</span><span class="o">|</span>   <span class="n">High</span><span class="o">|</span>    <span class="n">Low</span><span class="o">|</span>
<span class="o">+-----+----------+-------+-------+</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">08</span><span class="o">|</span>  <span class="mf">180.2</span><span class="o">|</span> <span class="mf">175.45</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">29</span><span class="o">|</span> <span class="mf">191.35</span><span class="o">|</span> <span class="mf">188.79</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2007</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">17</span><span class="o">|</span> <span class="mf">348.06</span><span class="o">|</span> <span class="mf">332.17</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2008</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">03</span><span class="o">|</span> <span class="mf">237.38</span><span class="o">|</span> <span class="mf">230.02</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2009</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">28</span><span class="o">|</span> <span class="mf">275.27</span><span class="o">|</span> <span class="mf">269.39</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2010</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">29</span><span class="o">|</span> <span class="mf">232.51</span><span class="o">|</span> <span class="mf">225.79</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2011</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">09</span><span class="o">|</span> <span class="mf">310.03</span><span class="o">|</span> <span class="mf">306.48</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2011</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">11</span><span class="o">|</span> <span class="mf">312.81</span><span class="o">|</span> <span class="mf">306.81</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2011</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">14</span><span class="o">|</span> <span class="mf">290.01</span><span class="o">|</span> <span class="mf">286.34</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">12</span><span class="o">|</span> <span class="mf">595.59</span><span class="o">|</span> <span class="mf">591.28</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span> <span class="mf">593.72</span><span class="o">|</span> <span class="mf">587.14</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span>  <span class="mf">556.8</span><span class="o">|</span> <span class="mf">550.58</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">25</span><span class="o">|</span>  <span class="mf">552.5</span><span class="o">|</span> <span class="mf">546.91</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2015</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span><span class="o">|</span>  <span class="mf">508.6</span><span class="o">|</span> <span class="mf">498.65</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2015</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">12</span><span class="o">|</span> <span class="mf">561.84</span><span class="o">|</span> <span class="mf">555.53</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2015</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">12</span><span class="o">|</span>  <span class="mf">765.8</span><span class="o">|</span> <span class="mf">755.86</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">12</span><span class="o">|</span> <span class="mf">807.19</span><span class="o">|</span> <span class="mf">803.64</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2016</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span>  <span class="mf">801.0</span><span class="o">|</span> <span class="mf">795.99</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">13</span><span class="o">|</span><span class="mf">1014.76</span><span class="o">|</span><span class="mf">1007.06</span><span class="o">|</span>
<span class="o">|</span><span class="n">GOOGL</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">24</span><span class="o">|</span> <span class="mf">190.23</span><span class="o">|</span> <span class="mf">186.93</span><span class="o">|</span>
<span class="o">+-----+----------+-------+-------+</span>

<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">1</span>
<span class="o">-------------------------------------------</span>
<span class="o">+----+----------+-----+-----+</span>
<span class="o">|</span><span class="n">Name</span><span class="o">|</span>      <span class="n">Date</span><span class="o">|</span> <span class="n">High</span><span class="o">|</span>  <span class="n">Low</span><span class="o">|</span>
<span class="o">+----+----------+-----+-----+</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2007</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span><span class="mf">29.28</span><span class="o">|</span><span class="mf">28.89</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2007</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">12</span><span class="o">|</span><span class="mf">28.62</span><span class="o">|</span><span class="mf">28.04</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2008</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">04</span><span class="o">|</span><span class="mf">30.72</span><span class="o">|</span><span class="mf">30.11</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2008</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">26</span><span class="o">|</span><span class="mf">27.56</span><span class="o">|</span><span class="mf">26.14</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2008</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">30</span><span class="o">|</span><span class="mf">23.88</span><span class="o">|</span><span class="mf">22.39</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2009</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span><span class="o">|</span><span class="mf">19.19</span><span class="o">|</span> <span class="mf">18.7</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2009</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">24</span><span class="o">|</span> <span class="mf">21.2</span><span class="o">|</span> <span class="mf">19.5</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2010</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">08</span><span class="o">|</span><span class="mf">28.08</span><span class="o">|</span><span class="mf">27.57</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2010</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">26</span><span class="o">|</span><span class="mf">24.19</span><span class="o">|</span><span class="mf">23.79</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2010</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span><span class="mf">27.92</span><span class="o">|</span><span class="mf">27.63</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2011</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">22</span><span class="o">|</span><span class="mf">25.65</span><span class="o">|</span> <span class="mf">24.6</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2012</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span><span class="mf">26.97</span><span class="o">|</span><span class="mf">26.52</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span><span class="mf">35.65</span><span class="o">|</span><span class="mf">35.14</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2013</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">18</span><span class="o">|</span> <span class="mf">33.4</span><span class="o">|</span><span class="mf">32.83</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2014</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">04</span><span class="o">|</span><span class="mf">47.73</span><span class="o">|</span><span class="mf">47.25</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">05</span><span class="o">|</span><span class="mf">28.11</span><span class="o">|</span><span class="mf">27.78</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2009</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">04</span><span class="o">|</span> <span class="mf">16.4</span><span class="o">|</span><span class="mf">15.89</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2009</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span><span class="mf">24.85</span><span class="o">|</span><span class="mf">24.29</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2009</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span><span class="mf">26.25</span><span class="o">|</span><span class="mf">25.64</span><span class="o">|</span>
<span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mi">2009</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">02</span><span class="o">|</span><span class="mf">29.99</span><span class="o">|</span><span class="mf">29.65</span><span class="o">|</span>
<span class="o">+----+----------+-----+-----+</span>
</code></pre></div></div>

<h2 id="udf">UDF</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"csv"</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"path"</span><span class="p">,</span> <span class="s">"hdfs://hdfs-name-node:8020/data"</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"maxFilesPerTrigger"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"header"</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">schema</span><span class="p">(</span><span class="n">schema</span><span class="p">).</span><span class="n">load</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">up_down</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">cl</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">op</span> <span class="o">&lt;</span> <span class="n">cl</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"Up"</span>
    <span class="k">elif</span> <span class="n">op</span> <span class="o">&gt;</span> <span class="n">cl</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"Down"</span>
    <span class="k">return</span> <span class="s">"Same"</span>

<span class="n">UDF_up_down</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">udf</span><span class="p">(</span><span class="n">up_down</span><span class="p">)</span>

<span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">"Up/Down"</span><span class="p">,</span> <span class="n">UDF_up_down</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Open"</span><span class="p">),</span> <span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Close"</span><span class="p">)))</span>

<span class="n">result_df</span><span class="p">.</span><span class="n">writeStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"console"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s">"append"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">awaitTermination</span><span class="p">()</span>

<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">-------------------------------------------</span>
<span class="o">+----------+-----+-----+-----+-----+---------+----+-------+</span>
<span class="o">|</span>      <span class="n">Date</span><span class="o">|</span> <span class="n">Open</span><span class="o">|</span> <span class="n">High</span><span class="o">|</span>  <span class="n">Low</span><span class="o">|</span><span class="n">Close</span><span class="o">|</span>   <span class="n">Volume</span><span class="o">|</span><span class="n">Name</span><span class="o">|</span><span class="n">Up</span><span class="o">/</span><span class="n">Down</span><span class="o">|</span>
<span class="o">+----------+-----+-----+-----+-----+---------+----+-------+</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">03</span><span class="o">|</span><span class="mf">26.25</span><span class="o">|</span> <span class="mf">27.0</span><span class="o">|</span> <span class="mf">26.1</span><span class="o">|</span><span class="mf">26.84</span><span class="o">|</span> <span class="mi">79974418</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">04</span><span class="o">|</span><span class="mf">26.77</span><span class="o">|</span><span class="mf">27.08</span><span class="o">|</span><span class="mf">26.77</span><span class="o">|</span><span class="mf">26.97</span><span class="o">|</span> <span class="mi">57975661</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span><span class="o">|</span><span class="mf">26.96</span><span class="o">|</span><span class="mf">27.13</span><span class="o">|</span><span class="mf">26.91</span><span class="o">|</span><span class="mf">26.99</span><span class="o">|</span> <span class="mi">48247610</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">06</span><span class="o">|</span><span class="mf">26.89</span><span class="o">|</span> <span class="mf">27.0</span><span class="o">|</span><span class="mf">26.49</span><span class="o">|</span><span class="mf">26.91</span><span class="o">|</span><span class="mi">100969092</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span><span class="o">|</span><span class="mf">26.93</span><span class="o">|</span><span class="mf">27.07</span><span class="o">|</span><span class="mf">26.76</span><span class="o">|</span><span class="mf">26.86</span><span class="o">|</span> <span class="mi">55627836</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>   <span class="n">Down</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">10</span><span class="o">|</span><span class="mf">26.65</span><span class="o">|</span><span class="mf">27.02</span><span class="o">|</span><span class="mf">26.59</span><span class="o">|</span> <span class="mf">27.0</span><span class="o">|</span> <span class="mi">64924946</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">11</span><span class="o">|</span><span class="mf">27.01</span><span class="o">|</span><span class="mf">27.39</span><span class="o">|</span> <span class="mf">26.9</span><span class="o">|</span><span class="mf">27.29</span><span class="o">|</span> <span class="mi">70123544</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span><span class="o">|</span><span class="mf">27.25</span><span class="o">|</span><span class="mf">27.26</span><span class="o">|</span><span class="mf">26.97</span><span class="o">|</span><span class="mf">27.14</span><span class="o">|</span> <span class="mi">45994725</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>   <span class="n">Down</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">13</span><span class="o">|</span><span class="mf">27.03</span><span class="o">|</span><span class="mf">27.25</span><span class="o">|</span><span class="mf">27.01</span><span class="o">|</span><span class="mf">27.19</span><span class="o">|</span> <span class="mi">41449046</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span><span class="o">|</span> <span class="mf">26.9</span><span class="o">|</span><span class="mf">27.19</span><span class="o">|</span> <span class="mf">26.9</span><span class="o">|</span><span class="mf">26.99</span><span class="o">|</span> <span class="mi">58574807</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">18</span><span class="o">|</span><span class="mf">26.74</span><span class="o">|</span><span class="mf">26.98</span><span class="o">|</span> <span class="mf">26.7</span><span class="o">|</span><span class="mf">26.83</span><span class="o">|</span> <span class="mi">52495587</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">19</span><span class="o">|</span><span class="mf">26.87</span><span class="o">|</span><span class="mf">27.24</span><span class="o">|</span><span class="mf">26.85</span><span class="o">|</span><span class="mf">27.02</span><span class="o">|</span> <span class="mi">60382450</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">20</span><span class="o">|</span><span class="mf">27.01</span><span class="o">|</span><span class="mf">27.01</span><span class="o">|</span><span class="mf">26.26</span><span class="o">|</span><span class="mf">26.41</span><span class="o">|</span> <span class="mi">79228490</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>   <span class="n">Down</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">23</span><span class="o">|</span><span class="mf">26.41</span><span class="o">|</span><span class="mf">26.53</span><span class="o">|</span> <span class="mf">26.3</span><span class="o">|</span><span class="mf">26.35</span><span class="o">|</span> <span class="mi">47971611</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>   <span class="n">Down</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">24</span><span class="o">|</span><span class="mf">26.34</span><span class="o">|</span><span class="mf">26.45</span><span class="o">|</span><span class="mf">26.22</span><span class="o">|</span><span class="mf">26.28</span><span class="o">|</span> <span class="mi">63061743</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>   <span class="n">Down</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">25</span><span class="o">|</span><span class="mf">26.41</span><span class="o">|</span><span class="mf">26.57</span><span class="o">|</span><span class="mf">26.23</span><span class="o">|</span> <span class="mf">26.4</span><span class="o">|</span> <span class="mi">59072711</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>   <span class="n">Down</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">26</span><span class="o">|</span><span class="mf">26.56</span><span class="o">|</span><span class="mf">26.72</span><span class="o">|</span><span class="mf">26.31</span><span class="o">|</span> <span class="mf">26.5</span><span class="o">|</span> <span class="mi">69531321</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>   <span class="n">Down</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span><span class="o">|</span><span class="mf">27.23</span><span class="o">|</span><span class="mf">27.95</span><span class="o">|</span><span class="mf">27.19</span><span class="o">|</span><span class="mf">27.79</span><span class="o">|</span><span class="mi">134525193</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">30</span><span class="o">|</span><span class="mf">27.82</span><span class="o">|</span><span class="mf">28.18</span><span class="o">|</span><span class="mf">27.78</span><span class="o">|</span> <span class="mf">28.0</span><span class="o">|</span><span class="mi">103999604</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">|</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">31</span><span class="o">|</span><span class="mf">27.91</span><span class="o">|</span><span class="mf">28.38</span><span class="o">|</span><span class="mf">27.87</span><span class="o">|</span><span class="mf">28.15</span><span class="o">|</span> <span class="mi">94844406</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span>     <span class="n">Up</span><span class="o">|</span>
<span class="o">+----------+-----+-----+-----+-----+---------+----+-------+</span>
</code></pre></div></div>

<h2 id="window">Window</h2>

<p>Window operations are very similar to <code class="language-plaintext highlighter-rouge">groupBy</code> operations. In <code class="language-plaintext highlighter-rouge">groupBy</code>, aggregation is based on the specified group or key while in <code class="language-plaintext highlighter-rouge">window</code> operations, aggregation is based on event windows. Spark supports 2 types of windows Tumbling window and Sliding window.</p>

<p>Let’s discuss each one of them in detail. Take an example of numbers from 1–10 and we will calculate <code class="language-plaintext highlighter-rouge">SUM</code> using different window operations.</p>

<h3 id="tumbling-window">Tumbling window</h3>

<p>Tumbling windows are non-overlapping which means each data point will be part of only one window.</p>

<p><img src="/images/spark_stream_4.png" alt="" /></p>

<p>Here the size of the window is 2 and we have 5 non-overlapping windows along with the sum of the elements in each window. Also, we can verify that none of the elements are overlapping between windows.</p>

<p>Now let us define one in our streaming application. We can use a window function and specify the <code class="language-plaintext highlighter-rouge">DateTime</code> column and window duration say <code class="language-plaintext highlighter-rouge">2 minutes</code> or <code class="language-plaintext highlighter-rouge">30 seconds</code> or <code class="language-plaintext highlighter-rouge">1 hour</code> or <code class="language-plaintext highlighter-rouge">5 days</code> etc.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"Name"</span><span class="p">,</span> <span class="s">"Date"</span><span class="p">,</span> <span class="s">"Open"</span><span class="p">,</span> <span class="s">"High"</span><span class="p">,</span> <span class="s">"Low"</span><span class="p">)</span> \
              <span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Date"</span><span class="p">),</span> <span class="s">"10 days"</span><span class="p">),</span> <span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Name"</span><span class="p">))</span> \
              <span class="p">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="s">"High"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"Max"</span><span class="p">)).</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"window"</span><span class="p">))</span>

<span class="n">result_df</span><span class="p">.</span><span class="n">writeStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"console"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s">"complete"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"truncate"</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">awaitTermination</span><span class="p">()</span>

<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">-------------------------------------------</span>
<span class="o">+------------------------------------------+----+-----+</span>
<span class="o">|</span><span class="n">window</span>                                    <span class="o">|</span><span class="n">Name</span><span class="o">|</span><span class="n">Max</span>  <span class="o">|</span>
<span class="o">+------------------------------------------+----+-----+</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.39</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.26</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">28.38</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">28.07</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">26.93</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.3</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.5</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">23</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">28.22</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">23</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.54</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.94</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.5</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.63</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">25.0</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">24.0</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">23.92</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">22.99</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">21</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">22.76</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">21</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">23.65</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">23.72</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">21</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">23.46</span><span class="o">|</span>
<span class="o">+------------------------------------------+----+-----+</span>
</code></pre></div></div>

<h3 id="sliding-window">Sliding window</h3>

<p>As its name suggests, this window will slide instead of tumbling on the data. We can specify the level of sliding needed. These are overlapping windows. Let’s first try to understand with a simple example of numbers from 1–10.</p>

<p><img src="/images/spark_stream_5.png" alt="" /></p>

<p>Here we have defined the window size as 3 and slide interval as 2. As we can see in the snapshot above, these windows overlap. For example, the number 3 is present in both windows 1 and 2.</p>

<p>To define a sliding window, along with <code class="language-plaintext highlighter-rouge">DateTime</code> and <code class="language-plaintext highlighter-rouge">Window Size</code> in the window function, we specify <code class="language-plaintext highlighter-rouge">slide Duration</code> as the third argument. Let’s try to perform a sliding window operation in our streaming application.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">result_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="s">"Name"</span><span class="p">,</span> <span class="s">"Date"</span><span class="p">,</span> <span class="s">"Open"</span><span class="p">,</span> <span class="s">"High"</span><span class="p">,</span> <span class="s">"Low"</span><span class="p">)</span> \
              <span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Date"</span><span class="p">),</span> <span class="s">"10 days"</span><span class="p">,</span> <span class="s">"5 days"</span><span class="p">),</span> <span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"Name"</span><span class="p">))</span> \
              <span class="p">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="s">"High"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"Max"</span><span class="p">)).</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"window"</span><span class="p">))</span>

<span class="n">result_df</span><span class="p">.</span><span class="n">writeStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"console"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s">"complete"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"truncate"</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">awaitTermination</span><span class="p">()</span>

<span class="o">-------------------------------------------</span>
<span class="n">Batch</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">-------------------------------------------</span>
<span class="o">+------------------------------------------+----+-----+</span>
<span class="o">|</span><span class="n">window</span>                                    <span class="o">|</span><span class="n">Name</span><span class="o">|</span><span class="n">Max</span>  <span class="o">|</span>
<span class="o">+------------------------------------------+----+-----+</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2005</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.13</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.39</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">07</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.39</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.26</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">17</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.24</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">28.38</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">27</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">06</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">28.38</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">28.07</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">06</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.54</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">11</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">26.93</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">16</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">26</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">26.9</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">21</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.3</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">26</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">08</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.3</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">03</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.5</span> <span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">08</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">18</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.66</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">13</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">23</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">28.22</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">18</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">28.22</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">23</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.54</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">28</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">07</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.94</span><span class="o">|</span>
<span class="o">|</span><span class="p">{</span><span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">02</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">,</span> <span class="mi">2006</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">12</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">}</span><span class="o">|</span><span class="n">MSFT</span><span class="o">|</span><span class="mf">27.94</span><span class="o">|</span>
<span class="o">+------------------------------------------+----+-----+</span>
</code></pre></div></div>

<h1 id="watermark">Watermark</h1>

<p>We can use <code class="language-plaintext highlighter-rouge">watermarking</code> to handle late data so that the system discards records automatically.</p>

<p>Now let’s add <code class="language-plaintext highlighter-rouge">withWatermark()</code> to our application and see how it works. We set watermark to <code class="language-plaintext highlighter-rouge">delayThreshold = 10 minutes</code> as well as <code class="language-plaintext highlighter-rouge">windowDuration = 5 minutes</code> using <code class="language-plaintext highlighter-rouge">groupBy()</code>. Watermark is set to <code class="language-plaintext highlighter-rouge">max event time seen so far — delayThreshold</code>.</p>

<p>(수신한 데이터중 이벤트 시간이 가장 큰 값이 2022-12-27 10:30:00 이라면, 워터마크는 2022-12-27 10:20:00에 찍힌다. -&gt; 10:20:00 이전에 발생한 데이터는 수신하더라도 처리하지 않겠다는 의미이다. -&gt; 10:15:00 ~ 10:20:00 윈도우에서 출력되는 값은 더 이상 업데이트 하지 않겠다는 의미이다.)</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lk</span> 9999

2023-01-01 10:06:00#2
2023–01–01 10:13:00#5
2022–12–31 10:06:00#1
2023–01–01 10:08:00#8
</code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"socket"</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"host"</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"port"</span><span class="p">,</span> <span class="s">"9999"</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">load</span><span class="p">()</span>

<span class="n">event_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">select</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"value"</span><span class="p">),</span> <span class="s">"#"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"data"</span><span class="p">))</span> \
  <span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">"event_timestamp"</span><span class="p">,</span> <span class="n">F</span><span class="p">.</span><span class="n">element_at</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"data"</span><span class="p">),</span> <span class="mi">1</span><span class="p">).</span><span class="n">cast</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">))</span> \
  <span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">"val"</span><span class="p">,</span> <span class="n">F</span><span class="p">.</span><span class="n">element_at</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"data"</span><span class="p">),</span> <span class="mi">2</span><span class="p">).</span><span class="n">cast</span><span class="p">(</span><span class="s">"int"</span><span class="p">))</span> \
  <span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="s">"data"</span><span class="p">)</span>

<span class="n">result_df</span> <span class="o">=</span> <span class="n">event_df</span><span class="p">.</span><span class="n">withWatermark</span><span class="p">(</span><span class="s">"event_timestamp"</span><span class="p">,</span> <span class="s">"10 minutes"</span><span class="p">)</span> \
                    <span class="p">.</span><span class="n">groupBy</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">window</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="s">"event_timestamp"</span><span class="p">),</span> <span class="s">"5 minutes"</span><span class="p">))</span> \
                    <span class="p">.</span><span class="n">agg</span><span class="p">(</span><span class="n">F</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="s">"val"</span><span class="p">).</span><span class="n">alias</span><span class="p">(</span><span class="s">"sum"</span><span class="p">))</span>

<span class="n">result_df</span><span class="p">.</span><span class="n">writeStream</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"console"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">outputMode</span><span class="p">(</span><span class="s">"complete"</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">option</span><span class="p">(</span><span class="s">"truncate"</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span> \
        <span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">awaitTermination</span><span class="p">()</span>
</code></pre></div></div>

<h1 id="참고">참고</h1>

<ul>
  <li><a href="https://medium.com/expedia-group-tech/apache-spark-structured-streaming-operations-5-of-6-40d907866fa7" target="_blank">Neeraj Bhadani, Apache Spark Structured Streaming — Operations (5 of 6)</a></li>
  <li><a href="https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html" target="_blank">Spark 공식문서, Pyspark Structured Streaming Guide</a></li>
</ul>

    </div>
    <div class="post__tags_list">
      <div class="container">
        <h3 class="point_heading">All Tag</h3>
        <ul class="tag__list list-reset">
          
            
              
              <li class="tag__item"><a href="/API" class="post_tag_list">#API</a></li>
            
          
            
              
              <li class="tag__item"><a href="/AWS" class="post_tag_list">#AWS</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Airflow" class="post_tag_list">#Airflow</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Blockchain_basic" class="post_tag_list">#Blockchain_basic</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Coding_Test" class="post_tag_list">#Coding_Test</a></li>
            
          
            
              
              <li class="tag__item"><a href="/DE" class="post_tag_list">#DE</a></li>
            
          
            
              
              <li class="tag__item"><a href="/DL_theory" class="post_tag_list">#DL_theory</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Django" class="post_tag_list">#Django</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Docker" class="post_tag_list">#Docker</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Elastic" class="post_tag_list">#Elastic</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Finance" class="post_tag_list">#Finance</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Flink" class="post_tag_list">#Flink</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Git" class="post_tag_list">#Git</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Hadoop" class="post_tag_list">#Hadoop</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Java" class="post_tag_list">#Java</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Javascript" class="post_tag_list">#Javascript</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Jenkins" class="post_tag_list">#Jenkins</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Kafka" class="post_tag_list">#Kafka</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Kubernetes" class="post_tag_list">#Kubernetes</a></li>
            
          
            
              
              <li class="tag__item"><a href="/MLOps" class="post_tag_list">#MLOps</a></li>
            
          
            
              
              <li class="tag__item"><a href="/MongoDB" class="post_tag_list">#MongoDB</a></li>
            
          
            
              
              <li class="tag__item"><a href="/MySQL" class="post_tag_list">#MySQL</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Network" class="post_tag_list">#Network</a></li>
            
          
            
              
              <li class="tag__item"><a href="/OS" class="post_tag_list">#OS</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Pandas" class="post_tag_list">#Pandas</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Python" class="post_tag_list">#Python</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Pytorch" class="post_tag_list">#Pytorch</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Scikit_learn" class="post_tag_list">#Scikit_learn</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Spark" class="post_tag_list">#Spark</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Spring" class="post_tag_list">#Spring</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Statistics" class="post_tag_list">#Statistics</a></li>
            
          
            
              
              <li class="tag__item"><a href="/TDD" class="post_tag_list">#TDD</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Terraform" class="post_tag_list">#Terraform</a></li>
            
          
            
              
              <li class="tag__item"><a href="/etc" class="post_tag_list">#etc</a></li>
            
          
            
              
              <li class="tag__item"><a href="/tech_interview" class="post_tag_list">#tech_interview</a></li>
            
          
            
          
        </ul>
        <h3 class="point_heading">All Category</h3>
        <ul class="tag__list list-reset">
          
            
              
              <li class="tag__item"><a href="/AI" class="post_category_list">#AI</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Blockchain" class="post_category_list">#Blockchain</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Cloud" class="post_category_list">#Cloud</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Development_knowledge" class="post_category_list">#Development_knowledge</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Economics" class="post_category_list">#Economics</a></li>
            
          
            
              
              <li class="tag__item"><a href="/Math" class="post_category_list">#Math</a></li>
            
          
            
              
              <li class="tag__item"><a href="/computer_science" class="post_category_list">#computer_science</a></li>
            
          
            
              
              <li class="tag__item"><a href="/data_analytics" class="post_category_list">#data_analytics</a></li>
            
          
            
              
              <li class="tag__item"><a href="/data_engineering" class="post_category_list">#data_engineering</a></li>
            
          
            
              
              <li class="tag__item"><a href="/devops" class="post_category_list">#devops</a></li>
            
          
            
              
              <li class="tag__item"><a href="/machine_learning" class="post_category_list">#machine_learning</a></li>
            
          
            
              
              <li class="tag__item"><a href="/programming_language" class="post_category_list">#programming_language</a></li>
            
          
            
              
              <li class="tag__item"><a href="/web_development" class="post_category_list">#web_development</a></li>
            
          
            
          
        </ul>
        <section class="page__content" itemprop="text">
          
          
        </section>
      </div>
    </div>
</div>











<!-- share -->
<div class="container">
  <div class="post__share">
    <ul class="share__list list-reset">
      <li class="share__item">
        <a class="share__link share__twitter"
          href="https://twitter.com/intent/tweet?text=Apache%20Pyspark%20Series%20[Part8]:%20PySpark%20Structured%20Streaming%20(3)%20Operations%20and%20Watermark&url=http://localhost:4000/pyspark-series8"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on Twitter" rel="nofollow"><i class="ion ion-logo-twitter"></i></a>
      </li>
      <li class="share__item">
        <a class="share__link share__facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/pyspark-series8"
          onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
          title="Share on Facebook" rel="nofollow"><i class="ion ion-logo-facebook"></i></a>
      </li>
      <li class="share__item">
        <a class="share__link share__pinterest" href="http://pinterest.com/pin/create/button/?url=http://localhost:4000/pyspark-series8&amp;media=http://localhost:4000/images/pyspark_logo.png&amp;description=Apache%20Pyspark%20Series%20[Part8]:%20PySpark%20Structured%20Streaming%20(3)%20Operations%20and%20Watermark"
        onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Pinterest"
        rel="nofollow"><i class="ion ion-logo-pinterest"></i></a>
      </li>
      <li class="share__item">
        <a class="share__link share__linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/pyspark-series8&title=Apache%20Pyspark%20Series%20[Part8]:%20PySpark%20Structured%20Streaming%20(3)%20Operations%20and%20Watermark&summary=&source=Code%20Museum"
        onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" rel="nofollow"><i class="ion ion-logo-linkedin"></i></a>
      </li>
    </ul>
  </div>
  
<!--첫 번째 문단-->



  
  	
  	
  	
  	
  	

<!--두 번째 문단-->


  <div class="post_pagination">
    
      <a href="/pyspark-series7" class="pagination__prev pagination__item"><i class="ion ion-ios-arrow-back"></i><span class="prev_next">이전 글  &nbsp</span>Apache Pyspark Series [Part7]: PySpark Structured Streaming (2) Checkpoints and Triggers</a>
    
    
      <a href="#" class="pagination__next pagination__item disabled">마지막 글 입니다</a>
    
  </div>



</div>



<!-- end post -->








<!-- begin related posts -->
<div class="container">
  <section class="related-posts is-related animate">
    <div class="row">
      <div class="col col-12">
        <div class="container__inner">
          <div class="section__info">
            <div class="section__head">
              <h2 class="section__title">You may also like</h2>
              <a class="section__link" href="/blog">
                
                
                  
                    <a href="/data_engineering" class="section__link related-tag">See all<span> data_engineering</span></a>
                  
                
              
              </a>
            </div>
          </div>
          <div class="row">

          
            
            
      
            
      
            

              <div class="article col col-4 col-d-6 col-t-12">
  <div class="article__inner">

    <div class="article__head">
      <time class="article__date" datetime="2022-09-07T21:01:35+09:00">07 Sep 2022</time>

      

      
      <a class="article__image" href="/mlops-series6">
        <img class="lazy" data-src="/images/mlops_logo.png" alt="MLOps Series [Part6]: Testing Code, Data and Model">
      </a>
      

    </div>

    <div class="article__content">

      <h2 class="article__title">
        <a href="/mlops-series6">MLOps Series [Part6]: Testing Code, Data and Model</a>
      </h2>

      

    </div>
  </div>
</div>

            
                
              
            
            
            
      
            
      
            

              <div class="article col col-4 col-d-6 col-t-12">
  <div class="article__inner">

    <div class="article__head">
      <time class="article__date" datetime="2022-09-06T21:01:35+09:00">06 Sep 2022</time>

      

      
      <a class="article__image" href="/mlops-series5">
        <img class="lazy" data-src="/images/mlops_logo.png" alt="MLOps Series [Part5]: Weights and Biases">
      </a>
      

    </div>

    <div class="article__content">

      <h2 class="article__title">
        <a href="/mlops-series5">MLOps Series [Part5]: Weights and Biases</a>
      </h2>

      

    </div>
  </div>
</div>

            
                
              
            
            
            
      
            
      
            

              <div class="article col col-4 col-d-6 col-t-12">
  <div class="article__inner">

    <div class="article__head">
      <time class="article__date" datetime="2022-09-06T21:01:35+09:00">06 Sep 2022</time>

      

      
      <a class="article__image" href="/mlops-series4">
        <img class="lazy" data-src="/images/mlops_logo.png" alt="MLOps Series [Part4]: MLflow">
      </a>
      

    </div>

    <div class="article__content">

      <h2 class="article__title">
        <a href="/mlops-series4">MLOps Series [Part4]: MLflow</a>
      </h2>

      

    </div>
  </div>
</div>

            
                
                  
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
<!-- end related posts -->


  <div class="container">
    <div class="row">
      <div class="col col-12">
        <!-- begin comments -->
<div class="show-comments">
  <button class="button disqus-button" id="show-comments-button" onclick="disqus();return false;">Show Comments</button>
</div>

<div id="disqus_thread" class="post__comments">
  <div id="disqus_empty"></div>
</div>

<script>
  var disqus_loaded = false;
  var disqus_shortname = 'Jay';
  var disqus_container = document.getElementById("disqus_thread");
  function disqus() {
    if (!disqus_loaded) {
      disqus_loaded = true;
      var e = document.createElement("script");
      e.type = "text/javascript";
      e.async = true;
      e.src = "//" + disqus_shortname + ".disqus.com/embed.js";
      (document.getElementsByTagName("head")[0] ||
        document.getElementsByTagName("body")[0])
        .appendChild(e);
      // Hide the button after opening
      document.getElementById("show-comments-button").style.display = "none";
      // Show disqus comments
      disqus_container.classList.add("is-open");
    }
  }
</script>

<noscript>Please enable JavaScript to view the
  <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<!-- end comments --> 
      </div>
    </div>
  </div>

  </main>
  <!-- end content -->

  <!-- begin footer -->
<footer class="footer">

  <div class="footer__inner">
    <div class="container">
      <div class="row">

        <div class="col col-5 col-d-12">
          <div class="footer__author">
            <div class="footer__author-avatar">
              <img class="lazy" data-src="/images/zepeto_me.jpeg" alt="Jay Kim">
            </div>
            <h3 class="footer__author-name">Jay Kim</h3>
            <p class="footer__author-bio">Data Engineer</p>
            
            <div class="social">
              <ul class="social__list list-reset">
                
                <li class="social__item">
                  <a class="social__link" href="https://github.com/kimziont" target="_blank" rel="noopener"
                    aria-label=" link"><i class="ion ion-logo-github"></i></a>
                </li>
                
                <li class="social__item">
                  <a class="social__link" href="https://linkedin.com" target="_blank" rel="noopener"
                    aria-label=" link"><i class="ion ion-logo-linkedin"></i></a>
                </li>
                
                <li class="social__item">
                  <a class="social__link" href="https://facebook.com" target="_blank" rel="noopener"
                    aria-label=" link"><i class="ion ion-logo-facebook"></i></a>
                </li>
                
                <li class="social__item">
                  <a class="social__link" href="https://instagram.com" target="_blank" rel="noopener"
                    aria-label=" link"><i class="ion ion-logo-instagram"></i></a>
                </li>
                
                <li class="social__item">
                  <a class="social__link" href="https://youtube.com" target="_blank" rel="noopener"
                    aria-label=" link"><i class="ion ion-logo-youtube"></i></a>
                </li>
                
              </ul>
            </div>
            
          </div>
        </div>

        
        <div class="col col-6 push-1 col-d-12 push-d-0">
          <div class="footer__gallery">
            <h3 class="footer__gallery-title">Gallery</h3>
            
            <div class="gallery-footer">
              <div class="gallery" style="grid-template-columns: repeat(3, auto);">
                
                <div class="gallery__image">
                  <img src="/images/100.jpg" alt="Rest" loading="lazy">
                </div>
                
                <div class="gallery__image">
                  <img src="/images/101.jpg" alt="Lifestyle" loading="lazy">
                </div>
                
                <div class="gallery__image">
                  <img src="/images/102.jpg" alt="Hobby" loading="lazy">
                </div>
                
                <div class="gallery__image">
                  <img src="/images/103.jpg" alt="Notes" loading="lazy">
                </div>
                
                <div class="gallery__image">
                  <img src="/images/104.jpg" alt="Rest" loading="lazy">
                </div>
                
                <div class="gallery__image">
                  <img src="/images/105.jpg" alt="Hobby" loading="lazy">
                </div>
                
                <div class="gallery__image">
                  <img src="/images/106.jpg" alt="Fashion" loading="lazy">
                </div>
                
                <div class="gallery__image">
                  <img src="/images/107.jpg" alt="Notes" loading="lazy">
                </div>
                
                <div class="gallery__image">
                  <img src="/images/108.jpg" alt="Rest" loading="lazy">
                </div>
                
              </div>
            </div>
            
          </div>
        </div>
        

      </div>
    </div>
  </div>

  <div class="footer__info">
    <div class="container">
      <div class="row">
        <div class="col col-12">
          <div class="footer__info-box">
            <div class="copyright">2023 &copy; <a href="/">Code Museum</a>. Crafted & Designed by <a href="https://jekyllthemes.io/developers/artem-sheludko">Artem Sheludko</a>.</div>
            <div class="top" title="Top"><i class="ion ion-ios-arrow-up"></i></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</footer>
<!-- end footer -->

  <script src="/js/scripts.js"></script>
  <script src="/js/common.js"></script>
</body>