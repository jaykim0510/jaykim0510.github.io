I"–<hr />

<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#ì°¸ê³ " id="markdown-toc-ì°¸ê³ ">ì°¸ê³ </a></li>
</ul>

<hr />

<p>Elasticsearch 6.xëŠ” arm ì•„í‚¤í…ì²˜ ì§€ì› X (ë„ì»¤ ê¸°ì¤€)</p>

<p>ë‚˜ëŠ” m1ì´ë¼ì„œ Elasticsearch 7.x ì´ìƒ ì¨ì•¼ë¨</p>

<p>Elasticsearch-Hadoopì€ ì–´ë–¤ ë²„ì „ì—ì„œë“  7.x ì •ì‹ ì§€ì› ì•ˆí•¨.</p>

<p>MongoDBë¡œ ìƒê°í•´ë³´ìâ€¦â€¦â€¦â€¦â€¦</p>

<p>ESì™€ Spark ì»¨í…Œì´ë„ˆ ì‹¤í–‰</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.2'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">elasticsearch</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">elasticsearch:7.16.2</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">elasticsearch</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9200:9200"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">9300:9300"</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">ES_JAVA_OPTS</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-Xmx256m</span><span class="nv"> </span><span class="s">-Xms256m"</span>
      <span class="na">ELASTIC_PASSWORD</span><span class="pi">:</span> <span class="s">changeme</span>
      <span class="na">ELASTIC_USERNAME</span><span class="pi">:</span> <span class="s">elastic</span>
      <span class="na">discovery.type</span><span class="pi">:</span> <span class="s">single-node</span>
  
  <span class="na">spark</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">kimziont:spark</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">spark</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">4040:4040"</span>
    <span class="na">tty</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<p>Sparkì—ì„œ ElasticSearchë¥¼ ì“°ë ¤ë©´ ì»¤ë„¥í„°ê°€ í•„ìš”í•œ ê²ƒ ê°™ë‹¤. Elasticì—ì„œ ì´ë¥¼ ìœ„í•´ elasticsearch-hadoopë¥¼ ì œê³µí•˜ëŠ”ë° ìš°ì„  ë‹¤ìš´ì„ ë°›ì•„ì•¼ í•œë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://artifacts.elastic.co/downloads/elasticsearch-hadoop/elasticsearch-hadoop-6.4.1.zip
unzip elasticsearch-hadoop-6.4.1.zip
<span class="nb">mkdir</span> <span class="nt">-p</span> /app/spark/jars/ext/elasticsearch-hadoop
<span class="nb">mv </span>elasticsearch-hadoop-6.4.1 /app/spark/jars/ext/elasticsearch-hadoop/6.4.1
</code></pre></div></div>

<p>ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìœ¼ë©´ ìŠ¤íŒŒí¬ë¥¼ ì‹¤í–‰í•  ë•Œ ì„¤ì¹˜í•œ ê²½ë¡œë¥¼ ì‹¤í–‰ ì¸ìë¡œ ì£¼ë©´ë˜ëŠ” ê²ƒ ê°™ë‹¤.</p>

<p>pysparkì—ì„œ ì‚¬ìš©í•  ë•ŒëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># pyspark ì‹¤í–‰ ì»¤ë§¨ë“œ</span>
pyspark <span class="nt">--driver-class-path</span><span class="o">=</span>/app/spark/jars/ext/elasticsearch-hadoop/6.4.1/dist/elasticsearch-hadoop-6.4.1.jar
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="s">"org.elasticsearch.spark.sql"</span><span class="p">).</span><span class="n">option</span><span class="p">(</span><span class="s">"es.read.field.as.array.include"</span><span class="p">,</span> <span class="s">"NerArray"</span><span class="p">).</span><span class="n">option</span><span class="p">(</span><span class="s">"es.nodes"</span><span class="p">,</span><span class="s">"localhost:9200"</span><span class="p">).</span><span class="n">option</span><span class="p">(</span><span class="s">"es.nodes.discovery"</span><span class="p">,</span> <span class="s">"true"</span><span class="p">).</span><span class="n">load</span><span class="p">(</span><span class="s">"indexëª…"</span><span class="p">)</span> 

<span class="n">df</span><span class="p">.</span><span class="n">registerTempTable</span><span class="p">(</span><span class="s">"ner"</span><span class="p">)</span> <span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">"show tables"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span> 

<span class="n">spark</span><span class="p">.</span><span class="n">sql</span><span class="p">(</span><span class="s">"select * from ner"</span><span class="p">).</span><span class="n">show</span><span class="p">()</span>

</code></pre></div></div>

<p>spark-shellì„ ì‚¬ìš©í•  ë•ŒëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spark-shell --jars /app/spark/jars/ext/elasticsearch-hadoop/6.4.1/dist/elasticsearch-hadoop-6.4.1.jar
</code></pre></div></div>

<h1 id="ì°¸ê³ ">ì°¸ê³ </h1>

<ul>
  <li>
    <p><a href="https://docs.docker.com/engine/reference/builder/#cmd" target="_blank">Docker ê³µì‹ë¬¸ì„œ</a></p>
  </li>
  <li><a href="https://oboki.net/workspace/python/pyspark-elasticsearch-index-ì—ì„œ-dataframe-ìƒì„±í•˜ê¸°/" target="_blank">Sparkì™€ ElasticSearch ì—°ë™í•˜ê¸°</a></li>
  <li><a href="https://github.com/elastic/elasticsearch-hadoop" target="_blank">elasticsearch-hadoop</a></li>
  <li><a href="http://jason-heo.github.io/programming/2021/01/16/es-hadoop-spark30.html">Jason Heoâ€™s Blog: Spark 3.0ì—ì„œ elasticsearch hadoop ì‚¬ìš©í•˜ê¸°</a></li>
</ul>
:ET