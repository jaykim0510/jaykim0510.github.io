I"<hr />

<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#workdir" id="markdown-toc-workdir">WORKDIR</a></li>
  <li><a href="#volume" id="markdown-toc-volume">VOLUME</a></li>
  <li><a href="#copy" id="markdown-toc-copy">COPY</a></li>
  <li><a href="#add" id="markdown-toc-add">ADD</a></li>
  <li><a href="#참고" id="markdown-toc-참고">참고</a></li>
</ul>

<hr />

<h1 id="workdir">WORKDIR</h1>

<ul>
  <li><code class="language-plaintext highlighter-rouge">WORKDIR</code> 인스트럭션은 Docker 파일에서 이어지는 모든 <code class="language-plaintext highlighter-rouge">RUN</code>, <code class="language-plaintext highlighter-rouge">CMD</code>, <code class="language-plaintext highlighter-rouge">ENTRIPOINT</code>, <code class="language-plaintext highlighter-rouge">COPY</code> 및 <code class="language-plaintext highlighter-rouge">ADD</code> 인스트럭션에 대한 <strong>작업 디렉토리를 설정</strong>한다</li>
  <li><code class="language-plaintext highlighter-rouge">WORKDIR</code>을 명시하지 않은 경우, 베이스 이미지의 <code class="language-plaintext highlighter-rouge">WORKDIR</code>을 이어받는다. 베이스 이미지에도 없으면 디폴트로 루트 경로(<code class="language-plaintext highlighter-rouge">/</code>)가 된다</li>
  <li>
    <p>명시한 경로가 없으면 경로에 필요한 디렉터리를 만든다</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">WORKDIR</code> 명령은 Docker 파일에서 여러 번 사용할 수 있다</li>
  <li>상대 경로가 제공되는 경우 이전 <code class="language-plaintext highlighter-rouge">WORKDIR</code> 명령의 경로에 상대적이다. 예를 들어 다음 <code class="language-plaintext highlighter-rouge">RUN</code> 인스트럭션의 작업 디렉토리는 <code class="language-plaintext highlighter-rouge">/a/b/c</code>이다</li>
</ul>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WORKDIR</span><span class="s"> /a</span>
<span class="k">WORKDIR</span><span class="s"> b</span>
<span class="k">WORKDIR</span><span class="s"> c</span>
<span class="k">RUN </span><span class="nb">pwd</span>
</code></pre></div></div>

<ul>
  <li>또한 <code class="language-plaintext highlighter-rouge">ENV</code>를 이용해 Dockerfile에서 명시한 환경 변수의 경우 <code class="language-plaintext highlighter-rouge">WORKDIR</code> 명령어에서 해석할 수 있다</li>
  <li>아래의 <code class="language-plaintext highlighter-rouge">$DIRPATH/$DIRNAME</code>은 <code class="language-plaintext highlighter-rouge">/path/$DIRNAME</code>으로 해석된다</li>
</ul>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ENV</span><span class="s"> DIRPATH=/path</span>
<span class="k">WORKDIR</span><span class="s"> $DIRPATH/$DIRNAME</span>
<span class="k">RUN </span><span class="nb">pwd</span>
</code></pre></div></div>

<h1 id="volume">VOLUME</h1>

<ul>
  <li>컨테이너의 마운트 지점을 생성한다</li>
  <li>데이터베이스 같은 유상태 애플리케이션의 경우 사용자가 볼륨을 지정하지 않더라도 데이터를 유실하지 않기 위한 안전장치 용도이다</li>
</ul>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">VOLUME</span><span class="s"> /data</span>
</code></pre></div></div>

<h1 id="copy">COPY</h1>

<ul>
  <li><code class="language-plaintext highlighter-rouge">COPY</code> 인스트럭션은 호스트 파일 시스템의 파일을 컨테이너에 복사한다</li>
  <li><code class="language-plaintext highlighter-rouge">COPY &lt;source&gt; &lt;target&gt;</code>
    <ul>
      <li>source에는 파일 하나가 올 수도 있고, 와일드카드로 여러 파일을 매치할 수도 있다</li>
      <li>target에는 절대경로가 올 수도 있고, 상대경로가 올 수도 있다. 상대경로가 올 경우 <code class="language-plaintext highlighter-rouge">WORKDIR</code>에 대한 상대경로가 된다</li>
    </ul>
  </li>
</ul>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># t로 시작하는 모든 txt파일을 &lt;WORKDIR&gt;/relativeDir/ 로 복사한다</span>
<span class="k">COPY</span><span class="s"> t*.txt relativeDir/</span>
</code></pre></div></div>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># test.txt, teso.txt, tesi.txt과 같은 파일을 /absoluteDir/ 로 복사한다</span>
<span class="k">COPY</span><span class="s"> tes?.txt /absoluteDir/</span>
</code></pre></div></div>

<h1 id="add">ADD</h1>

<ul>
  <li><code class="language-plaintext highlighter-rouge">COPY</code> 인스트럭션과 비슷하다</li>
  <li><code class="language-plaintext highlighter-rouge">ADD</code>는 추가로 URL을 통해 파일을 다운로드할 수 있고, 압축된 파일을 자동으로 추출할 수 있는 기능도 가지고 있다</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">COPY</code>가 더욱 명료하고 예측 가능하다는 점 때문에 도커에서 권장한다. 특별한 경우에만 <code class="language-plaintext highlighter-rouge">ADD</code>를 사용하는 것이 좋다</p>
  </li>
  <li>아래 예시는 <code class="language-plaintext highlighter-rouge">big.tar.xz</code> 파일을 <code class="language-plaintext highlighter-rouge">http://example.com</code>에서 다운로드하고, <code class="language-plaintext highlighter-rouge">/container_directory</code>에 압축 해제하여 추가한다</li>
</ul>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ADD</span><span class="s"> http://example.com/big.tar.xz /container_directory</span>
</code></pre></div></div>

<h1 id="참고">참고</h1>

<ul>
  <li><a href="https://docs.docker.com/reference/dockerfile/" target="_blank">Docker 공식문서</a></li>
  <li><a href="https://kimjingo.tistory.com/240">[Docker] Dockerfile의 COPY와 ADD 명령어 비교, 김징어의 Devlog</a></li>
</ul>
:ET