I"Ğ4<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#connection-client-to-broker" id="markdown-toc-connection-client-to-broker">Connection Client To Broker</a>    <ul>
      <li><a href="#scenario-0-client-and-kafka-running-on-the-same-local-machine" id="markdown-toc-scenario-0-client-and-kafka-running-on-the-same-local-machine">Scenario 0: Client and Kafka running on the same local machine</a></li>
      <li><a href="#scenario-1-client-and-kafka-running-on-the-different-machines" id="markdown-toc-scenario-1-client-and-kafka-running-on-the-different-machines">Scenario 1: Client and Kafka running on the different machines</a></li>
      <li><a href="#scenario-2-kafka-and-client-running-in-docker" id="markdown-toc-scenario-2-kafka-and-client-running-in-docker">Scenario 2: Kafka and client running in Docker</a></li>
      <li><a href="#scenario-3-kafka-in-docker-container-with-a-client-running-locally" id="markdown-toc-scenario-3-kafka-in-docker-container-with-a-client-running-locally">Scenario 3: Kafka in Docker container with a client running locally</a>        <ul>
          <li><a href="#adding-a-new-listener-to-the-broker" id="markdown-toc-adding-a-new-listener-to-the-broker">Adding a new listener to the broker</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<hr />

<p><a href="https://www.confluent.io/blog/kafka-client-cannot-connect-to-broker-on-aws-on-docker-etc/?utm_source=github&amp;utm_medium=rmoff&amp;utm_campaign=ty.community.con.rmoff-listeners&amp;utm_term=rmoff-devx" target="_blank">ì›ë¬¸: Confluentë¸”ë¡œê·¸</a></p>

<h1 id="connection-client-to-broker">Connection Client To Broker</h1>

<p>í´ë¼ì´ì–¸íŠ¸ì™€ ì¹´í”„ì¹´ê°„ì˜ ë©”ì„¸ì§€ë¥¼ ì£¼ê³ ë°›ê¸° ìœ„í•´ì„œëŠ” ë‘ ê°€ì§€ì˜ ì—°ê²°ì´ ë°˜ë“œì‹œ ì„ í–‰ë˜ì–´ì•¼ í•œë‹¤.</p>

<ol>
  <li>ë¸Œë¡œì»¤ì™€ì˜ ì´ˆê¸° ì—°ê²°. ì—°ê²°ì´ ë˜ë©´ ë¸Œë¡œì»¤ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì—°ê²° ê°€ëŠ¥(resolvable and accessible from client machine)í•œ ë¸Œë¡œì»¤ì˜ ì—”ë“œí¬ì¸íŠ¸ ì œê³µ(<code class="language-plaintext highlighter-rouge">advertised.listeners</code>)</li>
  <li>í´ë¼ì´ì–¸íŠ¸ì™€ ì—°ê²° ê°€ëŠ¥í•œ ë¸Œë¡œì»¤ì™€ì˜ ì—°ê²°</li>
</ol>

<p>ì´ˆê¸° ì—°ê²°ì€ <code class="language-plaintext highlighter-rouge">producer = KafkaProducer(bootstrap_servers=["localhost:9092"])</code> ì™€ ê°™ì´ bootstrap_servers ì¤‘ í•˜ë‚˜ì˜ ì„œë²„ì™€ ì´ˆê¸° ì—°ê²°ëœë‹¤. ê·¸ëŸ¬ë©´ ì—°ê²°ëœ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì—ê²Œ <code class="language-plaintext highlighter-rouge">advertised.listeners</code>ë¥¼ ë…¸ì¶œí•´ ì—°ê²°ë˜ë„ë¡ í•œë‹¤.</p>

<p>ì˜ˆì‹œë¡œ í´ë¼ì´ì–¸íŠ¸ì™€ ì¹´í”„ì¹´ê°€ ì„œë¡œ ë‹¤ë¥¸ ë¨¸ì‹ ì— ìˆëŠ” ê²½ìš°ë¥¼ ë³´ì.</p>

<p>ì—°ê²°ì´ ì„±ê³µë˜ëŠ” ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<p><img src="/images/kafka_39.png" alt="" /></p>

<p>ì—°ê²°ì´ ì‹¤íŒ¨ë˜ëŠ” ê²½ìš°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<p><img src="/images/kafka_40.png" alt="" /></p>

<p>ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” <code class="language-plaintext highlighter-rouge">advertised.listeners</code>ë¥¼ <code class="language-plaintext highlighter-rouge">localhost:9092</code>ë¡œ ì„¤ì •í•˜ë©´ ì•ˆëœë‹¤.</p>

<h2 id="scenario-0-client-and-kafka-running-on-the-same-local-machine">Scenario 0: Client and Kafka running on the same local machine</h2>

<p><img src="/images/kafka_41.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bootstrap_servers = 'localhost:9092'
advertised_listeners = 'localhost:9092'  
</code></pre></div></div>
<p>ì˜ ë™ì‘í•œë‹¤.</p>

<p>í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬ë˜ëŠ” ë©”íƒ€ë°ì´í„°ëŠ” 192.168.10.83ì´ë‹¤. ì´ ê°’ì€ ë¡œì»¬ ë¨¸ì‹ ì˜ IP ì£¼ì†Œì´ë‹¤.</p>

<h2 id="scenario-1-client-and-kafka-running-on-the-different-machines">Scenario 1: Client and Kafka running on the different machines</h2>

<p>ì¹´í”„ì¹´ ë¸Œë¡œì»¤ê°€ ë‹¤ë¥¸ ë¨¸ì‹ ì—ì„œ ë™ì‘í•˜ëŠ” ê²½ìš°ë¥¼ ì‚´í´ë³´ì. ì˜ˆë¥¼ ë“¤ë©´ AWS, GCPì™€ ê°™ì€ í´ë¼ìš°ë“œì—ì„œ ìƒì„±í•œ ë¨¸ì‹ </p>

<p><img src="/images/kafka_42.png" alt="" /></p>

<p>ì—¬ê¸° ì˜ˆì œì—ì„œ í´ë¼ì´ì–¸íŠ¸ëŠ” ë‚˜ì˜ ë…¸íŠ¸ë¶ì´ê³  ì¹´í”„ì¹´ ë¸Œë¡œì»¤ê°€ ë™ì‘í•˜ê³  ìˆëŠ” ë¨¸ì‹ ì˜ LANì€ <code class="language-plaintext highlighter-rouge">asgard03</code>ì´ë¼ê³  í•´ë³´ì.</p>

<p>ì´ˆê¸° ì—°ê²°ì€ ì„±ê³µí•œë‹¤. í•˜ì§€ë§Œ ë©”íƒ€ë°ì´í„°ì—ì„œ ëŒë ¤ì£¼ëŠ” ë…¸ì¶œëœ ë¦¬ìŠ¤ë„ˆëŠ” <code class="language-plaintext highlighter-rouge">localhost</code>ì´ë‹¤. í•˜ì§€ë§Œ í´ë¼ì´ì–¸íŠ¸ì˜ <code class="language-plaintext highlighter-rouge">localhost</code>ì—ëŠ” ì¹´í”„ì¹´ ë¸Œë¡œì»¤ê°€ ì—†ìœ¼ë¯€ë¡œ ì—°ê²°ì€ ì‹¤íŒ¨í•œë‹¤.<br />
<img src="/images/kafka_43.png" alt="" /></p>

<p>ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” <code class="language-plaintext highlighter-rouge">server.properties</code>ì—ì„œ <code class="language-plaintext highlighter-rouge">advertised.listeners</code> ê°’ì„ ìˆ˜ì •í•´ <strong>í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì˜¬ë°”ë¥¸ í˜¸ìŠ¤íŠ¸ë„¤ì„ê³¼ í¬íŠ¸ë¥¼ ì œê³µ</strong>í•´ì£¼ì–´ì•¼ í•œë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># advertised.listeners ìˆ˜ì • ì „</span>
advertised.listeners<span class="o">=</span>PLAINTEXT://localhost:9092
<span class="nv">listeners</span><span class="o">=</span>PLAINTEXT://0.0.0.0:9092
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># advertised.listeners ìˆ˜ì • í›„</span>
advertised.listeners<span class="o">=</span>PLAINTEXT://asgard03.moffatt.me:9092
<span class="nv">listeners</span><span class="o">=</span>PLAINTEXT://0.0.0.0:9092
</code></pre></div></div>

<p><img src="/images/kafka_44.png" alt="" /></p>

<h2 id="scenario-2-kafka-and-client-running-in-docker">Scenario 2: Kafka and client running in Docker</h2>

<p>ë„ì»¤ë¥¼ ì´ìš©í•  ë•Œ ê¸°ì–µí•´ì•¼í•  ì ì€ ë„ì»¤ëŠ” ì»¨í…Œì´ë„ˆë¥¼ í†µí•´ ê·¸ë“¤ë§Œì˜ ì‘ì€ ì„¸ìƒì„ ë§Œë“ ë‹¤ëŠ” ê²ƒì´ë‹¤. ì»¨í…Œì´ë„ˆëŠ” ìì²´ì ì¸ í˜¸ìŠ¤íŠ¸ë„¤ì„, ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ, íŒŒì¼ ì‹œìŠ¤í…œì„ ê°€ì§€ê³  ìˆë‹¤. ë”°ë¼ì„œ ì»¨í…Œì´ë„ˆë¥¼ ê¸°ì¤€ìœ¼ë¡œ localhostëŠ” ë”ì´ìƒ ë‚˜ì˜ ë…¸íŠ¸ë¶ì´ ì•„ë‹ˆë‹¤. ë„ì»¤ ì»¨í…Œì´ë„ˆì—ì„œ localhostëŠ” ì»¨í…Œì´ë„ˆ ìê¸° ìì‹ ì´ë‹¤.</p>

<p><img src="/images/kafka_46.png" alt="" /></p>

<p>ì—¬ê¸°ì„œëŠ” ì¹´í”„ì¹´ì™€ í´ë¼ì´ì–¸íŠ¸ë¥¼ ëª¨ë‘ ê°ê° ë„ì»¤ í˜¸ìŠ¤íŠ¸ ìœ„ì— ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ì–´ ë³¸ë‹¤.</p>

<p>í´ë¼ì´ì–¸íŠ¸ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ì–´ì£¼ëŠ” Dockerfileì´ë‹¤.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">FROM python:3</span>

<span class="c1"># We'll add netcat cos it's a really useful</span>
<span class="c1"># network troubleshooting tool</span>
<span class="s">RUN apt-get update</span>
<span class="s">RUN apt-get install -y netcat</span>

<span class="c1"># Install the Confluent Kafka python library</span>
<span class="s">RUN pip install confluent_kafka</span>

<span class="c1"># Add our script</span>
<span class="s">ADD python_kafka_test_client.py /</span>
<span class="s">ENTRYPOINT [ "python", "/python_kafka_test_client.py"]</span>
</code></pre></div></div>

<p>ìœ„ì˜ ë©”ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ ì´ìš©í•´ í´ë¼ì´ì–¸íŠ¸ ì´ë¯¸ì§€ë¥¼ ë§Œë“ ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build -t python_kafka_test_client .
</code></pre></div></div>

<p>ì¹´í”„ì¹´ ë¸Œë¡œì»¤ë¥¼ ìƒì„±í•˜ì.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network create rmoff_kafka
docker run <span class="nt">--network</span><span class="o">=</span>rmoff_kafka <span class="nt">--rm</span> <span class="nt">--detach</span> <span class="nt">--name</span> zookeeper <span class="nt">-e</span> <span class="nv">ZOOKEEPER_CLIENT_PORT</span><span class="o">=</span>2181 confluentinc/cp-zookeeper:5.5.0
docker run <span class="nt">--network</span><span class="o">=</span>rmoff_kafka <span class="nt">--rm</span> <span class="nt">--detach</span> <span class="nt">--name</span> broker <span class="se">\</span>
           <span class="nt">-p</span> 9092:9092 <span class="se">\</span>
           <span class="nt">-e</span> <span class="nv">KAFKA_BROKER_ID</span><span class="o">=</span>1 <span class="se">\</span>
           <span class="nt">-e</span> <span class="nv">KAFKA_ZOOKEEPER_CONNECT</span><span class="o">=</span>zookeeper:2181 <span class="se">\</span>
           <span class="nt">-e</span> <span class="nv">KAFKA_ADVERTISED_LISTENERS</span><span class="o">=</span>PLAINTEXT://localhost:9092 <span class="se">\</span>
           <span class="nt">-e</span> <span class="nv">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="o">=</span>1 <span class="se">\</span>
           confluentinc/cp-kafka:5.5.0

</code></pre></div></div>

<p>ì¥¬í‚¤í¼ì™€ ì¹´í”„ì¹´ ë¸Œë¡œì»¤ê°€ ì»¨í…Œì´ë„ˆë¡œ ëŒì•„ê°€ê³  ìˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker ps
IMAGE                              STATUS              PORTS                          NAMES
confluentinc/cp-kafka:5.5.0        Up 32 seconds       0.0.0.0:9092-&gt;9092/tcp         broker
confluentinc/cp-zookeeper:5.5.0    Up 33 seconds       2181/tcp, 2888/tcp, 3888/tcp   zookeeper
</code></pre></div></div>

<p>ìœ„ì—ì„œ ìš°ë¦¬ëŠ” ìš°ë¦¬ë§Œì˜ ë„ì»¤ ë„¤íŠ¸ì›Œí¬ë¥¼ ë§Œë“¤ì—ˆê³  ì´ì œ ì´ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì™€ ë¸Œë¡œì»¤ê°€ í†µì‹ í•˜ë„ë¡ í•´ë³´ì</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run --network=rmoff_kafka --rm --name python_kafka_test_client \
        --tty python_kafka_test_client broker:9092
</code></pre></div></div>

<p>ê²°ê³¼ë¥¼ ë³´ë©´ ì´ˆê¸° ì—°ê²°ì€ ì„±ê³µí•˜ì§€ë§Œ, ë©”íƒ€ë°ì´í„°ë¡œ <code class="language-plaintext highlighter-rouge">localhost</code>ë¥¼ ëŒë ¤ì£¼ê¸° ë•Œë¬¸ì— í”„ë¡œë“€ì„œì™€ í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²°ì€ ì‹¤íŒ¨ëœë‹¤.</p>

<p><img src="/images/kafka_47.png" alt="" /></p>

<p>ì´ë¥¼ í•´ê²°í•˜ë ¤ë©´ advertise.listenersì˜ í˜¸ìŠ¤íŠ¸ë„¤ì„ì„ ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ ë°”ê¿”ì¤˜ì•¼ í•œë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìˆ˜ì • ì „</span>
<span class="nt">-e</span> <span class="nv">KAFKA_ADVERTISED_LISTENERS</span><span class="o">=</span>PLAINTEXT://localhost:9092 <span class="se">\</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìˆ˜ì • í›„ </span>
<span class="nt">-e</span> <span class="nv">KAFKA_ADVERTISED_LISTENERS</span><span class="o">=</span>PLAINTEXT://broker:9092 <span class="se">\</span>
</code></pre></div></div>

<p><img src="/images/kafka_48.png" alt="" /></p>

<p>ìµœì¢…ì ìœ¼ë¡œ ë¸Œë¡œì»¤ ì„¤ì •ì„ ë‹¤ìŒê³¼ ê°™ì´ ê³ ì¹  ìˆ˜ ìˆë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker stop broker
docker run <span class="nt">--network</span><span class="o">=</span>rmoff_kafka <span class="nt">--rm</span> <span class="nt">--detach</span> <span class="nt">--name</span> broker <span class="se">\</span>
           <span class="nt">-p</span> 9092:9092 <span class="se">\</span>
           <span class="nt">-e</span> <span class="nv">KAFKA_BROKER_ID</span><span class="o">=</span>1 <span class="se">\</span>
           <span class="nt">-e</span> <span class="nv">KAFKA_ZOOKEEPER_CONNECT</span><span class="o">=</span>zookeeper:2181 <span class="se">\</span>
           <span class="nt">-e</span> <span class="nv">KAFKA_ADVERTISED_LISTENERS</span><span class="o">=</span>PLAINTEXT://broker:9092 <span class="se">\</span>
           <span class="nt">-e</span> <span class="nv">KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span class="o">=</span>1 <span class="se">\</span>
           confluentinc/cp-kafka:5.5.0

</code></pre></div></div>

<h2 id="scenario-3-kafka-in-docker-container-with-a-client-running-locally">Scenario 3: Kafka in Docker container with a client running locally</h2>

<p><img src="/images/kafka_49.png" alt="" /></p>

<p>ìœ„ì˜ Scenario 2ì™€ ë¹„êµí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ê°€ ì»¨í…Œì´ë„ˆí™” ë˜ì–´ ìˆë‹¤ê°€ ì—¬ê¸°ì„œëŠ” ë”°ë¡œ ì»¨í…Œì´ë„ˆí™” ë˜ì§€ ì•Šê³  ë¡œì»¬ ë¨¸ì‹  ìœ„ì— ìˆë‹¤. (ì´ëŸ¬í•œ ì°¨ì´ë¡œ ìœ„ì—ì„œ í•˜ë˜ ë°©ì‹ì´ ì™œ ì•ˆë˜ëŠ” ê±´ì§€ ëª¨ë¥´ê² ë‹¤â€¦)</p>

<p>ë¡œì»¬ì— ì‹¤í–‰í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ëŠ” ë”°ë¡œ ë„¤íŠ¸ì›Œí¬ê°€ êµ¬ì„±ë˜ì–´ ìˆì§€ ì•Šë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë”°ë¡œ íŠ¹ì • íŠ¸ë˜í”½ì„ ë°›ê¸° ìœ„í•´ì„œëŠ” ë¡œì»¬ì˜ í¬íŠ¸ë¥¼ ì—´ì–´ ì´ë¥¼ í†µí•´ í†µì‹ í•´ì•¼ í•œë‹¤. ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ <code class="language-plaintext highlighter-rouge">9092:9092 í¬íŠ¸</code>ë¥¼ ì—´ì—ˆë‹¤ê³  í•´ë³´ì. í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œì»¬ì˜ 9092í¬íŠ¸ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì ‘ê·¼í•˜ê¸° ìœ„í•´ì„œëŠ” <code class="language-plaintext highlighter-rouge">bootstrap_servers='localhost:9092'</code>ë¡œ í•´ì•¼ í•œë‹¤. <code class="language-plaintext highlighter-rouge">advertised.listeners</code>ëŠ” <code class="language-plaintext highlighter-rouge">broker:9092</code>ë¡œ í•´ì•¼ í•œë‹¤(í´ë¼ì´ì–¸íŠ¸ì™€ <code class="language-plaintext highlighter-rouge">localhost</code>ê´€ê³„ê°€ ì•„ë‹ˆë¯€ë¡œ).</p>

<p><img src="/images/kafka_50.png" alt="" /></p>

<p>ë¬¸ì œëŠ” í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œ <code class="language-plaintext highlighter-rouge">broker:9092</code>ëŠ” resolvableí•˜ì§€ ì•Šë‹¤.</p>

<h3 id="adding-a-new-listener-to-the-broker">Adding a new listener to the broker</h3>
:ET