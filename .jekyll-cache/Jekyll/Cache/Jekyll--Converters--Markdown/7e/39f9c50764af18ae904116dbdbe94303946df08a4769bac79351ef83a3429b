I"Õ2<hr />

<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#cdc" id="markdown-toc-cdc">CDC</a>    <ul>
      <li><a href="#cdcë¥¼-êµ¬í˜„í•˜ëŠ”-ë°©ë²•" id="markdown-toc-cdcë¥¼-êµ¬í˜„í•˜ëŠ”-ë°©ë²•">CDCë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•</a>        <ul>
          <li><a href="#ì»¬ëŸ¼-ê²€ì‚¬" id="markdown-toc-ì»¬ëŸ¼-ê²€ì‚¬">ì»¬ëŸ¼ ê²€ì‚¬</a></li>
          <li><a href="#í…Œì´ë¸”-ë¸íƒ€" id="markdown-toc-í…Œì´ë¸”-ë¸íƒ€">í…Œì´ë¸” ë¸íƒ€</a></li>
          <li><a href="#ë¡œê·¸-ê¸°ë°˜" id="markdown-toc-ë¡œê·¸-ê¸°ë°˜">ë¡œê·¸ ê¸°ë°˜</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#debezium" id="markdown-toc-debezium">Debezium</a></li>
  <li><a href="#ì°¸ê³ " id="markdown-toc-ì°¸ê³ ">ì°¸ê³ </a></li>
</ul>

<hr />

<p>ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì— ìº¡ì²˜ëœ ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¸ëœì­ì…˜ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ìš´ì˜ ìƒíƒœë¥¼ ì´í•´í•˜ëŠ” ë° ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. ë°ì´í„°ì˜ ê°€ì¹˜ëŠ” ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ë¹ ë¥´ê²Œ ë–¨ì–´ì§€ê¸° ë•Œë¬¸ì— ì¡°ì§ì—ì„œëŠ” ë°ì´í„°ê°€ ìƒì„±ë  ë•Œ ì´ë¥¼ ë¶„ì„í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ í•„ìš”í•©ë‹ˆë‹¤. ìš´ì˜ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¤‘ë‹¨ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ê¸°ì—…ì€ ì¼ë°˜ì ìœ¼ë¡œ ë¶„ì„ì„ ìœ„í•´ ë°ì´í„°ë¥¼ ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ì— ë³µì œí•©ë‹ˆë‹¤.</p>

<p><img src="/images/cdc_5.png" alt="" /></p>

<p>ê¸°ì¡´ì—ëŠ” ë°°ì¹˜ ê¸°ë°˜ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬ í•˜ë£¨ì— í•œ ë²ˆ ë˜ëŠ” ì—¬ëŸ¬ ë²ˆ ë°ì´í„°ë¥¼ ì´ë™í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë°°ì¹˜ ì´ë™ì€ ì§€ì—° ì‹œê°„ì„ ìœ ë°œí•˜ê³  ì¡°ì§ì— ìš´ì˜ ê°€ì¹˜ë¥¼ ê°ì†Œì‹œí‚µë‹ˆë‹¤.</p>

<p>CDC(Change Data Capture)ëŠ” ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤, ë°ì´í„° ë ˆì´í¬ ë˜ëŠ” ê¸°íƒ€ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë°ì´í„°ë¥¼ ê±°ì˜ ì‹¤ì‹œê°„ìœ¼ë¡œ ì´ë™í•˜ê¸° ìœ„í•œ ì´ìƒì ì¸ ì†”ë£¨ì…˜ìœ¼ë¡œ ë¶€ìƒí–ˆìŠµë‹ˆë‹¤. ì´ ê²Œì‹œë¬¼ì—ì„œëŠ” ê±°ì˜ ì‹¤ì‹œê°„ì— ê°€ê¹Œìš´ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸í…”ë¦¬ì „ìŠ¤ ë° í´ë¼ìš°ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ì— Change Data Captureê°€ ì´ìƒì ì¸ ì´ìœ ì™€ 4ê°€ì§€ ë‹¤ë¥¸ Change Data Capture ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.</p>

<h1 id="cdc">CDC</h1>
<p>CDCëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë°ì´í„°ì— ëŒ€í•œ ë³€ê²½ ì‚¬í•­ì„ ì‹ë³„í•˜ê³  ì¶”ì í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤. CDCëŠ” ìƒˆë¡œìš´ ë°ì´í„°ë² ì´ìŠ¤ ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œ ì§€ì†ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì´ë™í•˜ê³  ì²˜ë¦¬í•˜ì—¬ ì‹¤ì‹œê°„ ë˜ëŠ” ê±°ì˜ ì‹¤ì‹œê°„ì— ê°€ê¹Œìš´ ë°ì´í„° ì´ë™ì„ ì œê³µí•©ë‹ˆë‹¤.</p>

<p><img src="/images/cdc_1.png" alt="" /></p>

<p>ì‹œê°„ì— ë¯¼ê°í•œ ì˜ì‚¬ ê²°ì •ì´ ë‚´ë ¤ì§€ëŠ” ê³ ì† ë°ì´í„° í™˜ê²½ì—ì„œ Change Data CaptureëŠ” ì§€ì—° ì‹œê°„ì´ ì§§ê³  ì•ˆì •ì ì´ë©° í™•ì¥ ê°€ëŠ¥í•œ ë°ì´í„° ë³µì œë¥¼ ë‹¬ì„±í•˜ëŠ” ë° ë§¤ìš° ì í•©í•©ë‹ˆë‹¤.</p>

<p>2025ë…„ê¹Œì§€ 80% ì´ìƒì˜ ê¸°ì—…ì´ ë©€í‹° í´ë¼ìš°ë“œ ì „ëµì„ êµ¬í˜„í•  ê³„íšì„ ì„¸ìš°ê³  ìˆëŠ” ê°€ìš´ë°, ì—¬ëŸ¬ í™˜ê²½ì—ì„œ ë°ì´í„°ë¥¼ ë³µì œí•´ì•¼ í•˜ëŠ” ìƒí™©ì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ì— ì í•©í•œ CDC ë°©ë²•ì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ê·¸ ì–´ëŠ ë•Œë³´ë‹¤ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>

<h2 id="cdcë¥¼-êµ¬í˜„í•˜ëŠ”-ë°©ë²•">CDCë¥¼ êµ¬í˜„í•˜ëŠ” ë°©ë²•</h2>

<h3 id="ì»¬ëŸ¼-ê²€ì‚¬">ì»¬ëŸ¼ ê²€ì‚¬</h3>

<p>By using existing â€œLAST_UPDATEDâ€ or â€œDATE_MODIFIEDâ€ columns, or by adding them if not available in the application, you can create your own change data capture solution at the application level. This approach retrieves only the rows that have been changed since the data was last extracted.</p>

<p>The CDC logic for the technique would be:</p>

<p>Step 1: Get the maximum value of both the target (blue) tableâ€™s â€˜Created_Timeâ€™ and â€˜Updated_Timeâ€™ columns</p>

<p>Step 2: Select all the rows from the data source with â€˜Created_Timeâ€™ greater than (&gt;) the target tableâ€™s maximum â€˜Created_Timeâ€™ , which are all the newly created rows since the last CDC process was executed.</p>

<p>Step 3: Select all rows from the source table that have an â€˜Updated_Timeâ€™ greater than (&gt;) the target tableâ€™s maximum â€˜Updated_Timeâ€™ but less than (&lt;) its maximum â€˜Created_Timeâ€™. The reason for the exclusion of rows less than the maximum target create date is that they were included in step 2.</p>

<p>Step 4: Insert new rows from step 2 or modify existing rows from step 3 in the target.</p>

<h3 id="í…Œì´ë¸”-ë¸íƒ€">í…Œì´ë¸” ë¸íƒ€</h3>

<p>SQLë¬¸ì„ ì‚¬ìš©í•´ì„œ ì†ŒìŠ¤ í…Œì´ë¸”ê³¼ íƒ€ê²Ÿ í…Œì´ë¸”ê°„ì˜ í…Œì´ë¸” ë¸íƒ€(table delta ë˜ëŠ” tablediff)ë¥¼ íƒ€ê²Ÿ í…Œì´ë¸”ì— ì ìš©(apply ë˜ëŠ” propagation)</p>

<p><img src="/images/cdc_2.png" alt="" /></p>

<p><a href="https://www.mssqltips.com/sqlservertip/2779/ways-to-compare-and-find-differences-for-sql-server-tables-and-data/" target="_blank"><strong>(Ways to compare and find differences for SQL Server tables and data ì°¸ê³ )</strong></a></p>

<ul>
  <li>ì¥ì 
    <ul>
      <li>ë³€ê²½ëœ ë°ì´í„°ë¥¼ ì •í™•íˆ ë³¼ ìˆ˜ ìˆë‹¤</li>
    </ul>
  </li>
  <li>ë‹¨ì 
    <ul>
      <li>ë°ì´í„°, ì´ì „ ìŠ¤ëƒ…ìƒ·, í˜„ì¬ ìŠ¤ëƒ…ìƒ·ì„ ëª¨ë‘ ì €ì¥í•˜ê³  ìˆì–´ì•¼ í•´ì„œ ìš©ëŸ‰ ì¸¡ë©´ì—ì„œ ë¹„íš¨ìœ¨ì </li>
      <li>ë°ì´í„°ê°€ ì»¤ì§ˆìˆ˜ë¡ ë³€ê²½ëœ ë¶€ë¶„ ìº¡ì²˜í•˜ëŠ”ë° CPU ìì› ì‚¬ìš©ëŸ‰ì´ ì„ í˜•ì ìœ¼ë¡œ ì¦ê°€</li>
      <li>ìº¡ì²˜í•˜ëŠ”ë° ì§€ì—°ì´ ë°œìƒí•˜ê¸° ë•Œë¬¸ì— ì‹¤ì‹œê°„ ë°ì´í„° í™˜ê²½ì—ì„œ í™œìš©ë„ ë–¨ì–´ì§</li>
    </ul>
  </li>
</ul>

<h3 id="ë¡œê·¸-ê¸°ë°˜">ë¡œê·¸ ê¸°ë°˜</h3>

<p>ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ì¶©ëŒ ì‹œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³µêµ¬í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì´ë²¤íŠ¸ë¥¼ ì €ì¥í•˜ëŠ” íŠ¸ëœì­ì…˜ ë¡œê·¸(redo ë¡œê·¸ë¼ê³ ë„ í•¨)ê°€ ìˆìŠµë‹ˆë‹¤. ë¡œê·¸ ê¸°ë°˜ ë³€ê²½ ë°ì´í„° ìº¡ì²˜ë¥¼ ì‚¬ìš©í•˜ë©´ ì‚½ì…, ì—…ë°ì´íŠ¸ ë° ì‚­ì œë¥¼ í¬í•¨í•œ ìƒˆë¡œìš´ ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ì´ ì›ë³¸ ë°ì´í„°ë² ì´ìŠ¤ì˜ ê¸°ë³¸ íŠ¸ëœì­ì…˜ ë¡œê·¸ì—ì„œ ì½í™ë‹ˆë‹¤.</p>

<p><a href="https://www.striim.com/blog/log-based-change-data-capture/" target="_blank"><strong>(Log-Based Change Data Capture: the Best Method for CDC ì°¸ê³ )</strong></a></p>

<p><img src="/images/cdc_4.png" alt="" /></p>

<p>ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜ì¤€ì„ ë³€ê²½í•˜ì§€ ì•Šê³  ìš´ì˜ í…Œì´ë¸”ì„ ê²€ìƒ‰í•˜ì§€ ì•Šì•„ë„ ë³€ê²½ ì‚¬í•­ì´ ìº¡ì²˜ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë³€ê²½ ì‚¬í•­ì€ ì›Œí¬ë¡œë“œë¥¼ ì¶”ê°€í•˜ê³  ì†ŒìŠ¤ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ì„ ì €í•˜ì‹œí‚µë‹ˆë‹¤.</p>

<ul>
  <li>ì¥ì 
    <ul>
      <li>í”„ë¡œë•ì…˜ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ìµœì†Œí™”</li>
      <li>ê° íŠ¸ëœì­ì…˜ì— ëŒ€í•´ ì¶”ê°€ ì¿¼ë¦¬ í•„ìš” ì—†ìŒ</li>
      <li>ì—¬ëŸ¬ ì‹œìŠ¤í…œì— ê±¸ì³ ACID ì‹ ë¢°ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>í”„ë¡œë•ì…˜ ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì˜ ìŠ¤í‚¤ë§ˆë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ê±°ë‚˜ í…Œì´ë¸”ì„ ì¶”ê°€í•  í•„ìš”ê°€ ì—†ìŒ</li>
    </ul>
  </li>
  <li>ì–´ë ¤ìš´ ì 
    <ul>
      <li>ë°ì´í„°ë² ì´ìŠ¤ì˜ ë‚´ë¶€ ë¡œê¹… í˜•ì‹ì„ êµ¬ë¬¸ ë¶„ì„í•˜ëŠ” ê²ƒì€ ë³µì¡í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ë² ì´ìŠ¤ëŠ” í˜•ì‹ì„ ë¬¸ì„œí™”í•˜ì§€ ì•Šìœ¼ë©° ìƒˆë¡œìš´ ë¦´ë¦¬ìŠ¤ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë³€ê²½ ì‚¬í•­ì„ ì•Œë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ ê²½ìš° ìƒˆ ë°ì´í„°ë² ì´ìŠ¤ ë¦´ë¦¬ìŠ¤ë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸ êµ¬ë¬¸ ë¶„ì„ ë…¼ë¦¬ë¥¼ ë³€ê²½í•´ì•¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
      <li>ì›ë³¸ ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ ì´ë²¤íŠ¸ ë©”íƒ€ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œì´ í•„ìš”í•©ë‹ˆë‹¤.</li>
      <li>ê²€ìƒ‰ ê°€ëŠ¥í•œ íŠ¸ëœì­ì…˜ ë¡œê·¸ë¥¼ ìƒì„±í•˜ëŠ” ë° í•„ìš”í•œ ì¶”ê°€ ë¡œê·¸ ë ˆë²¨ë¡œ ì¸í•´ í•œê³„ ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œê°€ ì¶”ê°€ë  ìˆ˜ ìˆìŒ</li>
    </ul>
  </li>
</ul>

<p>Every database supporting transactions first writes any changes (inserts, updates, and deletes) to a database log before writing it to the database. This is done to assure the integrity of transactions from unexpected occurrences like power failure etc., while the transaction is still inflight.</p>

<p>The database logs cycle between active log (redo log) and archive logs based on file size or time interval events. Depending on the target databaseâ€™s data latency requirements, the CDC tool can access the active log or archive logs for the source database.</p>

<p>Since the CDC tool only reads from the source database logs, it does not add to the source database load. Moreover, the changelog is typically many orders of magnitude smaller than the source table. Such a flow of such a changelog over the network does not cause any network load issues.</p>

<p>Since database logs only contain information about the most recent inserts, updates, and deletes, changelog calculation becomes a trivial undertaking. However, since there are many database vendors, each with its own (sometimes proprietary) log format, such tasks are best left to commercial CDC tool vendors.</p>

<h1 id="debezium">Debezium</h1>
<p>Another option for implementing a CDC solution is by using the native database logs that both MySQL and Postgres can produce when configured to do so. These database logs record every operation that is executed against the database which can then be used to replicate these changes in a target system.</p>

<p>The advantage of using database logs is that firstly, you donâ€™t need to write any code or add any extra logic to your tables as you do with update timestamps. Second, it also supports deletion of records, something that isnâ€™t possible with update timestamps.</p>

<p>In MySQL you do this by turning on the binlog and in Postgres, you configure the Write Ahead Log (WAL) for replication. Once the database is configured to write these logs you can choose a CDC system to help capture the changes. Two popular options are Debezium and Amazon Database Migration Service (DMS). Both of these systems utilise the binlog for MySQL and WAL for Postgres.</p>

<p>Debezium works natively with Kafka. It picks up the relevant changes, converts them into a JSON object that contains a payload describing what has changed and the schema of the table and puts it on a Kafka topic. This payload contains all the context required to apply these changes to our target system, we just need to write a consumer or use a Kafka Connect sink to write the data. As Debezium uses Kafka, we get all the benefits of Kafka such as fault tolerance and scalability.</p>

<p><img src="/images/cdc_6.png" alt="" /></p>

<p>AWS DMS works in a similar way to Debezium. It supports many different source and target systems and integrates natively with all of the popular AWS data services including Kinesis and Redshift.</p>

<p>The main benefit of using DMS over Debezium is that itâ€™s effectively a â€œserverlessâ€ offering. With Debezium, if you want the flexibility and fault tolerance of Kafka, you have the overhead of deploying a Kafka cluster. DMS as its name states is a service. You configure the source and target endpoints and AWS takes care of handling the infrastructure to deal with monitoring the database logs and copying the data to the target.</p>

<p>However, this serverless approach does have its drawbacks, mainly in its feature set.</p>

<p>When weighing up which pattern to follow itâ€™s important to assess your specific use case. Using update timestamps works when you only want to capture inserts and updates, if you already have a Kafka cluster you can get up and running with this very quickly, especially if most tables already include some kind of update timestamp.</p>

<p>If youâ€™d rather go with the database log approach, maybe because you want exact replication then you should look to use a service like Debezium or AWS DMS. I would suggest first checking which system supports the source and target systems you require. If you have some more advanced use cases such as masking sensitive data or re-routing data to different queues based on its content then Debezium is probably the best choice. If youâ€™re just looking for simple replication with little overhead then DMS will work for you if it supports your source and target system.</p>

<p>If you have real-time analytics needs, you may consider using a target database like Rockset as an analytics serving layer. Rockset integrates with MySQL and Postgres, using AWS DMS, to ingest CDC streams and index the data for sub-second analytics at scale. Rockset can also read CDC streams from NoSQL databases, such as MongoDB and Amazon DynamoDB.</p>

<p>The right answer depends on your specific use case and there are many more options than have been discussed here, these are just some of the more popular ways to implement a modern CDC system.</p>

<h1 id="ì°¸ê³ ">ì°¸ê³ </h1>

<ul>
  <li><a href="https://www.striim.com/blog/change-data-capture-cdc-what-it-is-and-how-it-works/" target="_blank">striim: Change Data Capture (CDC): What it is and How it Works</a></li>
  <li><a href="https://towardsdatascience.com/change-data-capture-cdc-for-data-ingestion-ca81ff5934d2" target="_blank">Farhan Siddiqui, Change Data Capture(CDC) for Data Lake Data Ingestion</a></li>
  <li><a href="https://rockset.com/blog/cdc-mysql-postgres/" target="_blank">How to Implement CDC for MySQL and Postgres</a></li>
  <li><a href="https://www.hvr-software.com/blog/change-data-capture/" target="_blank">/blog What are the Different Methods of Change Data Capture (CDC)?</a></li>
</ul>
:ET