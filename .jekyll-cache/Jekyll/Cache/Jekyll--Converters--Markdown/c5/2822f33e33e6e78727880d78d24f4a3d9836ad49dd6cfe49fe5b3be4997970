I"³ƒ<hr />
<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#intuition" id="markdown-toc-intuition">Intuition</a>    <ul>
      <li><a href="#how-should-we-test" id="markdown-toc-how-should-we-test">How should we test</a></li>
      <li><a href="#what-should-we-test" id="markdown-toc-what-should-we-test">What should we test</a></li>
    </ul>
  </li>
  <li><a href="#hierachy" id="markdown-toc-hierachy">Hierachy</a></li>
  <li><a href="#testing-code" id="markdown-toc-testing-code">Testing Code</a>    <ul>
      <li><a href="#initialization" id="markdown-toc-initialization">Initialization</a></li>
      <li><a href="#assertions" id="markdown-toc-assertions">Assertions</a></li>
      <li><a href="#execution" id="markdown-toc-execution">Execution</a></li>
      <li><a href="#classes" id="markdown-toc-classes">Classes</a></li>
      <li><a href="#parametrize" id="markdown-toc-parametrize">Parametrize</a></li>
      <li><a href="#fixture" id="markdown-toc-fixture">Fixture</a></li>
      <li><a href="#markers" id="markdown-toc-markers">Markers</a></li>
    </ul>
  </li>
  <li><a href="#data" id="markdown-toc-data">Data</a>    <ul>
      <li><a href="#projects" id="markdown-toc-projects">Projects</a></li>
    </ul>
  </li>
  <li><a href="#ì°¸ê³ " id="markdown-toc-ì°¸ê³ ">ì°¸ê³ </a></li>
</ul>

<hr />

<ul>
  <li>Learn how to test ML artifacts (code, data and models) to ensure a reliable ML system.</li>
</ul>

<h1 id="intuition">Intuition</h1>

<ul>
  <li>In this lesson, weâ€™ll learn how to test code, data and machine learning models to construct a machine learning system that we can reliably iterate on. Tests are a way for us to ensure that something works as intended.</li>
  <li>Weâ€™re incentivized to implement tests and discover sources of error as early in the development cycle as possible so that we can decrease downstream costs and wasted time.</li>
  <li>Once weâ€™ve designed our tests, we can automatically execute them every time we change or add to our codebase.</li>
</ul>

<h2 id="how-should-we-test">How should we test</h2>

<p>The framework to use when composing tests is the Arrange Act Assert methodology.</p>

<ul>
  <li><strong>Arrange</strong>: set up the different inputs to test on.</li>
  <li><strong>Act</strong>: apply the inputs on the component we want to test.</li>
  <li><strong>Assert</strong>: confirm that we received the expected output.</li>
</ul>

<p>In Python, there are many tools, such as <code class="language-plaintext highlighter-rouge">unittest</code>, <code class="language-plaintext highlighter-rouge">pytest</code>, etc. that allow us to easily implement our tests while adhering to the Arrange Act Assert framework. These tools come with powerful built-in functionality such as parametrization, filters, and more, to test many conditions at scale.</p>

<h2 id="what-should-we-test">What should we test</h2>

<p>When arranging our inputs and asserting our expected outputs, what are some aspects of our inputs and outputs that we should be testing for?</p>

<ul>
  <li>inputs: data types, format, length, edge cases (min/max, small/large, etc.)</li>
  <li>outputs: data types, formats, exceptions, intermediary and final outputs</li>
</ul>

<h1 id="hierachy">Hierachy</h1>

<ul>
  <li>tests ë””ë ‰í„°ë¦¬ì— ì €ì¥</li>
  <li><code class="language-plaintext highlighter-rouge">test_</code> ì ‘ë‘ì‚¬</li>
  <li>ì½”ë“œ í•˜ë‚˜ë‹¹ í…ŒìŠ¤íŠ¸ ì½”ë“œ í•˜ë‚˜ì¸ ê²½ìš°ë„ ìˆê³ , ì½”ë“œ í•˜ë‚˜ì— ì—¬ëŸ¬ ê¸°ëŠ¥ì„ ë‚´í¬í•œ ê²½ìš° í•¨ìˆ˜ í•˜ë‚˜ë‹¹ í…ŒìŠ¤íŠ¸ ì½”ë“œ í•˜ë‚˜ì¸ ê²½ìš°ë„ ìˆë‹¤</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root
â”œâ”€â”€ code
â”‚   â””â”€â”€ train.py
â””â”€â”€ tests
    â”œâ”€â”€ code
    â”‚   â””â”€â”€ test_train.py
    â”œâ”€â”€ data
    â””â”€â”€ model
</code></pre></div></div>

<h1 id="testing-code">Testing Code</h1>

<ul>
  <li>Weâ€™ll start by testing our code and weâ€™ll use pytest as our testing framework for itâ€™s powerful builtin features such as parametrization, fixtures, markers and more.</li>
</ul>

<h2 id="initialization">Initialization</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install pytest
</code></pre></div></div>

<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># pyproject.toml
</span>
<span class="nn">[tool.pytest.ini_options]</span>
<span class="py">testpaths</span> <span class="p">=</span> <span class="s">["tests"]</span>
<span class="py">python_files</span> <span class="p">=</span> <span class="s">"test_*.py"</span>
</code></pre></div></div>

<h2 id="assertions">Assertions</h2>

<ul>
  <li>Letâ€™s see what a sample test and itâ€™s results look like. Assume we have a simple function that determines whether a fruit is crisp or not:</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># food/fruits.py
</span><span class="k">def</span> <span class="nf">is_crisp</span><span class="p">(</span><span class="n">fruit</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">fruit</span><span class="p">:</span>
        <span class="n">fruit</span> <span class="o">=</span> <span class="n">fruit</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">fruit</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"apple"</span><span class="p">,</span> <span class="s">"watermelon"</span><span class="p">,</span> <span class="s">"cherries"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">elif</span> <span class="n">fruit</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"orange"</span><span class="p">,</span> <span class="s">"mango"</span><span class="p">,</span> <span class="s">"strawberry"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">fruit</span><span class="si">}</span><span class="s"> not in known list of fruits."</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># tests/food/test_fruits.py
</span><span class="k">def</span> <span class="nf">test_is_crisp</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">is_crisp</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="s">"apple"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">is_crisp</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="s">"Apple"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_crisp</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="s">"orange"</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="p">.</span><span class="n">raises</span><span class="p">(</span><span class="nb">ValueError</span><span class="p">):</span>
        <span class="n">is_crisp</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">is_crisp</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="s">"pear"</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="execution">Execution</h2>

<p>We can execute our tests above using several different levels of granularity:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> pytest                                           <span class="c"># all tests</span>
python3 <span class="nt">-m</span> pytest tests/food                                <span class="c"># tests under a directory</span>
python3 <span class="nt">-m</span> pytest tests/food/test_fruits.py                 <span class="c"># tests for a single file</span>
python3 <span class="nt">-m</span> pytest tests/food/test_fruits.py::test_is_crisp  <span class="c"># tests for a single function</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># í…ŒìŠ¤íŠ¸ ì„±ê³µí–ˆì„ ë•Œ ì¶œë ¥</span>
tests/food/test_fruits.py::test_is_crisp <span class="nb">.</span>           <span class="o">[</span>100%]

<span class="c"># í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨í–ˆì„ ë•Œ ì¶œë ¥</span>
tests/food/test_fruits.py F                          <span class="o">[</span>100%]

    def test_is_crisp<span class="o">()</span>:
<span class="o">&gt;</span>       assert is_crisp<span class="o">(</span><span class="nv">fruit</span><span class="o">=</span><span class="s2">"orange"</span><span class="o">)</span>
E       AssertionError: assert False
E        +  where False <span class="o">=</span> is_crisp<span class="o">(</span><span class="nv">fruit</span><span class="o">=</span><span class="s1">'orange'</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="classes">Classes</h2>

<p>We can also test classes and their respective functions by creating test classes. Within our test class, we can optionally define functions which will automatically be executed when we setup or teardown a class instance or use a class method.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">setup_class</code>: set up the state for any class instance.</li>
  <li><code class="language-plaintext highlighter-rouge">teardown_class</code>: teardown the state created in setup_class.</li>
  <li><code class="language-plaintext highlighter-rouge">setup_method</code>: called before every method to setup any state.</li>
  <li><code class="language-plaintext highlighter-rouge">teardown_method</code>: called after every method to teardown any state.</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Fruit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<span class="k">class</span> <span class="nc">TestFruit</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">setup_class</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="s">"""Set up the state for any class instance."""</span>
        <span class="k">pass</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">teardown_class</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="s">"""Teardown the state created in setup_class."""</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Called before every method to setup any state."""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">fruit</span> <span class="o">=</span> <span class="n">Fruit</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"apple"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">teardown_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Called after every method to teardown any state."""</span>
        <span class="k">del</span> <span class="bp">self</span><span class="p">.</span><span class="n">fruit</span>

    <span class="k">def</span> <span class="nf">test_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="p">.</span><span class="n">fruit</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"apple"</span>

</code></pre></div></div>

<ul>
  <li>We can execute all the tests for our class by specifying the class name:</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> pytest tests/food/test_fruits.py::TestFruit
</code></pre></div></div>

<h2 id="parametrize">Parametrize</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">assert</code>ë¬¸ì´ ê³„ì† ë°˜ë³µë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•´ì¤€ë‹¤</li>
  <li><code class="language-plaintext highlighter-rouge">@pytest.mark.parametrize</code> ë°ì½”ë ˆì´í„°ë¥¼ ì´ìš©í•œë‹¤</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">mark</span><span class="p">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s">"fruit, crisp"</span><span class="p">,[(</span><span class="s">"apple"</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="p">(</span><span class="s">"Apple"</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span> <span class="p">(</span><span class="s">"orange"</span><span class="p">,</span> <span class="bp">False</span><span class="p">),],)</span>
<span class="k">def</span> <span class="nf">test_is_crisp_parametrize</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="n">crisp</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">is_crisp</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="n">fruit</span><span class="p">)</span> <span class="o">==</span> <span class="n">crisp</span>

</code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">mark</span><span class="p">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s">"fruit, exception"</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="s">"pear"</span><span class="p">,</span> <span class="nb">ValueError</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_is_crisp_exceptions</span><span class="p">(</span><span class="n">fruit</span><span class="p">,</span> <span class="n">exception</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="p">.</span><span class="n">raises</span><span class="p">(</span><span class="n">exception</span><span class="p">):</span>
        <span class="n">is_crisp</span><span class="p">(</span><span class="n">fruit</span><span class="o">=</span><span class="n">fruit</span><span class="p">)</span>

</code></pre></div></div>

<h2 id="fixture">Fixture</h2>

<ul>
  <li>ParametrizeëŠ” í•¨ìˆ˜ë‚´ì—ì„œ <code class="language-plaintext highlighter-rouge">assert</code>ë¬¸ì„ ì—†ì• ì¤¬ë‹¤</li>
  <li>FixtureëŠ” ì—¬ëŸ¬ í•¨ìˆ˜ì—ì„œ ì ìš©ë˜ëŠ” ë°˜ë³µ ìš”ì†Œë¥¼ ì¤„ì—¬ì¤€ë‹¤</li>
  <li><code class="language-plaintext highlighter-rouge">@pytest.fixture</code> ë°ì½”ë ˆì´í„°ë¥¼ ì´ìš©í•œë‹¤</li>
  <li>í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ì—ëŠ” Fixtureì˜ ì´ë¦„ì„ ì“°ë©´ ëœë‹¤ (ex. <code class="language-plaintext highlighter-rouge">my_fruit</code>)</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">fixture</span>
<span class="k">def</span> <span class="nf">my_fruit</span><span class="p">():</span>
    <span class="c1"># ì—¬ê¸°ì„œë§Œ í•œ ë²ˆ Fruit ê°ì²´ë¥¼ ìƒì„±í•˜ë©´ ëœë‹¤ (ë§¤ë²ˆ ìƒì„±í•  í•„ìš” ì—†ë‹¤)
</span>    <span class="n">fruit</span> <span class="o">=</span> <span class="n">Fruit</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"apple"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fruit</span>

<span class="k">def</span> <span class="nf">test_fruit</span><span class="p">(</span><span class="n">my_fruit</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">my_fruit</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"apple"</span>

<span class="c1"># ì´ë ‡ê²Œ í•˜ë©´ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì˜ ì–´ë–¤ ë©”ì†Œë“œì—ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
</span><span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">mark</span><span class="p">.</span><span class="n">usefixtures</span><span class="p">(</span><span class="s">"my_fruit"</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestFruit</span><span class="p">:</span>
    <span class="p">...</span>

</code></pre></div></div>

<ul>
  <li>
    <p>Fixtures can have different scopes depending on how we want to use them.</p>
  </li>
  <li><code class="language-plaintext highlighter-rouge">function</code>: fixture is destroyed after every test. [default]</li>
  <li><code class="language-plaintext highlighter-rouge">class</code>: fixture is destroyed after the last test in the class.</li>
  <li><code class="language-plaintext highlighter-rouge">module</code>: fixture is destroyed after the last test in the module (script).</li>
  <li><code class="language-plaintext highlighter-rouge">package</code>: fixture is destroyed after the last test in the package.</li>
  <li><code class="language-plaintext highlighter-rouge">session</code>: fixture is destroyed after the last test of the session.</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s">"module"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">df</span><span class="p">():</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s">"title"</span><span class="p">:</span> <span class="s">"a0"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"b0"</span><span class="p">,</span> <span class="s">"tag"</span><span class="p">:</span> <span class="s">"c0"</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"title"</span><span class="p">:</span> <span class="s">"a1"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"b1"</span><span class="p">,</span> <span class="s">"tag"</span><span class="p">:</span> <span class="s">"c1"</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"title"</span><span class="p">:</span> <span class="s">"a2"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"b2"</span><span class="p">,</span> <span class="s">"tag"</span><span class="p">:</span> <span class="s">"c1"</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"title"</span><span class="p">:</span> <span class="s">"a3"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"b3"</span><span class="p">,</span> <span class="s">"tag"</span><span class="p">:</span> <span class="s">"c2"</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"title"</span><span class="p">:</span> <span class="s">"a4"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"b4"</span><span class="p">,</span> <span class="s">"tag"</span><span class="p">:</span> <span class="s">"c2"</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"title"</span><span class="p">:</span> <span class="s">"a5"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"b5"</span><span class="p">,</span> <span class="s">"tag"</span><span class="p">:</span> <span class="s">"c2"</span><span class="p">},</span>
    <span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></div>

<h2 id="markers">Markers</h2>

<ul>
  <li>we can create custom granularity by using markers.</li>
  <li>Parametrizeë„ Markerì¤‘ í•˜ë‚˜ (<code class="language-plaintext highlighter-rouge">@pytest.mark.parametrize</code>)</li>
  <li>there are several other builtin markers as well. For example, the <code class="language-plaintext highlighter-rouge">skipif</code> marker allows us to skip execution of a test if a condition is met</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># GPU ì‚¬ìš©ì´ ë¶ˆê°€í•˜ë©´ trainingì„ testí•˜ëŠ” ì½”ë“œë¥¼ ê±´ë„ˆëˆë‹¤
</span><span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">mark</span><span class="p">.</span><span class="n">skipif</span><span class="p">(</span><span class="ow">not</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="n">is_available</span><span class="p">(),</span> <span class="n">reason</span><span class="o">=</span><span class="s">"Full training tests require a GPU."</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_training</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># í•„í„°ë§ í•  ìˆ˜ ìˆë‹¤
</span><span class="o">@</span><span class="n">pytest</span><span class="p">.</span><span class="n">mark</span><span class="p">.</span><span class="n">fruits</span>
<span class="k">def</span> <span class="nf">test_fruit</span><span class="p">(</span><span class="n">my_fruit</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">my_fruit</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">"apple"</span>

</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pytest <span class="nt">-m</span> <span class="s2">"fruits"</span>      <span class="c">#  runs all tests marked with `fruits`</span>
pytest <span class="nt">-m</span> <span class="s2">"not fruits"</span>  <span class="c">#  runs all tests besides those marked with `fruits`</span>
</code></pre></div></div>

<h1 id="data">Data</h1>

<p>So far, weâ€™ve used unit and integration tests to test the functions that interact with our data but we havenâ€™t tested the validity of the data itself. Weâ€™re going to use the <code class="language-plaintext highlighter-rouge">great expectations</code> library to test what our data is expected to look like. Itâ€™s a library that allows us to create expectations as to what our data should look like in a standardized way. It also provides modules to seamlessly connect with backend data sources such as local file systems, S3, databases, etc. Letâ€™s explore the library by implementing the expectations weâ€™ll need for our application.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>great-expectations
</code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">great_expectations</span> <span class="k">as</span> <span class="n">ge</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>

<span class="c1"># Load labeled projects
</span><span class="n">projects</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"https://raw.githubusercontent.com/GokuMohandas/Made-With-ML/main/datasets/projects.csv"</span><span class="p">)</span>
<span class="n">tags</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"https://raw.githubusercontent.com/GokuMohandas/Made-With-ML/main/datasets/tags.csv"</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">ge</span><span class="p">.</span><span class="n">dataset</span><span class="p">.</span><span class="n">PandasDataset</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">projects</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">"id"</span><span class="p">))</span>
<span class="k">print</span> <span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s"> projects"</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

</code></pre></div></div>

<ul>
  <li>When it comes to organizing expectations, itâ€™s recommended to start with table-level ones and then move on to individual feature columns.</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Presence of specific features
</span><span class="n">df</span><span class="p">.</span><span class="n">expect_table_columns_to_match_ordered_list</span><span class="p">(</span>
    <span class="n">column_list</span><span class="o">=</span><span class="p">[</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"created_on"</span><span class="p">,</span> <span class="s">"title"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">,</span> <span class="s">"tag"</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Unique combinations of features (detect data leaks!)
</span><span class="n">df</span><span class="p">.</span><span class="n">expect_compound_columns_to_be_unique</span><span class="p">(</span><span class="n">column_list</span><span class="o">=</span><span class="p">[</span><span class="s">"title"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">])</span>

<span class="c1"># Missing values
</span><span class="n">df</span><span class="p">.</span><span class="n">expect_column_values_to_not_be_null</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s">"tag"</span><span class="p">)</span>

<span class="c1"># Unique values
</span><span class="n">df</span><span class="p">.</span><span class="n">expect_column_values_to_be_unique</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s">"id"</span><span class="p">)</span>

<span class="c1"># Type adherence
</span><span class="n">df</span><span class="p">.</span><span class="n">expect_column_values_to_be_of_type</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s">"title"</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s">"str"</span><span class="p">)</span>

<span class="c1"># List (categorical) / range (continuous) of allowed values
</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s">"computer-vision"</span><span class="p">,</span> <span class="s">"graph-learning"</span><span class="p">,</span> <span class="s">"reinforcement-learning"</span><span class="p">,</span>
        <span class="s">"natural-language-processing"</span><span class="p">,</span> <span class="s">"mlops"</span><span class="p">,</span> <span class="s">"time-series"</span><span class="p">]</span>
<span class="n">df</span><span class="p">.</span><span class="n">expect_column_values_to_be_in_set</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s">"tag"</span><span class="p">,</span> <span class="n">value_set</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>

</code></pre></div></div>

<ul>
  <li>We can group all the expectations together to create an Expectation Suite object which we can use to validate any Dataset module.</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Expectation suite
</span><span class="n">expectation_suite</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">get_expectation_suite</span><span class="p">(</span><span class="n">discard_failed_expectations</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">expectation_suite</span><span class="o">=</span><span class="n">expectation_suite</span><span class="p">,</span> <span class="n">only_return_failures</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="projects">Projects</h2>

<ul>
  <li>So far weâ€™ve worked with the Great Expectations library at the adhoc script / notebook level but we can further organize our expectations by creating a Project.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>tests
great_expectations init

<span class="nt">---------------------------------</span>
tests/great_expectations/
â”œâ”€â”€ checkpoints/
â”œâ”€â”€ expectations/
â”œâ”€â”€ plugins/
â”œâ”€â”€ uncommitted/
â”œâ”€â”€ .gitignore
â””â”€â”€ great_expectations.yml
</code></pre></div></div>

<ul>
  <li>The first step is to establish our datasource which tells Great Expectations where our data lives:</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>great_expectations datasource new
</code></pre></div></div>

<ul>
  <li>Create expectations manually, interactively or automatically and save them as suites (a set of expectations for a particular data asset).</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>great_expectations suite new
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>How would you like to create your Expectation Suite?
    1. Manually, without interacting with a sample batch of data (default)
    2. Interactively, with a sample batch of data ğŸ‘ˆ
    3. Automatically, using a profiler
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Which data asset (accessible by data connector "default_inferred_data_connector_name") would you like to use?
    1. labeled_projects.csv
    2. projects.csv ğŸ‘ˆ
    3. tags.csv
------------------------------------------------------------------------------------------------------------
Name the new Expectation Suite [projects.csv.warning]: projects

</code></pre></div></div>

<h1 id="ì°¸ê³ ">ì°¸ê³ </h1>

<ul>
  <li><a href="https://madewithml.com/courses/mlops/testing/" target="_blank">Made With ML, Testing Machine Learning Systems: Code, Data and Models View all lessons</a></li>
</ul>
:ET