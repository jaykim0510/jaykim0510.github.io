I"ğ}<hr />

<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#intuition" id="markdown-toc-intuition">Intuition</a></li>
  <li><a href="#mlflow" id="markdown-toc-mlflow">MLflow</a></li>
  <li><a href="#mlflow-ì‹¤ìŠµ" id="markdown-toc-mlflow-ì‹¤ìŠµ">MLflow ì‹¤ìŠµ</a>    <ul>
      <li><a href="#initialization" id="markdown-toc-initialization">Initialization</a></li>
      <li><a href="#mlflow-tracking" id="markdown-toc-mlflow-tracking">MLflow Tracking</a>        <ul>
          <li><a href="#experimentì™€-run" id="markdown-toc-experimentì™€-run">Experimentì™€ Run</a></li>
          <li><a href="#log" id="markdown-toc-log">Log</a></li>
          <li><a href="#ì˜ˆì œ-ì½”ë“œ" id="markdown-toc-ì˜ˆì œ-ì½”ë“œ">ì˜ˆì œ ì½”ë“œ</a></li>
          <li><a href="#ì‹¤ì œë¡œ-ì ìš©í•œ-ì½”ë“œ" id="markdown-toc-ì‹¤ì œë¡œ-ì ìš©í•œ-ì½”ë“œ">ì‹¤ì œë¡œ ì ìš©í•œ ì½”ë“œ</a></li>
        </ul>
      </li>
      <li><a href="#mlflow-project" id="markdown-toc-mlflow-project">MLflow Project</a></li>
      <li><a href="#model-loading" id="markdown-toc-model-loading">Model loading</a></li>
    </ul>
  </li>
  <li><a href="#ì°¸ê³ " id="markdown-toc-ì°¸ê³ ">ì°¸ê³ </a></li>
</ul>

<hr />

<p style="text-align: center;"><span style="margin-right: 10px;"><a href="https://naver.com"><img src="https://img.shields.io/static/v1?label=&amp;message=View%20On%20GitHub&amp;color=586069&amp;logo=github&amp;labelColor=2f363d" /></a></span> <span><a href="https://naver.com"><img src="https://colab.research.google.com/assets/colab-badge.svg" /></a></span></p>

<h1 id="intuition">Intuition</h1>

<ul>
  <li>ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì„ ê°œë°œí•  ë•ŒëŠ” ì¼ë ¨ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ìˆë‹¤.</li>
  <li>ë°ì´í„° ë¡œë“œ - ëª¨ë¸ ì„ íƒ - ëª¨ë¸ í•™ìŠµ - ëª¨ë¸ í‰ê°€ - ëª¨ë¸ ì„œë¹™</li>
  <li>ì–´ë–¤ ë°ì´í„°, ì–´ë–¤ ëª¨ë¸, ì–´ë–»ê²Œ í•™ìŠµ, ì–´ë–»ê²Œ í‰ê°€í•˜ëŠ”ì§€ì— ë”°ë¼ ì„œë¹™ ë‹¨ê³„ì—ì„œì˜ ëª¨ë¸ ì„±ëŠ¥ì€ ë‹¬ë¼ì§€ê²Œ ëœë‹¤</li>
  <li>ê·¸ë˜ì„œ ìœ„ì˜ ëª¨ë“  ìš”ì†Œë“¤ì„ ì¡°í•©í•´ ê°€ì¥ ë†’ì€ ì„±ëŠ¥ì„ ê°–ëŠ” ëª¨ë¸ì„ ì„œë¹™í•˜ëŠ” ê²ƒì´ ë¨¸ì‹ ëŸ¬ë‹ íŒ€ì˜ ëª©í‘œì´ë‹¤</li>
</ul>

<h1 id="mlflow">MLflow</h1>

<p>ìœ„ì™€ ê°™ì€ ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ ê°œë°œì˜ ì „ì²´ ì‚¬ì´í´ì„ ì›í™œí•˜ê²Œ í•˜ê¸° ìœ„í•´ MLflowëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš”ì†Œë“¤ì„ ì§€ì›í•œë‹¤.</p>

<p><img src="/images/mlflow_1.png" alt="" /></p>

<ul>
  <li>Tracking: <strong>ì‹¤í—˜ ê³¼ì •ë“¤ì„ ê¸°ë¡</strong></li>
  <li>Projects: <strong>ì–´ë–¤ í™˜ê²½ì—ì„œë“ , ëˆ„êµ¬ë“  ë˜‘ê°™ì€ ì‹¤í—˜ì„ ë‹¤ì‹œ í•  ìˆ˜ ìˆë„ë¡ ì „ì²´ ì½”ë“œë¥¼ íŒ¨í‚¤ì§•</strong></li>
  <li>Models: ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ <strong>ëª¨ë¸ì„ ë°°í¬</strong></li>
  <li>Registry: íŒ€ì›ë“¤ì´ í¸í•˜ê²Œ <strong>ëª¨ë¸ì„ ê³µìœ í•  ìˆ˜ ìˆëŠ” ì €ì¥ì†Œ</strong></li>
</ul>

<div class="pen-para">
    <div class="pen-bar">
      <i class="fas fa-pen"></i>Note
    </div>
    <div class="pen-content">
      ëª¨ë‘ í›Œë¥­í•œ ê¸°ëŠ¥ì´ì§€ë§Œ, MLflowëŠ” Artifactë¥¼ ê³µìœ í•˜ëŠ” Registry ìš©ë„ë¡œ ê°€ì¥ ë§ì´ ì‚¬ìš©ëœë‹¤. Trackingì€ wandbë¡œ ë§ì´ ëŒ€ì²´ë˜ëŠ” í¸ì´ë‹¤.
    </div>
</div>

<p>MLflow enables Data Scientists to easily track the progress during the model development and tuning. It takes care of the packaging and deployment of models, no matter which framework or programming language was used to create it. In addition, MLflow provides a registry, where the models we want to keep or share can be safely stored and readily accessible</p>

<p>We can run MLflow on our own servers and databases so there are no storage cost / limitations, making it one of the most popular options and is used by Microsoft, Facebook, Databricks and others. You can also set up your own Tracking servers to synchronize runs amongst multiple team members collaborating on the same task.</p>

<div class="pen-para">
    <div class="pen-bar">
      <i class="fas fa-pen"></i>Other tools
    </div>
    <div class="pen-content">
      <li>Weights and Biases: Trackingì— íŠ¹í™”ëœ íˆ´</li>
      <li>BentoML: Servingì— íŠ¹í™”ëœ íˆ´</li>
    </div>
</div>

<h1 id="mlflow-ì‹¤ìŠµ">MLflow ì‹¤ìŠµ</h1>

<h2 id="initialization">Initialization</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install mlflow
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir mlflow_project
</code></pre></div></div>

<h2 id="mlflow-tracking">MLflow Tracking</h2>

<ul>
  <li>
    <p>MLflow offers tools for tracking metrics, artifacts, and metadata.</p>
  </li>
  <li>
    <p>MLflow Tracking is an API-based tool for logging metrics, parameters, model versions, code versions, and files. MLflow Tracking is integrated with a UI for visualizing and managing artifacts, models, files, etc.</p>
  </li>
  <li>
    <p>MLflow Tracking allows you to generate runs through MLflowâ€™s Python, R, Java, and REST APIs. By default, the runs are stored in the directory where the code session is executed. However, MLflow also allows storing artifacts on a local or remote server.</p>
  </li>
</ul>

<h3 id="experimentì™€-run">Experimentì™€ Run</h3>

<ul>
  <li>
    <p>í•˜ë‚˜ì˜ experimentëŠ” ì—¬ëŸ¬ê°œì˜ runì„ ê°€ì§ˆìˆ˜ ìˆë‹¤</p>
  </li>
  <li>experiment: ê¸°ëŠ¥ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ (ë˜ëŠ” ëª¨ë¸)
    <ul>
      <li><code class="language-plaintext highlighter-rouge">mlflow.create_experiment()</code>: ìƒˆë¡œìš´ experiment ìƒì„±</li>
      <li><code class="language-plaintext highlighter-rouge">mlflow.set_experiment()</code>: ì´ë¯¸ ì¡´ì¬í•˜ëŠ” experimentë¥¼ activeë¡œ ì„¤ì •</li>
      <li><code class="language-plaintext highlighter-rouge">mlflow.get_experiment_by_name(exp_name)</code>: exp_name ì´ë¼ëŠ” ì´ë¦„ì˜ experimentê°€ ìˆëŠ” ì§€ ê²€ìƒ‰í•´ì„œ ìˆìœ¼ë©´ ë¦¬í„´</li>
    </ul>
  </li>
  <li>run: í•˜ì´í¼ íŒŒë¼ë¯¸í„° ë‹¨ìœ„ë¡œ ë¶„ë¦¬
    <ul>
      <li><code class="language-plaintext highlighter-rouge">mlflow.start_run(run_name=name)</code>: nameë¼ëŠ” runì„ ìƒì„±í•´ í•™ìŠµ ë©”íŠ¸ë¦­, íŒŒë¼ë¯¸í„° ë“± ê´€ë ¨ ì¸ìë¥¼ ê´€ë¦¬</li>
      <li><code class="language-plaintext highlighter-rouge">mlflow.end_run()</code>:  í˜„ì¬ ì‹¤í–‰ë˜ê³ ìˆëŠ” runì„ ì¢…ë£Œ</li>
    </ul>
  </li>
</ul>

<h3 id="log">Log</h3>

<ul>
  <li>MLflowì—ì„œëŠ” ìë™ ë¡œê¹…ì„ ê¶Œì¥í•œë‹¤</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># íŒŒë¼ë¯¸í„°, ì•„í‹°íŒ©íŠ¸ë¥¼ ìë™ìœ¼ë¡œ ë¡œê¹…í•´ì¤€ë‹¤
</span><span class="n">mlflow</span><span class="p">.</span><span class="n">sklearn</span><span class="p">.</span><span class="n">autolog</span><span class="p">()</span>

<span class="c1"># íŒŒë¼ë¯¸í„° ì•„í‹°íŒ©íŠ¸, ë©”íŠ¸ë¦­, íƒœê·¸ê¹Œì§€ ìë™ìœ¼ë¡œ ë¡œê¹…í•´ì¤€ë‹¤
</span><span class="n">mlflow</span><span class="p">.</span><span class="n">autolog</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>ìê¸°ê°€ ì»¤ìŠ¤í…€ í•˜ê³  ì‹¶ì€ ë¡œê¹…ì— ëŒ€í•´ì„œë§Œ ì¶”ê°€ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">log_param</code>, <code class="language-plaintext highlighter-rouge">log_metricì„</code> ì“°ë„ë¡ í•œë‹¤</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># íŒŒë¼ë¯¸í„° ë¡œê¹…
</span><span class="n">mlflow</span><span class="p">.</span><span class="n">log_param</span><span class="p">(</span><span class="s">"alpha"</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="n">mlflow</span><span class="p">.</span><span class="n">log_param</span><span class="p">(</span><span class="s">"l1_ratio"</span><span class="p">,</span> <span class="n">l1_ratio</span><span class="p">)</span>

<span class="c1"># ë©”íŠ¸ë¦­ ë¡œê¹…
</span><span class="n">mlflow</span><span class="p">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s">"rmse"</span><span class="p">,</span> <span class="n">rmse</span><span class="p">)</span>
<span class="n">mlflow</span><span class="p">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s">"r2"</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì˜ˆì œ-ì½”ë“œ">ì˜ˆì œ ì½”ë“œ</h3>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">ElasticNet</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>


<span class="c1"># ë­”ê°€ ì»¤ìŠ¤í…€ í•˜ê³  ì‹¶ì€ ë©”íŠ¸ë¦­ ìˆì„ ë•Œë§Œ ì´ë ‡ê²Œ ì •ì˜ í•˜ë©´ ëœë‹¤. ì—†ìœ¼ë©´ autolog()
</span><span class="k">def</span> <span class="nf">eval_metrics</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">pred</span><span class="p">))</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">r2</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"http://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">";"</span><span class="p">)</span>
    
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="n">train_x</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"quality"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">test_x</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"quality"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="s">"quality"</span><span class="p">]]</span>
    <span class="n">test_y</span> <span class="o">=</span> <span class="n">test</span><span class="p">[[</span><span class="s">"quality"</span><span class="p">]]</span>

    <span class="n">lr</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="p">.</span><span class="n">autolog</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">mlflow</span><span class="p">.</span><span class="n">start_run</span><span class="p">()</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
        
        <span class="n">lr</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
        <span class="n">predict</span> <span class="o">=</span> <span class="n">lr</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>MLflowë¥¼ ë³¸ê²©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ì „ì— ì§šê³  ë„˜ì–´ê°ˆ ì¤‘ìš”í•œ ì„¤ì •ì´ ìˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">mlflow.set_tracking_uri()</code></li>
  <li>ë©”íŠ¸ë¦­, íŒŒë¼ë¯¸í„°, ì•„í‹°íŒ©íŠ¸ì™€ ê°™ì€ ë¡œê·¸ ì •ë³´ë¥¼ ì–´ë””ì— ì €ì¥í• ì§€ì— ê´€í•œ ì„¤ì •ì´ë‹¤</li>
</ul>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì•„ë¬´ ì„¤ì •ë„ í•˜ì§€ ì•ŠëŠ” ê²½ìš°
# mlruns/experiment id/run id/ í´ë”ì— artifacts, params, metrics ë“±ì´ ì €ì¥ëœë‹¤
</span>
<span class="c1"># íŠ¹ì • í´ë”(ex. tracking)ë¥¼ ì§€ì •í•˜ëŠ” ê²½ìš°
# tracking/experiment id/run id/ í´ë”ì— artifacts, params, metrics ë“±ì´ ì €ì¥ëœë‹¤
</span><span class="n">mlflow</span><span class="p">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">os</span><span class="p">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s">/tracking"</span><span class="p">)</span>

<span class="c1"># DBë¥¼ ì§€ì •í•˜ëŠ” ê²½ìš°
# (ë¨¼ì € ë¹ˆ DB ìƒì„±: sqlite3 db.sqlite3 "VACUUM;")
# artifactëŠ” mlrunsì— ì €ì¥, ë‚˜ë¨¸ì§€ params, metrics ë“±ì€ DBì— ì €ì¥
</span><span class="n">mlflow</span><span class="p">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s">"sqlite:///db.sqlite3"</span><span class="p">)</span>

<span class="c1"># localhost:8000 (ì›¹ì„œë²„)ë¡œ ì§€ì •í•˜ëŠ” ê²½ìš°
# ì›¹ì„œë²„ë¥¼ ë„ìš¸ ë•Œ ì„¤ì •í•œëŒ€ë¡œ ì €ì¥ëœë‹¤
# artifactëŠ” AWS S3ì— ì €ì¥, params, metricsëŠ” DBì— ì €ì¥
</span><span class="n">mlflow</span><span class="p">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s">"localhost:8000"</span><span class="p">)</span>
<span class="n">mlflow</span> <span class="n">server</span> <span class="o">-</span><span class="n">h</span> <span class="mf">0.0</span><span class="p">.</span><span class="mf">0.0</span> <span class="o">-</span><span class="n">p</span> <span class="mi">8000</span> <span class="o">--</span><span class="n">backend</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">uri</span> <span class="n">sqlite</span><span class="p">:</span><span class="o">///</span><span class="n">db</span><span class="p">.</span><span class="n">sqlite3</span> <span class="o">--</span><span class="n">default</span><span class="o">-</span><span class="n">artifact</span><span class="o">-</span><span class="n">root</span> <span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">jay</span><span class="o">-</span><span class="n">ml</span><span class="o">-</span><span class="n">models</span>
</code></pre></div></div>

<h3 id="ì‹¤ì œë¡œ-ì ìš©í•œ-ì½”ë“œ">ì‹¤ì œë¡œ ì ìš©í•œ ì½”ë“œ</h3>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">ElasticNet</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>


<span class="n">MODEL_NAME</span> <span class="o">=</span> <span class="s">"ElasticNet"</span>
<span class="n">EXPERIMENT_NAME</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"recommand/</span><span class="si">{</span><span class="n">MODEL_NAME</span><span class="si">}</span><span class="s">"</span>

<span class="n">RUN_ARGUMENTS</span> <span class="o">=</span> <span class="p">{</span><span class="s">"tags"</span><span class="p">:</span> <span class="p">{</span><span class="s">"model"</span><span class="p">:</span> <span class="s">"ElasticNet"</span><span class="p">},</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"this is second test"</span><span class="p">}</span>

<span class="n">TRACKING_PATH</span> <span class="o">=</span> <span class="s">"http://localhost:8000"</span>

<span class="n">mlflow</span><span class="p">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="n">TRACKING_PATH</span><span class="p">)</span>

<span class="n">mlflow</span><span class="p">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="n">EXPERIMENT_NAME</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"http://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">";"</span><span class="p">)</span>
    
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="n">train_x</span> <span class="o">=</span> <span class="n">train</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"quality"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">test_x</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"quality"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">train_y</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="s">"quality"</span><span class="p">]]</span>
    <span class="n">test_y</span> <span class="o">=</span> <span class="n">test</span><span class="p">[[</span><span class="s">"quality"</span><span class="p">]]</span>

    <span class="n">lr</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

    <span class="n">mlflow</span><span class="p">.</span><span class="n">autolog</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">mlflow</span><span class="p">.</span><span class="n">start_run</span><span class="p">(</span><span class="o">**</span><span class="n">RUN_ARGUMENTS</span><span class="p">)</span> <span class="k">as</span> <span class="n">run</span><span class="p">:</span>
        
        <span class="n">lr</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
        <span class="n">predict</span> <span class="o">=</span> <span class="n">lr</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>

        <span class="n">mlflow</span><span class="p">.</span><span class="n">sklearn</span><span class="p">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">sk_model</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s">"model"</span><span class="p">,</span> <span class="n">registered_model_name</span><span class="o">=</span><span class="n">MODEL_NAME</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mlflow server -h 0.0.0.0 -p 8000 --backend-store-uri sqlite:///db.sqlite3 --default-artifact-root s3://jay-ml-models
</code></pre></div></div>

<p><img src="/images/mlflow_10.png" alt="" /></p>

<p><img src="/images/mlflow_11.png" alt="" /></p>

<p><img src="/images/mlflow_12.png" alt="" /></p>

<p><img src="/images/mlflow_13.png" alt="" /></p>

<ul>
  <li>ì´ì œ AWS S3ë¥¼ ì´ìš©í•´ ìš°ë¦¬ì˜ ëª¨ë¸ì„ í¬í•¨í•œ artifactë¥¼ ê³µìœ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤</li>
  <li>ì—¬ê¸°ê¹Œì§€ê°€ Trackingê³¼ Registryì— ê´€í•œ ë‚´ìš©ì´ì—ˆë‹¤</li>
</ul>

<h2 id="mlflow-project">MLflow Project</h2>

<ul>
  <li>MLflow ProjectëŠ” ë‚´ê°€ <strong>ì‚¬ìš©í•œ í™˜ê²½(ex. ë„ì»¤, íŒŒì´ì¬, ì•„ë‚˜ì½˜ë‹¤), ì½”ë“œ, ëª…ë ¹ì–´</strong> ë“±ì„ í†µì§¸ë¡œ íŒ¨í‚¤ì§•í•¨ìœ¼ë¡œì¨,</li>
  <li>ë‹¤ë¥¸ íŒ€ì›ë“¤ë„ ê°™ì€ ì‹¤í—˜ì„ ëŒë ¤ë³¼ ìˆ˜ ìˆë‹¤.</li>
  <li>í™˜ê²½, ì½”ë“œ ë“±ê³¼ ê°™ì€ ì„¤ì •ì€ <code class="language-plaintext highlighter-rouge">MLProject</code> ë¼ëŠ” YAML í˜•íƒœì˜ íŒŒì¼ë¡œ ì •ì˜í•  ìˆ˜ ìˆë‹¤.</li>
</ul>

<p>The key features for the implementation of the model are specified in the MLProject file. These include:</p>

<ul>
  <li>the input parameters that the model receives,</li>
  <li>the data type of the parameters,</li>
  <li>the command for executing the model, and</li>
  <li>the environment in which the project runs.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>package_example
â”œâ”€â”€ MLProject
â”œâ”€â”€ python_env.yaml
â”œâ”€â”€ load_model.py
â””â”€â”€ requirements.txt
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># MLProject</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">tutorial</span>
<span class="na">python_env</span><span class="pi">:</span> <span class="s">python_env.yaml</span>

<span class="na">entry_points</span><span class="pi">:</span>
  <span class="na">main</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">python3</span><span class="nv"> </span><span class="s">load_model.py"</span>
</code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load_model.py
</span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">model_path</span> <span class="o">=</span> <span class="s">'s3://jay-ml-models/1/006d75d20d9847a4af884bca40e2a66e/artifacts/model/'</span>

<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="p">.</span><span class="n">sklearn</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>


<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"http://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv"</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">";"</span><span class="p">)</span>

<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">test_x</span> <span class="o">=</span> <span class="n">test</span><span class="p">.</span><span class="n">drop</span><span class="p">([</span><span class="s">"quality"</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">input_x</span> <span class="o">=</span> <span class="n">test_x</span><span class="p">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">loaded_model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_x</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># python_env.yaml</span>
<span class="na">python</span><span class="pi">:</span> <span class="s">3.8.13</span>
<span class="na">build_dependencies</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">pip==22.3</span>
<span class="pi">-</span> <span class="s">setuptools==56.0.0</span>
<span class="pi">-</span> <span class="s">wheel</span>
<span class="na">dependencies</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">-r requirements.txt</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># requirements.txt</span>
mlflow
<span class="nv">cloudpickle</span><span class="o">==</span>2.2.0
<span class="nv">psutil</span><span class="o">==</span>5.9.3
scikit-learn<span class="o">==</span>1.1.2
typing-extensions<span class="o">==</span>4.4.0
boto3
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mlflow run sklearn_logistic_regression <span class="nt">-e</span> main <span class="nt">-P</span> <span class="nv">alpha</span><span class="o">=</span>0.1 <span class="nt">-P</span> <span class="nv">l1_ratio</span><span class="o">=</span>0.5
</code></pre></div></div>

<p>In both examples, the environment will be generated based on the <code class="language-plaintext highlighter-rouge">MLProject file</code> specification. The command that triggers the model will be executed under the arguments passed on the command line. Since the model allows input parameters, these are assigned through the <code class="language-plaintext highlighter-rouge">-P</code> flag. In both examples, the model parameter refers to the maximum depth of the decision tree.</p>

<p>By default, a run like the one shown in the example will store the artifacts in the <code class="language-plaintext highlighter-rouge">.mlruns</code> directory.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ MLproject
â”œâ”€â”€ train.py
â””â”€â”€ wine-quality.csv
</code></pre></div></div>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Dockerfile</span>

<span class="k">FROM</span><span class="s"> python:3.8.8-slim-buster</span>

<span class="k">RUN </span>pip <span class="nb">install </span>mlflow&gt;<span class="o">=</span>1.0 <span class="se">\
</span>    <span class="o">&amp;&amp;</span> pip <span class="nb">install </span>numpy <span class="se">\
</span>    <span class="o">&amp;&amp;</span> pip <span class="nb">install </span>pandas <span class="se">\
</span>    <span class="o">&amp;&amp;</span> pip <span class="nb">install </span>scikit-learn
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># MLproject</span>

<span class="na">name</span><span class="pi">:</span> <span class="s">docker-example</span>

<span class="na">docker_env</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span>  <span class="s">mlflow-docker-example</span>

<span class="na">entry_points</span><span class="pi">:</span>
  <span class="na">main</span><span class="pi">:</span>
    <span class="na">parameters</span><span class="pi">:</span>
      <span class="na">alpha</span><span class="pi">:</span> <span class="s">float</span>
      <span class="na">l1_ratio</span><span class="pi">:</span> <span class="pi">{</span><span class="nv">type</span><span class="pi">:</span> <span class="nv">float</span><span class="pi">,</span> <span class="nv">default</span><span class="pi">:</span> <span class="nv">0.1</span><span class="pi">}</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s2">"</span><span class="s">python</span><span class="nv"> </span><span class="s">train.py</span><span class="nv"> </span><span class="s">--alpha</span><span class="nv"> </span><span class="s">{alpha}</span><span class="nv"> </span><span class="s">--l1-ratio</span><span class="nv"> </span><span class="s">{l1_ratio}"</span>
</code></pre></div></div>

<h2 id="model-loading">Model loading</h2>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">mlflow</span>

<span class="n">model_path</span> <span class="o">=</span> <span class="s">'s3://jay-ml-models/1/006d75d20d9847a4af884bca40e2a66e/artifacts/model/'</span>

<span class="n">loaded_model</span> <span class="o">=</span> <span class="n">mlflow</span><span class="p">.</span><span class="n">sklearn</span><span class="p">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

<span class="n">loaded_model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="ì°¸ê³ ">ì°¸ê³ </h1>

<ul>
  <li><a href="https://mlflow.org/docs/latest/index.html" target="_blank">MLflow Documentation</a></li>
  <li><a href="https://pajamacoder.tistory.com/32" target="_blank">pajamacoder, [mlflow ] mlflow ì†Œê°œì™€ ì‚¬ìš© ì´ìœ  (1/3)</a></li>
  <li><a href="https://www.kdnuggets.com/2022/08/package-distribute-machine-learning-models-mlflow.html" target="_blank">KD nuggets, How to Package and Distribute Machine Learning Models with MLFlow</a></li>
  <li><a href="https://www.adaltas.com/en/2020/03/23/mlflow-open-source-ml-platform-tutorial/" target="_blank">Petra KAFERLE DEVISSCHERE, MLflow tutorial: an open source Machine Learning (ML) platform</a></li>
  <li><a href="https://dailyheumsi.tistory.com/263" target="_blank">í•˜ë‚˜ì”© ì ì„ ì°ì–´ ë‚˜ê°€ë©°, MLflow - MLflow Projects</a></li>
  <li><a href="https://blog.noodle.ai/introduction-to-mlflow-for-mlops-part-3-database-tracking-minio-artifact-storage-and-registry/" target="_blank">noodle.ai, Introduction to MLflow for MLOps Part 3: Database Tracking, Minio Artifact Storage, and Registry</a></li>
</ul>
:ET