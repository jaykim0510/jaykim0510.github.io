I"<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#bridge-network-driver" id="markdown-toc-bridge-network-driver">Bridge Network Driver</a></li>
  <li><a href="#overlay-network-driver" id="markdown-toc-overlay-network-driver">overlay network driver</a></li>
  <li><a href="#참고" id="markdown-toc-참고">참고</a></li>
</ul>

<hr />

<p>도커의 네트워크의 철학은 <strong>CNM(Container Network Model)</strong>을 따릅니다. CNM은 컨테이너를 사용하는 환경에서 사용자가 네트워크 설계를 쉽게 하기 위한 것입니다. 다시 말해, 복잡한 물리적인 환경을 고려할 필요없이 사용자는 네트워크를 설계할 때 추상적인 개념만을 이용해 설계할 수 있게 됩니다. 이러한 추상화는 운영체제나 인프라 환경에 구애받지 않는 설계를 가능하도록 해줍니다.</p>

<p>이러한 개념(CNM)으로 네트워크를 구현해 놓은 것이 libnetwork이고 사용자가 사용할 수 있도록 기능을 제공하는 드라이버가 Networkdriver입니다.</p>

<p>당연히 다음 질문은 <strong>어떤 네트워크 드라이버를 사용해야 하는가</strong> 하는 것입니다. 각 드라이버는 트레이드오프를 제공하며 사용 사례에 따라 다른 장점이 있습니다. 도커 엔진과 함께 제공되는 내장 네트워크 드라이버가 있으며 네트워킹 벤더와 커뮤니티에서 제공하는 플러그인 네트워크 드라이버도 있다. 가장 일반적으로 사용되는 내장 네트워크 드라이버는 <code class="language-plaintext highlighter-rouge">bridge</code>, <code class="language-plaintext highlighter-rouge">overlay</code>, <code class="language-plaintext highlighter-rouge">macvlan</code>입니다. 이번 포스트에서는 비교적 간단한 드라이버인 <code class="language-plaintext highlighter-rouge">bridge</code>와 <code class="language-plaintext highlighter-rouge">overlay</code>에 대해서만 살펴보겠습니다.</p>

<ul>
  <li><strong>bridge</strong>: it creates single-host bridge networks. Containers connect to these bridges. To allow outbound traffic to the container, the Kernel iptables does NAT. For inbound traffic, we would need to port-forward a host port with a container port.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>🦊 **Note**  
Every Docker host has a default bridge network (docker0).  
All new container will attach to it unless you override it (using --network flag).   
</code></pre></div>    </div>
  </li>
  <li><strong>Overlay</strong>: it allows containers in different hosts to communicate using encapsulation. It allows you to create a flat, secure, layer-2 network.</li>
  <li><strong>MACVLAN</strong>: Multi-host network. Containers will have its own MAC and IP addresses on the existing physical network (or VLAN). Good things: it is easy and does not use port-mapping. Bad side: the host NIC has to be in promiscuous mode (most cloud provider does not allow this).</li>
</ul>

<h1 id="bridge-network-driver">Bridge Network Driver</h1>

<p><code class="language-plaintext highlighter-rouge">bridge</code> 네트워크 드라이버가 우리 목록의 첫 번째 드라이버입니다. 이해하기 쉽고, 사용하기 쉽고, 문제 해결이 간단하기 때문에 개발자와 Docker를 처음 접하는 사람들에게 좋은 네트워킹 선택이 됩니다. <code class="language-plaintext highlighter-rouge">bridge</code> 드라이버는 <strong>private 네트워크를 호스트 내부에 생성해 컨테이너들이 생성한 네트워크 안에서 통신할 수 있도록 합니다</strong>. 컨테이너에 포트를 노출함으로써 외부 액세스가 허용됩니다. 도커는 서로 다른 도커 네트워크 간의 연결을 차단하는 규칙을 관리하여 네트워크를 보호합니다.</p>

<p>내부적으로 도커 엔진은 <strong>리눅스 브리지, 내부 인터페이스, iptables 규칙 및 호스트 경로</strong>를 만들어 컨테이너 간의 연결을 가능하게 합니다. 아래 강조 표시된 예에서는 도커 브리지 네트워크가 생성되고 두 개의 컨테이너가 이 네트워크에 연결됩니다. 도커 엔진은 <strong>별도의 설정 없이 필요한 연결을 수행하고 컨테이너에 대한 서비스 디스커버리를 제공</strong>하며 다른 네트워크와의 통신을 차단하도록 보안 규칙을 구성합니다.</p>

<p><img src="../../images/docker_22.png" alt="" /></p>

<p>우리의 애플리케이션은 현재 호스트 8000번 포트에서 서비스되고 있습니다. 도커 브리지는 컨테이너 이름으로 <code class="language-plaintext highlighter-rouge">web</code>이 <code class="language-plaintext highlighter-rouge">db</code>와 통신할 수 있도록 하고 있습니다. 브릿지 드라이버는 같은 네트워크에 있기 때문에 자동으로 우리를 위해 서비스 디스커버리를 합니다.</p>

<p>브리지 드라이버는 로컬 범위 드라이버이므로 단일 호스트에서 서비스 디스커버리, IPAM 및 연결만 제공합니다. 다중 호스트 서비스 검색을 수행하려면 컨테이너를 호스트 위치에 매핑할 수 있는 외부 솔루션이 필요합니다. 이 때 필요한 것이 바로 <code class="language-plaintext highlighter-rouge">overlay</code> 드라이버입니다.</p>

<h1 id="overlay-network-driver">overlay network driver</h1>

<p><code class="language-plaintext highlighter-rouge">overlay</code> 네트워크 드라이버는 <strong>multi-host 네트워킹</strong>의 많은 복잡성을 획기적으로 단순화합니다. <strong>Swarm 스코프 드라이버</strong>로, 개별 호스트가 아닌 전체 Swarm 또는 UCP 클러스터에서 작동합니다.</p>

<p><code class="language-plaintext highlighter-rouge">overlay</code> 드라이버는 컨테이너 네트워크를 물리적 네트워크와 분리해주는 VXLAN data plane을 사용합니다. 덕분에 다양한 클라우드, 온-프레미스 네트워크 환경 속에서 최고의 이식성을 제공해줍니다.</p>

<p><img src="../../images/docker_23.png" alt="" /></p>

<h1 id="참고">참고</h1>
<ul>
  <li><a href="https://docs.docker.com/network/" target="_blank">도커 공식문서</a></li>
  <li><a href="https://www.docker.com/blog/understanding-docker-networking-drivers-use-cases/" target="_blank">MARK CHURCH, Understanding Docker Networking Drivers and their use cases</a></li>
  <li><a href="https://captcha.tistory.com/70" target="_blank">클라우드 엔지니어 Won의 성장 블로그, 06. 도커 네트워크 포스트</a></li>
  <li><a href="https://www.daleseo.com/docker-networks/" target="_blank">DaleSeo: Docker 네트워크 사용법</a></li>
</ul>
:ET