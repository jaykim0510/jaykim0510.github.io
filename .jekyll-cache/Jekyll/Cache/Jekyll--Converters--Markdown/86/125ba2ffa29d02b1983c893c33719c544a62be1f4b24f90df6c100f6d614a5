I"‚<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#ì¿ ë²„ë„¤í‹°ìŠ¤ì˜-ë¦¬ì†ŒìŠ¤" id="markdown-toc-ì¿ ë²„ë„¤í‹°ìŠ¤ì˜-ë¦¬ì†ŒìŠ¤">ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë¦¬ì†ŒìŠ¤</a>    <ul>
      <li><a href="#workload-resources" id="markdown-toc-workload-resources">Workload Resources</a>        <ul>
          <li><a href="#pod" id="markdown-toc-pod">Pod</a></li>
          <li><a href="#replicaset" id="markdown-toc-replicaset">ReplicaSet</a></li>
          <li><a href="#deployment" id="markdown-toc-deployment">Deployment</a></li>
        </ul>
      </li>
      <li><a href="#serviceê´€ë ¨-ë¦¬ì†ŒìŠ¤" id="markdown-toc-serviceê´€ë ¨-ë¦¬ì†ŒìŠ¤">Serviceê´€ë ¨ ë¦¬ì†ŒìŠ¤</a>        <ul>
          <li><a href="#service" id="markdown-toc-service">Service</a></li>
          <li><a href="#ingress" id="markdown-toc-ingress">Ingress</a></li>
        </ul>
      </li>
      <li><a href="#config-and-storageê´€ë ¨-ë¦¬ì†ŒìŠ¤" id="markdown-toc-config-and-storageê´€ë ¨-ë¦¬ì†ŒìŠ¤">Config and Storageê´€ë ¨ ë¦¬ì†ŒìŠ¤</a>        <ul>
          <li><a href="#configmap" id="markdown-toc-configmap">ConfigMap</a></li>
          <li><a href="#volume" id="markdown-toc-volume">Volume</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#ì°¸ê³ ìë£Œ" id="markdown-toc-ì°¸ê³ ìë£Œ">ì°¸ê³ ìë£Œ</a></li>
</ul>

<hr />

<h1 id="ì¿ ë²„ë„¤í‹°ìŠ¤ì˜-ë¦¬ì†ŒìŠ¤">ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ë¦¬ì†ŒìŠ¤</h1>

<h2 id="workload-resources">Workload Resources</h2>
<blockquote>
  <p>Workloads are objects that set deployment rules for pods. Based on these rules, Kubernetes performs the deployment and updates the workload with the current state of the application. Workloads let you define the rules for application scheduling, scaling, and upgrade.</p>
</blockquote>

<p><a href="https://rancher.com/docs/rancher/v2.5/en/k8s-in-rancher/workloads/">(Rancherë¬¸ì„œ ì°¸ê³ )</a></p>

<p><img src="/images/kube_10.png" alt="" /></p>

<h3 id="pod">Pod</h3>

<p><img src="/images/kube_11.png" alt="" /></p>

<p>PodëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ë°°í¬í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ì‘ì€ ë‹¨ìœ„ì˜ ì˜¤ë¸Œì íŠ¸ë¡œ í•œ ê°œ ì´ìƒì˜ ì»¨í…Œì´ë„ˆì™€ ìŠ¤í† ë¦¬ì§€, ë„¤íŠ¸ì›Œí¬ ì†ì„±ì„ ê°€ì§‘ë‹ˆë‹¤. Podì— ì†í•œ ì»¨í…Œì´ë„ˆëŠ” ìŠ¤í† ë¦¬ì§€ì™€ ë„¤íŠ¸ì›Œí¬ë¥¼ ê³µìœ í•˜ê³  ì„œë¡œ localhostë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì»¨í…Œì´ë„ˆë¥¼ í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ë„ ë°˜ë“œì‹œ Podìœ¼ë¡œ ê°ì‹¸ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>

<p>Podê°€ ìƒì„±ë˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<p><img src="/images/kube_12.png" alt="" /></p>

<p>SchedulerëŠ” ê³„ì† í• ë‹¹í•  ìƒˆë¡œìš´ Podê°€ ìˆëŠ”ì§€ ì²´í¬í•˜ê³  ìˆìœ¼ë©´ ë…¸ë“œì— í• ë‹¹í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ë…¸ë“œì— ìˆëŠ” Kubeletì€ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ê³  ê²°ê³¼ë¥¼ APIì„œë²„ì— ë³´ê³ í•©ë‹ˆë‹¤.</p>

<p>ğŸ¨ <strong>ì˜¤ë¸Œì íŠ¸ ìƒì„±ì„ ìœ„í•œ YAMLíŒŒì¼</strong></p>

<p>Podë¥¼ í¬í•¨í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” YAMLíŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤. YAMLíŒŒì¼ì— ì˜¤ë¸Œì íŠ¸ë¥¼ ìœ„í•œ ì„¤ì •ë“¤ì„ ì‘ì„±í•  ìˆ˜ ìˆëŠ”ë°, ì´ ë•Œ í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” keyê°’ë“¤ì´ ìˆìŠµë‹ˆë‹¤.</p>

<table>
  <tbody>
    <tr>
      <td><strong>Key</strong></td>
      <td><strong>ì„¤ëª…</strong></td>
      <td><strong>ì˜ˆ</strong></td>
    </tr>
    <tr>
      <td>apiVersion</td>
      <td>ì˜¤ë¸Œì íŠ¸ ë²„ì „</td>
      <td>v1, app/v1, ..</td>
    </tr>
    <tr>
      <td>kind</td>
      <td>ì˜¤ë¸Œì íŠ¸ ì¢…ë¥˜</td>
      <td>Pod, ReplicaSet, Deployment, ..</td>
    </tr>
    <tr>
      <td>metadata</td>
      <td>ë©”íƒ€ë°ì´í„°</td>
      <td>name, label, ..</td>
    </tr>
    <tr>
      <td>spec</td>
      <td>ì˜¤ë¸Œì íŠ¸ ë³„ ìƒì„¸ ì„¤ì •</td>
      <td>ì˜¤ë¸Œì íŠ¸ë§ˆë‹¤ ë‹¤ë¦„</td>
    </tr>
  </tbody>
</table>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">echo</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">echo</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">app</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/subicura/echo:v1</span>
</code></pre></div></div>

<p>Podì˜ specì—ëŠ” <code class="language-plaintext highlighter-rouge">containers</code>, <code class="language-plaintext highlighter-rouge">volumes</code>, <code class="language-plaintext highlighter-rouge">restartPolicy</code>, <code class="language-plaintext highlighter-rouge">hostname</code>, <code class="language-plaintext highlighter-rouge">hostNetwork</code> ë“±ì´ ìˆìŠµë‹ˆë‹¤.<br />
<a href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/">(Podê³µì‹ë¬¸ì„œ ì°¸ê³ )</a></p>

<h3 id="replicaset">ReplicaSet</h3>

<p><img src="/images/kube_13.png" alt="" /></p>

<p>ReplicaSetì€ Podì„ ì—¬ëŸ¬ ê°œ(í•œ ê°œ ì´ìƒ) ë³µì œí•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤. ë‹¨ì¼ ë…¸ë“œ í™˜ê²½ì´ë©´ PodëŠ” ëª¨ë‘ ë‹¨ì¼ ë…¸ë“œì—ì„œ ìƒì„±ë˜ê³ , ì—¬ëŸ¬ê°œì˜ ë…¸ë“œë¥¼ ê°€ì§€ê³  ìˆëŠ” ìƒí™©ì´ë©´, PodëŠ” ë…¸ë“œì— ê°ê° ë¶„ì‚°ë˜ì–´ ë°°í¬ë©ë‹ˆë‹¤. ì´ ë•Œ Podë¥¼ ì–´ë–¤ ë…¸ë“œì— ë°°ì¹˜í• ì§€ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ê²°ì •í•˜ê²Œ ë©ë‹ˆë‹¤. ë³´í†µ ì§ì ‘ì ìœ¼ë¡œ ReplicaSetì„ ì‚¬ìš©í•˜ê¸°ë³´ë‹¤ëŠ” Deploymentë“± ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì— ì˜í•´ì„œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.</p>

<p>ReplicaSetì€ ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤.</p>

<p><img src="/images/kube_14.png" alt="" /></p>

<p>ReplicaSet controllerê°€ desired stateì— ë§ì¶° Podë¥¼ ìƒì„±í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë©´ SchedulerëŠ” ìƒì„±ëœ Podë¥¼ ë…¸ë“œì— í• ë‹¹í•´ì¤ë‹ˆë‹¤.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ReplicaSet</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">echo-rs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">3</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span> <span class="c1"># app: echoì´ê³  tier: appì¸ labelì„ ê°€ì§€ëŠ” íŒŒë“œë¥¼ ê´€ë¦¬</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">echo</span>
      <span class="na">tier</span><span class="pi">:</span> <span class="s">app</span>
  <span class="na">template</span><span class="pi">:</span> <span class="c1"># replicasetì´ ë§Œë“œëŠ” podì˜ í…œí”Œë¦¿</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">echo</span>
        <span class="na">tier</span><span class="pi">:</span> <span class="s">app</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">echo</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/subicura/echo:v1</span>
</code></pre></div></div>

<p>ReplicaSetì˜ specì—ëŠ” <code class="language-plaintext highlighter-rouge">replicas</code>, <code class="language-plaintext highlighter-rouge">selector</code>, <code class="language-plaintext highlighter-rouge">template</code>, <code class="language-plaintext highlighter-rouge">minReadySeconds</code>ê°€ ìˆìŠµë‹ˆë‹¤.<br />
<a href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/replica-set-v1/#ReplicaSetSpec">(ReplicaSet ê³µì‹ë¬¸ì„œ ì°¸ê³ )</a></p>

<h3 id="deployment">Deployment</h3>

<p><img src="/images/kube_18.png" alt="" /></p>

<p>DeploymentëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤. ReplicaSetì„ ì´ìš©í•˜ì—¬ Podì„ ì—…ë°ì´íŠ¸í•˜ê³  ì´ë ¥ì„ ê´€ë¦¬í•˜ì—¬ ë¡¤ë°±Rollbackí•˜ê±°ë‚˜ íŠ¹ì • ë²„ì „revisionìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>Deployment ì˜¤ë¸Œì íŠ¸ê°€ Podì˜ ë²„ì „ì„ ê´€ë¦¬í•˜ëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<p><img src="/images/kube_17.png" alt="" /></p>

<p>Deployment Controllerê°€ Deploy ì¡°ê±´ì„ ì²´í¬í•˜ë©´ì„œ ì›í•˜ëŠ” ë²„ì „ì— ë§ê²Œ Podì˜ ë²„ì „ì„ ë§ì¶¥ë‹ˆë‹¤. ì´ ë•Œ ReplicaSetì— ìˆëŠ” Podë“¤ì„ ë³´í†µ í•œ ë²ˆì— ë°”ê¾¸ì§€ ì•Šê³  ì¡°ê±´ì— ë§ê²Œ(ì˜ˆë¥¼ ë“¤ì–´, 25%ì”©) ë°”ê¿”ë‚˜ê°ìœ¼ë¡œì¨ ë²„ì „ì„ ë°”ê¾¸ë”ë¼ë„ ì¤‘ê°„ì— ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤. (ë¬´ì¤‘ë‹¨ë°°í¬)</p>

<p><img src="/images/kube_19.png" alt="" /></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">echo-deploy</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">strategy</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">RollingUpdate</span>
    <span class="na">rollingUpdate</span><span class="pi">:</span>
      <span class="na">maxSurge</span><span class="pi">:</span> <span class="m">1</span>
      <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">4</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">echo</span>
      <span class="na">tier</span><span class="pi">:</span> <span class="s">app</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">echo</span>
        <span class="na">tier</span><span class="pi">:</span> <span class="s">app</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">echo</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">ghcr.io/subicura/echo:v2</span>
</code></pre></div></div>

<p>specì—ëŠ” <code class="language-plaintext highlighter-rouge">replicas</code>, <code class="language-plaintext highlighter-rouge">selector</code>, <code class="language-plaintext highlighter-rouge">template</code>, <code class="language-plaintext highlighter-rouge">strategy</code>  ë“±ì´ ìˆìŠµë‹ˆë‹¤.<br />
<a href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/deployment-v1/#DeploymentSpec">(Deployment ê³µì‹ë¬¸ì„œ ì°¸ê³ )</a></p>

<h2 id="serviceê´€ë ¨-ë¦¬ì†ŒìŠ¤">Serviceê´€ë ¨ ë¦¬ì†ŒìŠ¤</h2>
<blockquote>
  <p>In many use cases, a workload has to be accessed by other workloads in the cluster or exposed to the outside world.</p>
</blockquote>

<h3 id="service">Service</h3>

<p><img src="/images/kube_20.png" alt="" /></p>

<p>ServiceëŠ” ë„¤íŠ¸ì›Œí¬ì™€ ê´€ë ¨ëœ ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤. Podì€ ìì²´ IPë¥¼ ê°€ì§€ê³  ë‹¤ë¥¸ Podê³¼ í†µì‹ í•  ìˆ˜ ìˆì§€ë§Œ, ì‰½ê²Œ ì‚¬ë¼ì§€ê³  ìƒì„±ë˜ëŠ” íŠ¹ì§• ë•Œë¬¸ì— ì§ì ‘ í†µì‹ í•˜ëŠ” ë°©ë²•ì€ ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” Podê³¼ ì§ì ‘ í†µì‹ í•˜ëŠ” ë°©ë²• ëŒ€ì‹ , ë³„ë„ì˜ ê³ ì •ëœ IPë¥¼ ê°€ì§„ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³  ê·¸ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ Podì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.<br />
Podì„ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì™€ ì—°ê²°í•´ì£¼ê³  ì—¬ëŸ¬ ê°œì˜ Podì„ ë°”ë¼ë³´ëŠ” ë‚´ë¶€ ë¡œë“œ ë°¸ëŸ°ì„œë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ë‚´ë¶€ DNSì— ì„œë¹„ìŠ¤ ì´ë¦„ì„ ë„ë©”ì¸ìœ¼ë¡œ ë“±ë¡í•˜ê¸° ë•Œë¬¸ì— ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ì—­í• ë„ í•©ë‹ˆë‹¤.</p>

<ul>
  <li>ClusterIP: Podê°€ ë™ì ìœ¼ë¡œ ì†Œë©¸/ìƒì„± ë˜ë”ë¼ë„ IPëŠ” ê³ ì •ë  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì—­í• </li>
  <li>NodePort: ì™¸ë¶€ì—ì„œ ì ‘ê·¼ê°€ëŠ¥í•˜ë„ë¡ í•˜ëŠ” í¬íŠ¸ ì—­í• </li>
  <li>LoadBalancer: ì‚´ì•„ìˆëŠ” ë…¸ë“œë¡œ ìë™ìœ¼ë¡œ ì—°ê²°í•´ì£¼ëŠ” ì—­í• </li>
</ul>

<p>NodePortëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ClusterIPì˜ ê¸°ëŠ¥ì„ í¬í•¨í•˜ê³  ìˆê³ , LoadBalancerëŠ” NodePortì˜ ê¸°ëŠ¥ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ClusterIP</span>
<span class="c1"># redisë¼ëŠ” Deployment ì˜¤ë¸Œì íŠ¸ì— IPí• ë‹¹</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">redis</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">6379</span> <span class="c1"># clusterIPì˜ í¬íŠ¸ (targetPortë”°ë¡œ ì—†ìœ¼ë©´ targetPort(podì˜ í¬íŠ¸)ë„ 6379ê°€ ë¨)</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">selector</span><span class="pi">:</span> <span class="c1"># ì–´ë–¤podë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬í• ì§€ ê²°ì •</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">counter</span>
    <span class="na">tier</span><span class="pi">:</span> <span class="s">db</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># NodePort</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">counter-np</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">3000</span> <span class="c1"># ClusterIP, Pod IPì˜ í¬íŠ¸</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">nodePort</span><span class="pi">:</span> <span class="m">31000</span> <span class="c1"># Node IPì˜ í¬íŠ¸</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">counter</span>
    <span class="na">tier</span><span class="pi">:</span> <span class="s">app</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># LoadBalancer</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">counter-lb</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">30000</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">3000</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">counter</span>
    <span class="na">tier</span><span class="pi">:</span> <span class="s">app</span>
</code></pre></div></div>

<h3 id="ingress">Ingress</h3>

<p><img src="/images/kube_21.png" alt="" /></p>

<p>IngressëŠ” ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ… ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•´ì£¼ëŠ” ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤.</p>

<p>LoadBalancerëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤. LoadBalancerëŠ” í•œ ê°œì˜ IPì£¼ì†Œë¡œ í•œ ê°œì˜ ì„œë¹„ìŠ¤ë§Œ í•¸ë“¤ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë§Œì•½ Nê°œì˜ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰ ì¤‘ì´ë¼ë©´ Nê°œì˜ LoadBalancerê°€ í•„ìš”í•©ë‹ˆë‹¤. ë˜í•œ ë³´í†µ í´ë¼ìš°ë“œ í”„ë¡œë°”ì´ë”(AWS, GCP ë“±)ì˜ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ìƒì„±í•´ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë¡œì»¬ì„œë²„ì—ì„œëŠ” ì‚¬ìš©ì´ ì–´ë µìŠµë‹ˆë‹¤.</p>

<p>IngressëŠ” ê²½ë¡œ ê¸°ë°˜ ë¼ìš°íŒ… ì„œë¹„ìŠ¤ë¥¼ í†µí•´ Nê°œì˜ serviceë¥¼ í•˜ë‚˜ì˜ IPì£¼ì†Œë¥¼ ì´ìš©í•˜ë”ë¼ë„ ê²½ë¡œë¥¼ í†µí•´ ë¶„ê¸°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>IngressëŠ” Pod, ReplicaSet, Deployment, Serviceì™€ ë‹¬ë¦¬ ë³„ë„ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ì—ëŠ” ëŒ€í‘œì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">nginx</code>, <code class="language-plaintext highlighter-rouge">haproxy</code>, <code class="language-plaintext highlighter-rouge">traefik</code>, <code class="language-plaintext highlighter-rouge">alb</code>ë“±ì´ ìˆìŠµë‹ˆë‹¤.</p>

<p>minikubeë¥¼ ì´ìš©í•  ê²½ìš° ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># nginx ingress controller</span>
minikube addons <span class="nb">enable </span>ingress
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">networking.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Ingress</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">echo-v1</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">rules</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">host</span><span class="pi">:</span> <span class="s">v1.echo.192.168.64.5.sslip.io</span>
      <span class="na">http</span><span class="pi">:</span>
        <span class="na">paths</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
            <span class="na">pathType</span><span class="pi">:</span> <span class="s">Prefix</span>
            <span class="na">backend</span><span class="pi">:</span>
              <span class="na">service</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">echo-v1</span>
                <span class="na">port</span><span class="pi">:</span>
                  <span class="na">number</span><span class="pi">:</span> <span class="m">3000</span>
<span class="c1"># ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì˜ hostê°€ v1.echo.192.168.64.5.sslip.ioì´ë©´ host echo-v1ì´ë¼ëŠ” ì„œë¹„ìŠ¤ê°€ ê°€ì§€ëŠ” IP ì£¼ì†Œì˜ 3000ë²ˆ í¬íŠ¸ë¡œ ë³´ë‚´ë¼</span>
</code></pre></div></div>

<p>specì—ëŠ” <code class="language-plaintext highlighter-rouge">rules</code>, <code class="language-plaintext highlighter-rouge">defaultBackend</code>(ì–´ëŠ ruleì—ë„ ì†í•˜ì§€ ì•Šì„ ê²½ìš°) ë“±ì´ ìˆìŠµë‹ˆë‹¤.<br />
<a href="https://kubernetes.io/docs/reference/kubernetes-api/service-resources/ingress-v1/">(Ingress ê³µì‹ë¬¸ì„œ ì°¸ê³ )</a></p>

<h2 id="config-and-storageê´€ë ¨-ë¦¬ì†ŒìŠ¤">Config and Storageê´€ë ¨ ë¦¬ì†ŒìŠ¤</h2>

<h3 id="configmap">ConfigMap</h3>

<p><img src="/images/kube_22.png" alt="" /></p>

<p>ConfigMapì€ ì„¤ì •, í™˜ê²½ ë³€ìˆ˜ë“¤ì„ ë‹´ëŠ” ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ê°œë°œ/ìš´ì˜ì— ë”°ë¼ í™˜ê²½ ë³€ìˆ˜ê°’ì´ ë‹¤ë¥¸ ê²½ìš°, ConfigMap ì„ í™œìš©í•´ Pod ìƒì„±ì‹œ ë„£ì–´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ConfigMapì„ ë‹¤ì–‘í•œ ë°©ë²•ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
  <li>ConfigMap yaml íŒŒì¼ë¡œ ì˜¤ë¸Œì íŠ¸ ìƒì„±</li>
  <li>í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì„ ë‹´ê³  ìˆëŠ” yamlíŒŒì¼ì„ ConfigMap ì˜¤ë¸Œì íŠ¸ë¡œ ìƒì„±</li>
  <li>ê·¸ëƒ¥ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë‹´ê³  ìˆëŠ” ì„ì˜ì˜ íŒŒì¼ì„ ConfigMap ì˜¤ë¸Œì íŠ¸ë¡œ ìƒì„±</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ConfigMap yamlíŒŒì¼</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span> <span class="c1"># ì°¸ê³ ë¡œ v1ì´ë©´ core API group</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-config</span>
<span class="na">data</span><span class="pi">:</span>
  <span class="na">hello</span><span class="pi">:</span> <span class="s">world</span>
  <span class="na">kuber</span><span class="pi">:</span> <span class="s">netes</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl apply <span class="nt">-f</span> config-map.yml
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì„ ë‹´ê³  ìˆëŠ” yamlíŒŒì¼</span>
<span class="na">global</span><span class="pi">:</span>
  <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">15s</span>

<span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s">prometheus</span>
    <span class="na">metrics_path</span><span class="pi">:</span> <span class="s">/prometheus/metrics</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">localhost:9090</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># yaml íŒŒì¼ë¡œ ConfigMap íŒŒì¼ ìƒì„±</span>
kubectl create cm my-config <span class="nt">--from-file</span><span class="o">=</span>config-file.yml

<span class="c"># ConfigMap ì ìš©</span>
kubectl apply <span class="nt">-f</span> my-config.yml
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># config-env.ymlíŒŒì¼ (ymlíŒŒì¼ ì•„ë‹ˆì§€ë§Œ ê·¸ëƒ¥ í™•ì¥ì ymlë¡œ í•´ë†“ì•„ë„ë¨)</span>
<span class="nv">hello</span><span class="o">=</span>world
<span class="nv">haha</span><span class="o">=</span>hoho
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì„ì˜ì˜ íŒŒì¼ë¡œ ConfigMap íŒŒì¼ ìƒì„±</span>
kubectl create cm env-config <span class="nt">--from-env-file</span><span class="o">=</span>config-env.yml

<span class="c"># ConfigMap ì ìš©</span>
kubectl apply <span class="nt">-f</span> env-config.yml
</code></pre></div></div>

<p>ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ConfigMapì„ Podì— ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<ul>
  <li>ë””ìŠ¤í¬ ë³¼ë¥¨ ë§ˆìš´íŠ¸</li>
  <li>í™˜ê²½ë³€ìˆ˜ë¡œ ì‚¬ìš©</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ConfigMap yamlíŒŒì¼ì´ ìˆëŠ” ë³¼ë¥¨ ë§ˆìš´íŠ¸</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">alpine</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">alpine</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">alpine</span>
      <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sleep"</span><span class="pi">]</span>
      <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">100000"</span><span class="pi">]</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config-vol</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/etc/config</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">config-vol</span>
      <span class="na">configMap</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">my-config</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ConfigMap yamlíŒŒì¼ ì§ì ‘ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">alpine-env</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">alpine</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">alpine</span>
      <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sleep"</span><span class="pi">]</span>
      <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">100000"</span><span class="pi">]</span>
      <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">hello</span>
          <span class="na">valueFrom</span><span class="pi">:</span>
            <span class="na">configMapKeyRef</span><span class="pi">:</span>
              <span class="na">name</span><span class="pi">:</span> <span class="s">my-config</span>
              <span class="na">key</span><span class="pi">:</span> <span class="s">hello</span>
</code></pre></div></div>

<h3 id="volume">Volume</h3>
<p>Volumeì€ ì €ì¥ì†Œì™€ ê´€ë ¨ëœ ì˜¤ë¸Œì íŠ¸ì…ë‹ˆë‹¤. ì§€ê¸ˆê¹Œì§€ ë§Œë“¤ì—ˆë˜ ì»¨í…Œì´ë„ˆëŠ” Podì„ ì œê±°í•˜ë©´ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ì €ì¥í–ˆë˜ ë°ì´í„°ë„ ëª¨ë‘ ì‚¬ë¼ì§‘ë‹ˆë‹¤. MySQLê³¼ ê°™ì€ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë°ì´í„°ê°€ ìœ ì‹¤ë˜ì§€ ì•Šë„ë¡ ë°˜ë“œì‹œ ë³„ë„ì˜ ì €ì¥ì†Œì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ì»¨í…Œì´ë„ˆë¥¼ ìƒˆë¡œ ë§Œë“¤ ë•Œ ì´ì „ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•©ë‹ˆë‹¤.<br />
ì €ì¥ì†Œë¥¼ í˜¸ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆê³  EBS ê°™ì€ ìŠ¤í† ë¦¬ì§€ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. ì‚¬ì‹¤ìƒ ì¸ê¸° ìˆëŠ” ëŒ€ë¶€ë¶„ì˜ ì €ì¥ ë°©ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤.</p>

<p>ì €ì¥ì†Œì˜ ì¢…ë¥˜ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²ƒë“¤ì´ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ì„ì‹œ ë””ìŠ¤í¬
    <ul>
      <li>emptyDir
        <ul>
          <li>Pod ì´ ìƒì„±ë˜ê³  ì‚­ì œë  ë•Œ, ê°™ì´ ìƒì„±ë˜ê³  ì‚­ì œë˜ëŠ” ì„ì‹œ ë””ìŠ¤í¬</li>
          <li>ìƒì„± ë‹¹ì‹œì—ëŠ” ì•„ë¬´ ê²ƒë„ ì—†ëŠ” ë¹ˆ ìƒíƒœ</li>
          <li>ë¬¼ë¦¬ ë””ìŠ¤í¬(ë…¸ë“œ), ë©”ëª¨ë¦¬ì— ì €ì¥</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ë¡œì»¬ ë””ìŠ¤í¬
    <ul>
      <li>hostpath
        <ul>
          <li>ë…¸ë“œê°€ ìƒì„±ë  ë•Œ ì´ë¯¸ ì¡´ì¬í•˜ê³  ìˆëŠ” ë””ë ‰í† ë¦¬</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ë„¤íŠ¸ì›Œí¬ ë””ìŠ¤í¬
    <ul>
      <li>awsElasticBlockStore, azureDisk ë“±</li>
    </ul>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># emptydir</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">shared-volumes</span> 
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">shared-storage</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/data/shared</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">shared-storage</span>
      <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/data/shared</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name </span><span class="pi">:</span> <span class="s">shared-storage</span>
    <span class="na">emptyDir</span><span class="pi">:</span> <span class="pi">{}</span>
</code></pre></div></div>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># hostpath</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">host-log</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">log</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">busybox</span>
      <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">/bin/sh"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-c"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">sleep</span><span class="nv"> </span><span class="s">infinity"</span><span class="pi">]</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">varlog</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/host/var/log</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">varlog</span>
      <span class="na">hostPath</span><span class="pi">:</span>
        <span class="na">path</span><span class="pi">:</span> <span class="s">/var/log</span>
</code></pre></div></div>

<h1 id="ì°¸ê³ ìë£Œ">ì°¸ê³ ìë£Œ</h1>
<ul>
  <li><a href="https://subicura.com/2019/05/19/kubernetes-basic-1.html">subicuraë‹˜ì˜ kubenetesì•ˆë‚´ì„œ</a></li>
  <li><a href="https://dailyheumsi.tistory.com/208#7.-configmap">í•˜ë‚˜ì”© ì ì„ ì°ì–´ë‚˜ê°€ë©° ë¸”ë¡œê·¸</a></li>
  <li><a href="https://kubernetes.io/docs/reference/kubernetes-api/">Kubernetes ê³µì‹ë¬¸ì„œ</a></li>
  <li><a href="https://rancher.com/docs/rancher/v2.5/en/k8s-in-rancher/">Rancher ê³µì‹ë¬¸ì„œ</a></li>
</ul>
:ET