I"°<p id="toc"><strong>Table of Contents</strong></p>

<hr />

<p><a href="https://www.confluent.io/blog/kafka-listeners-explained/">ì›ë¬¸: Confluentë¸”ë¡œê·¸</a></p>

<p>ì¹´í”„ì¹´ í´ë¼ì´ì–¸íŠ¸ê°€ ì¹´í”„ì¹´ì— ì—°ê²°ë˜ê¸° ìœ„í•´ì„œëŠ” <code class="language-plaintext highlighter-rouge">advertised.listeners</code>(ë˜ëŠ” ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•  ê²½ìš° <code class="language-plaintext highlighter-rouge">KAFKA_ADVERTISED_LISTENERS</code>)ë¥¼ <strong>external IP ì£¼ì†Œ</strong>ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<p><img src="/images/kafka_36.png" alt="" /></p>

<p>ì•„íŒŒì¹˜ ì¹´í”„ì¹´ëŠ” ë¶„ì‚° ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ë°ì´í„°ëŠ” ë¦¬ë” íŒŒí‹°ì…˜ìœ¼ë¡œë¶€í„° ì“°ê³  ì½ì–´ì§€ë©° ë¦¬ë” íŒŒí‹°ì…˜ì€ ì–´ë–¤ ë¸Œë¡œì»¤ì—ë„ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ í´ë¼ì´ì–¸íŠ¸ê°€ ì¹´í”„ì¹´ì— ì—°ê²°ë˜ê¸° ìœ„í•´ì„œëŠ” í•´ë‹¹ ë¦¬ë” íŒŒí‹°ì…˜ì„ ê°€ì§€ê³  ìˆëŠ” ë¸Œë¡œì»¤ê°€ ëˆ„êµ¬ì¸ì§€ì— ëŒ€í•œ ë©”íƒ€ë°ì´í„°ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤. ì´ ë©”íƒ€ë°ì´í„°ì—ëŠ” ë¦¬ë” íŒŒí‹°ì…˜ì„ ê°€ì§€ëŠ” ë¸Œë¡œì»¤ì˜ ì—”ë“œí¬ì¸íŠ¸ ì •ë³´ë¥¼ í¬í•¨í•˜ê³  ìˆìœ¼ë©° í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ ì •ë³´ë¥¼ ì´ìš©í•´ ì¹´í”„ì¹´ì™€ ì—°ê²°ë  ê²ƒì…ë‹ˆë‹¤.</p>

<p>ë§Œì•½ ì¹´í”„ì¹´ê°€ ë„ì»¤ì™€ ê°™ì€ ê°€ìƒë¨¸ì‹ ì´ ì•„ë‹Œ bare metal ìœ„ì—ì„œ ë™ì‘í•œë‹¤ë©´ ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” ê·¸ì € <code class="language-plaintext highlighter-rouge">hostname</code>ì´ë‚˜ <code class="language-plaintext highlighter-rouge">localhost</code> ì •ë„ê°€ ë  ê²ƒì…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì¡°ê¸ˆ ë” ë³µì¡í•œ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ ë˜ëŠ” ë©€í‹° ë…¸ë“œ í™˜ê²½ìœ¼ë¡œ ì˜¤ê²Œ ë˜ë©´ ì¡°ê¸ˆ ë” ì£¼ì˜ê°€ í•„ìš”í•˜ê²Œ ë©ë‹ˆë‹¤.</p>

<p>Letâ€™s assume you have more than one network. This could be things like:</p>

<p>Docker internal network(s) plus host machine
Brokers in the cloud (e.g., AWS EC2) and on-premises machines locally (or even in another cloud)
You need to tell Kafka how the brokers can reach each other but also make sure that external clients (producers/consumers) can reach the broker they need to reach.</p>

<p>ì´ˆê¸°ì— ë¸Œë¡œì»¤ê°€ ì—°ê²°ë˜ë©´ ì‹¤ì œë¡œ ë¦¬ë” íŒŒí‹°ì…˜ì„ ê°€ì§€ëŠ” ë¸Œë¡œì»¤ì˜ hostì™€ IPì˜ ì •ë³´ë¥¼ ëŒë ¤ì¤ë‹ˆë‹¤. ì´ëŸ¬í•œ ê³¼ì •ì€ ë‹¨ì¼ ë…¸ë“œ í™˜ê²½ì—ì„œë„ ë§ˆì°¬ê°€ì§€ì…ë‹ˆë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>KAFKA_LISTENERS: LISTENER_BOB://kafka0:29092,LISTENER_FRED://localhost:9092
KAFKA_ADVERTISED_LISTENERS: LISTENER_BOB://kafka0:29092,LISTENER_FRED://localhost:9092
KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: LISTENER_BOB:PLAINTEXT,LISTENER_FRED:PLAINTEXT
KAFKA_INTER_BROKER_LISTENER_NAME: LISTENER_BOB
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">server.properties</code></p>

<ul>
  <li><strong>KAFKA_LISTENERS</strong>: ì¹´í”„ì¹´ê°€ ë¦¬ìŠ¤ë‹í•˜ê¸° ìœ„í•´ ë…¸ì¶œí•˜ëŠ” host/IPì™€ port</li>
  <li><strong>KAFKA_ADVERTISED_LISTENERS</strong>: í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì•Œë ¤ì£¼ëŠ” ë¦¬ìŠ¤ë„ˆì˜ host/IPì™€ port ë¦¬ìŠ¤íŠ¸</li>
  <li><strong>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</strong>: ê° ë¦¬ìŠ¤ë„ˆë“¤ì´ ì‚¬ìš©í•˜ëŠ” security protocol</li>
  <li><strong>KAFKA_INTER_BROKER_LISTENER_NAME</strong>: ë¸Œë¡œì»¤ë“¤ ê°„ì˜ í†µì‹ ì„ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ë¦¬ìŠ¤ë„ˆ</li>
</ul>

<p>Kafka clients may well not be local to the brokerâ€™s network, and this is where the additional listeners come in.</p>

<p>Each listener will, when connected to, report back the address at which it can be reached. The address at which you reach a broker depends on the network used. If youâ€™re connecting to the broker from an internal network, itâ€™s going to be a different host/IP than when connecting externally.</p>

<p>When connecting to a broker, the listener that will be returned to the client will be the listener to which you connected (based on the port).</p>

<p>kafkacat is a useful tool for exploring this. Using -L, you can see the metadata for the listener to which you connected. Based on the same listener config as above (LISTENER_BOB/LISTENER_FRED), check out the respective entries for broker 0 at: -:</p>
:ET