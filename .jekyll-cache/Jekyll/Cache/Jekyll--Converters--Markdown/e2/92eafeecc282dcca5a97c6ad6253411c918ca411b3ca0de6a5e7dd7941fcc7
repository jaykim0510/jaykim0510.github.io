I" <hr />

<p id="toc"><strong>Table of Contents</strong></p>
<ul id="markdown-toc">
  <li><a href="#consensus-algorithm" id="markdown-toc-consensus-algorithm">Consensus Algorithm</a></li>
  <li><a href="#raft" id="markdown-toc-raft">RAFT</a>    <ul>
      <li><a href="#leader-election" id="markdown-toc-leader-election">Leader Election</a></li>
      <li><a href="#log-replication" id="markdown-toc-log-replication">Log Replication</a></li>
      <li><a href="#safety" id="markdown-toc-safety">Safety</a></li>
    </ul>
  </li>
  <li><a href="#ì°¸ê³ " id="markdown-toc-ì°¸ê³ ">ì°¸ê³ </a></li>
</ul>

<hr />

<h1 id="consensus-algorithm">Consensus Algorithm</h1>

<p>í•©ì˜ ì•Œê³ ë¦¬ì¦˜ì€ ë°ì´í„° ë™ê¸°í™” ë¬¸ì œ, ë¶€ë¶„ ì¥ì•  ë¬¸ì œë¥¼ í•´ê²°í•´ì¤€ë‹¤.</p>

<p><img src="/images/dis_sys_8.png" alt="" /></p>

<ul>
  <li>whether a transaction has been committed or not</li>
  <li>whether a message has been delivered or not</li>
</ul>

<h1 id="raft">RAFT</h1>

<ul>
  <li>RaftëŠ” ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ í•©ì˜ ì•Œê³ ë¦¬ì¦˜ì„ êµ¬í˜„í•œ í”„ë¡œí† ì½œ</li>
  <li>RaftëŠ” í•©ì˜ ì•Œê³ ë¦¬ì¦˜ì„ í¬ê²Œ 3ê°œì˜ ë¶€ë¶„ ë¬¸ì œë¡œ ë¶„í•´í•œë‹¤
    <ul>
      <li>Leader Election: A new leader needs to be elected in case of the failure of an existing one.</li>
      <li>Log replication: The leader needs to keep the logs of all servers in sync with its own through replication.</li>
      <li>Safety: If one of the servers has committed a log entry at a particular index, no other server can apply a different log entry for that index.</li>
    </ul>
  </li>
  <li>ëª¨ë“  ì„œë²„ëŠ” leader, follower, or candidate ì¤‘ í•˜ë‚˜ì˜ ìƒíƒœë¥¼ ê°€ì§„ë‹¤</li>
</ul>

<p><img src="/images/dis_sys_9.png" alt="" /></p>

<ul>
  <li>ë¶„ì‚° ì‹œìŠ¤í…œì´ ìœ ì§€í•˜ê³ ì í•˜ëŠ” ìƒí™©ì€ í•˜ë‚˜ì˜ ì„œë²„ëŠ” ë¦¬ë”, ë‚˜ë¨¸ì§€ëŠ” ëª¨ë‘ íŒ”ë¡œì›Œì¸ ìƒíƒœì´ë‹¤</li>
  <li>
    <p>íŒ”ë¡œì›Œë“¤ì€ ìš”ì²­ì„ ë³´ë‚´ì§€ ì•ŠëŠ”ë‹¤. ë¦¬ë”ë‚˜ í›„ë³´ìì˜ ìš”ì²­ì— ì‘ë‹µë§Œ í•œë‹¤</p>
  </li>
  <li>Raft ì—ê²Œ ì‹œê°„ ë‹¨ìœ„ëŠ” termì´ë‹¤. termì˜ ê¸¸ì´ëŠ” ì„ì˜ì˜ ê°’ì´ë‹¤</li>
  <li>term ì‹œê°„ë‚´ì— ë¦¬ë”ê°€ ì •í•´ì§ˆ ìˆ˜ë„ ìˆê³ , í‘œê°€ í©ì–´ì§€ë©´ ë¦¬ë”ê°€ ì—†ëŠ” ìƒíƒœë¡œ termì´ ëë‚  ìˆ˜ë„ ìˆë‹¤</li>
  <li>termì€ ë‹¨ì¡°ì¦ê°€í•˜ëŠ” ìˆ«ìë¥¼ ê°–ëŠ”ë‹¤. ê°ê°ì˜ ì„œë²„ëŠ” ëª¨ë‘ ìì‹ ì˜ term ìˆ«ìë¥¼ ì €ì¥í•˜ê³  ì„œë¡œ êµí™˜í•œë‹¤</li>
  <li>ë§Œì•½ ìì‹ ì˜ term ê°’ë³´ë‹¤ ë” í° term ê°’ì„ ë§Œë‚˜ë©´ ìì‹ ì˜ term ê°’ì„ update í•œë‹¤</li>
  <li>ë§Œì•½ ë¦¬ë” ë˜ëŠ” í›„ë³´ìë“¤ì´ ìì‹ ì˜ term ê°’ë³´ë‹¤ ë” í° term ê°’ì„ ë§Œë‚˜ë©´ íŒ”ë¡œì›Œ ìƒíƒœë¡œ ë‚´ë ¤ì˜¨ë‹¤</li>
  <li>
    <p>ìì‹ ë³´ë‹¤ ì‘ì€ term ê°’ì€ ë¬´ì‹œí•œë‹¤</p>
  </li>
  <li>RaftëŠ” Leader Election, Log Replicationì„ ìœ„í•´ ì„œë²„ë¼ë¦¬ RPC í†µì‹ ì„ í•œë‹¤</li>
</ul>

<h2 id="leader-election">Leader Election</h2>

<ul>
  <li>ë¦¬ë”ëŠ” ì£¼ê¸°ì ìœ¼ë¡œ ìì‹ ì˜ ì…ì§€ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ í•˜íŠ¸ë¹„íŠ¸ë¥¼ íŒ”ë¡œì›Œë“¤ì—ê²Œ ë³´ë‚¸ë‹¤</li>
  <li>ë¦¬ë”ë¡œë¶€í„° í•˜íŠ¸ë¹„íŠ¸ë¥¼ ê¸°ë‹¤ë¦¬ë˜ íŒ”ë¡œì›Œê°€ ì‹œê°„ë‚´ì— í•˜íŠ¸ë¹„íŠ¸ë¥¼ ë°›ì§€ ëª»í•˜ë©´ ë¦¬ë” ì„ ì¶œì„ ì¼ìœ¼í‚¨ë‹¤</li>
  <li>ë¦¬ë” ì„ ì¶œì„ ì¼ìœ¼í‚¨ íŒ”ë¡œì›Œê°€ í›„ë³´ì ìƒíƒœê°€ ë˜ê³  ìì‹ ì˜ term ìˆ«ìë¥¼ ì¦ê°€ì‹œí‚¨ë‹¤</li>
  <li>íˆ¬í‘œë¥¼ ì§„í–‰í•˜ê²Œ ë˜ë©´, ë‹¤ìŒê³¼ ê°™ì€ 3ê°€ì§€ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆë‹¤
    <ul>
      <li>í›„ë³´ìê°€ ëŒ€ë‹¤ìˆ˜ì˜ í‘œë¥¼ ë°›ê³  ë¦¬ë”ê°€ ëœë‹¤. ì´í›„ì—ëŠ” ìì‹ ì´ íŒ”ë¡œì›Œë“¤ì—ê²Œ í•˜íŠ¸ë¹„íŠ¸ë¥¼ ë³´ë‚¸ë‹¤</li>
      <li>ë§Œì•½ í›„ë³´ìê°€ ìê¸° ë¿ë§Œì´ ì•„ë‹ˆì˜€ê³ , ì‹¬ì§€ì–´ ìê¸°ë³´ë‹¤ ë†’ì€ term ìˆ«ìë¥¼ ê°€ì§€ê³  ìˆë‹¤ë©´, í›„ë³´ìì—ì„œ íŒ”ë¡œì›Œë¡œ ë‚´ë ¤ì˜¨ë‹¤</li>
      <li>ë§Œì•½ í›„ë³´ìë¼ë¦¬ íˆ¬í‘œì—ì„œ ë¦¬ë”ë¥¼ ê²°ì •ì§“ì§€ ëª»í–ˆë‹¤ë©´, ê°€ì¥ ì²˜ìŒìœ¼ë¡œ íƒ€ì„ ì•„ì›ƒì„ ì™¸ì¹œ í›„ë³´ìê°€ ë‹¤ì‹œ íˆ¬í‘œë¥¼ ì§„í–‰í•œë‹¤</li>
    </ul>
  </li>
  <li>ì„œë²„ë§ˆë‹¤ term ê¸¸ì´ë¥¼ ë‹¤ë¥´ê²Œ ê°€ì ¸ê°€ëŠ” ì´ìœ ëŠ” ê°€ì¥ ë¨¼ì € íƒ€ì„ ì•„ì›ƒëœ í›„ë³´ìê°€ ë‹¨ë… íˆ¬í‘œ ì§„í–‰ì„ í•˜ê¸° ìœ„í•´ì„œë‹¤</li>
  <li>ê·¸ë˜ì•¼ ìµœëŒ€í•œ íˆ¬í‘œê°€ splitë˜ì„œ ë¦¬ë”ê°€ ì„ ì¶œë˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ ìˆë‹¤</li>
</ul>

<h2 id="log-replication">Log Replication</h2>

<ul>
  <li>ì¼ë‹¨ ì§€ê¸ˆì€ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ Write-Only ë¼ê³  ê°€ì •í•˜ê² ë‹¤</li>
  <li>ë¦¬ë”ê°€ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ìš”ì²­ì„ ë°›ìœ¼ë©´ í•˜ë‚˜ì˜ ë¡œê·¸ë¡œ ì¶”ê°€í•œë‹¤</li>
  <li>ë¡œê·¸ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ìš”ì²­í•œ ëª…ë ¹ì–´, ë¡œê·¸ íŒŒì¼ì—ì„œì˜ index (ë¡œê·¸ì˜ ìœ„ì¹˜), term (ë¡œê·¸ì˜ ì‹œê°„) ì •ë³´ë¥¼ í¬í•¨í•œë‹¤</li>
  <li>ì´ ë¡œê·¸ëŠ” ëª¨ë“  ë…¸ë“œì— ë³µì œë˜ì–´ì•¼ í•œë‹¤. ë¦¬ë”ëŠ” ëª¨ë“  ë…¸ë“œì— ë³µì œë  ë•Œ ê¹Œì§€ AppendEntries RPC ë¥¼ ê³„ì† ë³´ë‚¸ë‹¤</li>
  <li>ì´ ë¡œê·¸ê°€ ëŒ€ë‹¤ìˆ˜ì˜ ì„œë²„ì— ë³µì œë˜ê³  ë‚˜ë©´ ì»¤ë°‹ëœ ê²ƒìœ¼ë¡œ ê°„ì£¼í•œë‹¤</li>
  <li>ë¦¬ë”ëŠ” ë§ˆì¹¨ë‚´ ë¡œê·¸ì— í¬í•¨ëœ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ëŒë ¤ì¤€ë‹¤ (ì—¬ê¸°ì„œëŠ” Writeë‹ˆê¹Œ ì„±ê³µ ì—¬ë¶€)</li>
  <li>ê·¸ë¦¬ê³  íŒ”ë¡œì›Œë“¤ì€ ë¦¬ë”ê°€ ì €ì¥í•œ ê°’ì„ ì „ë‹¬ë°›ê³  ë§ˆì°¬ê°€ì§€ë¡œ ì €ì¥í•œë‹¤</li>
</ul>

<p>When sending an AppendEntries RPC, the leader includes the term number and index of the entry that immediately precedes the new entry. If the follower cannot find a match for this entry in its own log, it rejects the request to append the new entry.</p>

<p>This consistency check lets the leader conclude that whenever AppendEntries returns successfully from a follower, they have identical logs until the index included in the RPC.</p>

<p>But the logs of leaders and followers may become inconsistent in the face of leader crashes.</p>

<p>In Raft, the leader handles inconsistencies by forcing the followersâ€™ logs to duplicate its own. This means that conflicting entries in follower logs will be overwritten with entries from the leaderâ€™s log.</p>

<p>The leader tries to find the last index where its log matches that of the follower, deletes extra entries if any, and adds the new ones.</p>

<p>The leader maintains a nextIndex for each follower, which is the index of the next log entry the leader will send to that follower. When a leader first comes to power, it initializes all nextIndex values to the index just after the last one in its log.</p>

<p>Whenever AppendRPC returns with a failure for a follower, the leader decrements the nextIndex and issues another AppendEntries RPC. Eventually, nextIndex will reach a value where the logs converge. AppendEntries will succeed when this happens and it can remove extraneous entries (if any) and add new ones from the leaders log (if any). Hence, a successful AppendEntries from a follower guarantees that the leaderâ€™s log is consistent with it.</p>

<p>With this mechanism, a leader does not need to take any special actions to restore log consistency when it comes to power. It just begins normal operation, and the logs automatically converge in response to failures of the Append-Entries consistency check. A leader never overwrites or deletes entries in its own log.</p>

<h2 id="safety">Safety</h2>

<p>Raft makes sure that the leader for a term has committed entries from all previous terms in its log. This is needed to ensure that all logs are consistent and the state machines execute the same set of commands.</p>

<p>During a leader election, the RequestVote RPC includes information about the candidateâ€™s log. If the voter finds that its log it more up-to-date that the candidate, it doesnâ€™t vote for it.</p>

<p>Raft determines which of two logs is more up-to-date by comparing the index and term of the last entries in the logs. If the logs have last entries with different terms, then the log with the later term is more up-to-date. If the logs end with the same term, then whichever log is longer is more up-to-date.</p>

<h1 id="ì°¸ê³ ">ì°¸ê³ </h1>

<ul>
  <li><a href="http://thesecretlivesofdata.com/raft/" target="_blank">Video Demo,  Raft: Understandable Distributed Consensus</a></li>
  <li><a href="https://www.freecodecamp.org/news/in-search-of-an-understandable-consensus-algorithm-a-summary-4bc294c97e0d/" target="_blank">Understanding the Raft consensus algorithm: an academic article summary</a></li>
  <li><a href="https://bravenewgeek.com/building-a-distributed-log-from-scratch-part-2-data-replication/" target="_blank">Building a Distributed Log from Scratch, Part 2: Data Replication</a></li>
</ul>
:ET