---
layout: post
title:  'BlockChain Series [Part2]: 블록체인의 동작 원리(feat.비트코인)'
description: 블록체인 네트워크에서 추구하는 목표는 신뢰할 수 있는 기관 없이도 사용자들이 주체가 되어 경제 시스템을 동작하도록 하는 것입니다
date:   2022-04-03 15:01:35 +0300
image:  '/images/blockchain_logo.webp'
logo_image:  '/images/blockchain_logo.webp'
categories: Blockchain
tags: Blockchain_basic
---
---

**Table of Contents**
{: #toc }
*  TOC
{:toc}

---

# 블록체인 구조

## 노드
노드는 일반적으로 어떤 **네트워크에 속해있는 기기(컴퓨터, 스마트폰 등) 또는 기기를 사용하는 유저**를 일컫습니다. 블록체인 네트워크에서 추구하는 목표는 신뢰할 수 있는 기관(정부, 은행, 핀테크 기업 등) 없이도 **사용자(노드)들이 주체**가 되어 경제 시스템을 동작하도록 하는 것입니다. 그렇기 때문에 블록체인 기반의 네트워크 구조에서는 노드들의 역할이 굉장히 중요합니다.  

아래 그림은 기존의 거래를 위한 네트워크 구조와 블록체인 기반의 구조를 비교한 것입니다.  

![](/images/blockchain_basic_8.png)  

기존에 존재하던 네트워크의 경우 A가 B와 거래를 하기 위해서는 자기 자신의 거래내역만 가지고 있으면 됐었습니다. 이게 가능한 이유는 중앙의 신뢰할 수 있는 기관이 거래에서 발생할 수 있는 문제들을 중재하기 때문이었습니다. 하지만 블록체인 기반 네트워크는 이러한 기관을 없애는 것이 목표입니다. 그래서 블록체인에서는 거래내역의 위,변조를 막기 위해 **네트워크내 모든 노드들에게 이러한 거래내역을 저장하도록 하고 데이터에 변화가 일어났는지 서로를 감시하도록 합니다**.  

아래 그림은 모든 노드가 블록체인 데이터를 함께 저장(분산 저장이 아니라 중복 저장)하고 블록체인 데이터에 변화가 일어나는지 감시합니다. 이 부분에 대해서는 나중에 블록체인의 동작원리 파트에서 더 자세히 설명하도록 하겠습니다.  

![](/images/blockchain_basic_9.png)  

그러면 지금까지 이렇게 저장된 블록의 용량은 얼마나 될까요? 블록체인 기반 서비스의 조상인 비트코인의 경우 2021년 9월 그동안 생성된 블록의 개수는 70만개를 넘어섰다고 합니다. 블록 하나의 최대 크기는 1MB이므로 평균 0.5MB라고 했을 때 대략 340GB입니다. 저희는 블록체인 기반의 거래 서비스(중 비트코인)을 이용하기 위해 **최소한 340GB의 용량이 컴퓨터에 필요**하다는 뜻입니다. 이러한 문제 때문에 비트코인의 경우 노드를 설계할 때 두가지의 다른 형태를 두었습니다. 하나는 **완전 노드**고, 다른 하나는 **단순 지급 검증 노드**입니다.  

- **완전 노드**  
  - 블록체인 데이터 전체 다운 (300GB 이상 디스크 공간 요구)
  - 블록 검증 (검증에 대해서는 보상 없음) -> 사실상 인센티브 공학의 결함
  - 블록 생성 (비트코인 보상) -> 채굴자

- **단순 지급 검증 노드**
  - 블록의 헤더 정도만 다운 (100MB 정도의 작은 공간)
  - 트랜잭션을 요청하는 단순 서비스 이용자

## 블록
블록은 마치 거래 장부에서 **특정 페이지**에 비유할 수 있습니다. 블록 하나에는 **2000~3000개 정도의 트랜잭션**(거래내역)을 담을 수 있는데 그 이유는 **블록 하나의 크기는 1MB**로 제한되는데 트랜잭션 하나의 크기가 보통 0.3kB정도이기 때문입니다.  

![](/images/blockchain_basic_7.png)  

비트코인 블록의 구조는 크게 **블록의 크기, 블록 헤더, 블록 내 거래내역 개수, 모든 거래내역** 이렇게 4가지로 구성됩니다.  

- **블록의 크기**  
  - 4바이트
  - 블록 하나의 크기 (최대 1메가바이트)

- **블록 헤더**
  - 80바이트
  - 버전 정보, 이전 블록 헤더 해시, 머클 트리 루트, 타임 스탬프, 타깃 난이도 비트, 난스로 구성

- **블록 내 전체 거래내역 수**
  - 1~9바이트

- **블록 내 모든 트랜잭션**
  - 가변 크기
  - 2000~3000개 정도 되는 트랜잭션 저장

# 블록체인 동작원리
여기서는 **트랜잭션을 요청**한 후 어떻게 **블록이 생성**되고 그 보상으로 **채굴자가 비트코인을 얻게 되는지**에 관한 과정을 알아보도록 하겠습니다.  


## 트랜잭션 요청
블록체인에서는 **중앙 서버가 존재하지 않기 때문에** 누가 트랜잭션을 처리할 것인지 정해져 있지 않습니다. 그렇기 때문에 블록체인에서는 기본적으로 **트랜잭션을 모든 노드에게 브로드캐스팅**합니다.  

이렇게 전달된 트랜잭션들은 각 노드의 대기실에 쌓인 채로 처리되기를 기다립니다. 또한 이 때 처리되는 트랜잭션의 목록과 순서는 노드마다 다릅니다. 노드 A는 a, b, c를 묶어서 처리하고 노드 B는 b, a, d를 처리하는 등 **네트워크 상태와 트랜잭션에 책정된 수수료에 따라 달라집니다**. 통상 노드는 수수료가 더 높은 트랜잭션을 먼저 처리합니다.  


## 블록 생성
완전 노드 역할을 하는 노드들은 자신들이 가지고 있는 트랜잭션을 가지고 서로 **비동기적**으로 블록을 생성하기 위해 경쟁합니다. 노드들이 블록을 만들기 위해 경쟁을 한다고 했는데 어떤 것을 가지고 경쟁하고 있을까요? 그것은 바로 **해시 퍼즐**입니다. 해시 퍼즐은 공식이 없이 단순 반복을 통해서만 정답을 찾을 수 있습니다. 이러한 단순 반복을 통해 가장 먼저 정답을 찾은 하나의 노드만이 **리더로 선출되고 블록을 만들 자격을 얻는 것**입니다. 이렇게 **블록을 만들기 위해 해시 퍼즐을 푸는 과정을 채굴**한다고 합니다. 또한 이렇게 해시 퍼즐을 통해 리더를 선출하는 방법을 **작업 증명** 방식이라고 합니다. 이외에도 지분 증명이라는 것이 있지만 여기서는 다루지 않도록 하겠습니다.  

![](/images/blockchain_basic_10.png)  

## 검증
위의 그림에서 살펴봤듯이 노드들은 리더가 만든 블록을 자신의 블록체인 데이터에 추가하기 전에 두 가지를 점검합니다. 먼저 리더가 해시 퍼즐의 정답을 제대로 찾았는지 확인하고, 두 번째로 리더가 추가한 트랜잭션에 문제(위조, 변조, 이중 사용 등)가 없는지 검증하는 절차를 가집니다. 이 두 검증 과정은 **해시 함수와 전자 서명, 비대칭 암호화 기법을 활용**해 순식간에 이뤄집니다. 


# 비트코인 생태계

## 블록체인

## 비트코인 시스템

## 비트코인 지갑(UTXO)

## 중개소

# 참고
- [블록체인 해설서 책](http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&mallGb=KOR&barcode=9791161752709&orderClick=LAG&Kc=){:target="_blank"}